(function(){"use strict";var e={1585:function(e,t,s){s.d(t,{$:function(){return l}});s(4114);var a=s(1815);function l(e){return 401===e.status&&(localStorage.clear(),window.dispatchEvent(new Event("user-logout")),alert("Your session has expired. Please log in again."),a.A.push({name:"Login"}),!0)}},1815:function(e,t,s){s.d(t,{A:function(){return Pc}});var a=s(1387),l=s(6768),o=s(4232);const i={class:"dashboard"},n={class:"toolbar"},r={key:2};function d(e,t,s,a,d,u){const c=(0,l.g2)("analytics-all-dashboard"),m=(0,l.g2)("analytics-dashboard");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("header",null,[(0,l.Lk)("h1",null,"Welcome, "+(0,o.v_)(u.userDisplayName)+" ("+(0,o.v_)(u.roleLabel)+")",1),(0,l.Lk)("div",n,[(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>u.logout&&u.logout(...e))},"Logout")])]),(0,l.Lk)("main",null,["Admin"===u.roleLabel?((0,l.uX)(),(0,l.Wv)(c,{key:0})):(0,l.Q3)("",!0),"Staff"===u.roleLabel?((0,l.uX)(),(0,l.Wv)(m,{key:1})):(0,l.Q3)("",!0),"Restricted"===u.roleLabel?((0,l.uX)(),(0,l.CE)("p",r,"You currently do not have permissions to access this dashboard. Please contact the admin/IT to resolve this issue.")):(0,l.Q3)("",!0)])])}s(4114);var u=s(5130);const c={class:"dashboard"},m={class:"topbar"},h={class:"legend"},p={class:"chip-sub"},k=["onClick"],f={class:"chip-title"},b={class:"chip-sub"},y={key:0,class:"kpis"},L={class:"card"},_={class:"card-main"},g={class:"big"},v={class:"card"},S={class:"card-main"},C={class:"big"},w={class:"card"},E={class:"card-main"},A={class:"big"},D={class:"card"},x={class:"card-main"},I={class:"big"},U={class:"grid"},F={class:"panel"},N={class:"pair"},$={class:"v"},M={key:0},P={class:"panel"},B={class:"pair"},X={class:"v"},R={key:0};function H(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",c,[t[17]||(t[17]=(0,l.Lk)("h2",null,"Statistics â€” Overview (all)",-1)),(0,l.Lk)("div",m,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.q=e),type:"search",placeholder:"Search staff by name or emailâ€¦",class:"search"},null,512),[[u.Jo,i.q]]),(0,l.Lk)("div",h,[(0,l.Lk)("button",{class:(0,o.C4)(["chip",{active:null===i.activeYear}]),onClick:t[1]||(t[1]=e=>n.setYear(null)),title:"Show all years"},[t[2]||(t[2]=(0,l.Lk)("div",{class:"chip-title"},"All",-1)),(0,l.Lk)("div",p,"Abnormal labs: "+(0,o.v_)(n.totalsAll.abnormalLabs),1)],2),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.years,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e,class:(0,o.C4)(["chip",{active:i.activeYear===e}]),onClick:t=>n.setYear(e)},[(0,l.Lk)("div",f,(0,o.v_)(e),1),(0,l.Lk)("div",b,"Abnormal labs: "+(0,o.v_)(i.abnormalByYear[e]??0),1)],10,k)))),128))])]),n.hasAnyData?((0,l.uX)(),(0,l.CE)("div",y,[(0,l.Lk)("div",L,[t[3]||(t[3]=(0,l.Lk)("div",{class:"card-label"},"Staff Covered",-1)),(0,l.Lk)("div",_,[(0,l.Lk)("span",g,(0,o.v_)(n.kpi.staffCount),1)]),t[4]||(t[4]=(0,l.Lk)("div",{class:"card-sub"},"No. of staff considered in tables",-1))]),(0,l.Lk)("div",v,[t[5]||(t[5]=(0,l.Lk)("div",{class:"card-label"},"Session Count",-1)),(0,l.Lk)("div",S,[(0,l.Lk)("span",C,(0,o.v_)(n.kpi.sessionCount),1)]),t[6]||(t[6]=(0,l.Lk)("div",{class:"card-sub"},"From summary (current year filter)",-1))]),(0,l.Lk)("div",w,[t[7]||(t[7]=(0,l.Lk)("div",{class:"card-label"},"Abnormal Lab Results",-1)),(0,l.Lk)("div",E,[(0,l.Lk)("span",A,(0,o.v_)(n.kpi.abnormal),1)]),t[8]||(t[8]=(0,l.Lk)("div",{class:"card-sub"},"LDL / Total Chol / HDL combined",-1))]),(0,l.Lk)("div",D,[t[9]||(t[9]=(0,l.Lk)("div",{class:"card-label"},"% Abnormal (labs)",-1)),(0,l.Lk)("div",x,[(0,l.Lk)("span",I,(0,o.v_)(n.kpi.pctAbnormal),1)]),t[10]||(t[10]=(0,l.Lk)("div",{class:"card-sub"},"Of lipid results (admin totals)",-1))])])):(0,l.Q3)("",!0),(0,l.Lk)("div",U,[(0,l.Lk)("div",F,[t[13]||(t[13]=(0,l.Lk)("div",{class:"panel-title"},"Latest Vitals (by staff, in selection)",-1)),(0,l.Lk)("table",null,[t[12]||(t[12]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Staff"),(0,l.Lk)("th",null,"Session"),(0,l.Lk)("th",null,"Weight (kg)"),(0,l.Lk)("th",null,"Height (m)"),(0,l.Lk)("th",null,"BMI"),(0,l.Lk)("th",null,"BP (Sys/Dia)"),(0,l.Lk)("th",null,"Pulse")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.latestVitalsByStaff.slice(0,12),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e._key},[(0,l.Lk)("td",null,[(0,l.Lk)("div",N,[(0,l.Lk)("span",$,(0,o.v_)(e.staff_name||"-"),1)])]),(0,l.Lk)("td",null,(0,o.v_)(n.yearOf(e.session_date)),1),(0,l.Lk)("td",null,(0,o.v_)(e.weight_kg??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.height_m??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.bmi??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.bp_sys??"-")+"/"+(0,o.v_)(e.bp_dia??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.pulse_bpm??"-"),1)])))),128)),n.latestVitalsByStaff.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",M,t[11]||(t[11]=[(0,l.Lk)("td",{colspan:"7",class:"empty"},"No vitals for this selection.",-1)])))])])]),(0,l.Lk)("div",P,[t[16]||(t[16]=(0,l.Lk)("div",{class:"panel-title"},"Key Lipids (LDL / Total Chol / HDL)",-1)),(0,l.Lk)("table",null,[t[15]||(t[15]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Staff"),(0,l.Lk)("th",null,"Session"),(0,l.Lk)("th",null,"LDL"),(0,l.Lk)("th",null,"Total Chol"),(0,l.Lk)("th",null,"HDL"),(0,l.Lk)("th",null,"Abnormal?")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.labsFiltered.slice().reverse().slice(0,20),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.session_id+"_"+e.staff_email},[(0,l.Lk)("td",null,[(0,l.Lk)("div",B,[(0,l.Lk)("span",X,(0,o.v_)(e.staff_name||"-"),1)])]),(0,l.Lk)("td",null,(0,o.v_)(n.yearOf(e.session_date)),1),(0,l.Lk)("td",null,(0,o.v_)(e.ldl_result??"Not done"),1),(0,l.Lk)("td",null,(0,o.v_)(e.tchol_result??"Not done"),1),(0,l.Lk)("td",null,(0,o.v_)(e.hdl_result??"Not done"),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,o.C4)(n.badgeClass(n.isRowAbnormal(e)))},(0,o.v_)(n.isRowAbnormal(e)?"Yes":"No"),3)])])))),128)),n.labsFiltered.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",R,t[14]||(t[14]=[(0,l.Lk)("td",{colspan:"6",class:"empty"},"No lab rows in this selection.",-1)])))])])])])])}s(8111),s(2489),s(7588),s(1701),s(8237),s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);var O=s(8945),T=s(1585),V={name:"AnalyticsAllPage",data(){return{baseUrl:O.A.API_BASE_URL,summary:null,staffMap:new Map,labsSeriesYear:[],vitals:[],labs:[],activeYear:null,q:"",abnormalByYear:{}}},computed:{hasAnyData(){return!!(this.summary||this.vitals.length||this.labs.length)},years(){const e=new Set((this.labsSeriesYear||[]).map((e=>this.yearFromBucket(e.bucket))).filter(Boolean));return[...e].sort(((e,t)=>t-e))},vitalsFiltered(){let e=this.filterByYear(this.vitals);return this.filterByQuery(e)},labsFiltered(){let e=this.filterByYear(this.labs);return this.filterByQuery(e)},totalsAll(){const e=this.sumAbnormalFromSeries(this.labsSeriesYear);return{abnormalLabs:e.abnormal}},kpi(){const e=this.sessionCountFromSummary(),{abnormal:t,normal:s,notdone:a}=this.sumAbnormalFromSeries(this.filteredYearSeries()),l=t+s+a,o=l?Math.round(t/l*100)+"%":"â€”",i=new Set(this.vitalsFiltered.map((e=>e.staff_email)));return{staffCount:i.size,sessionCount:e,abnormal:t,pctAbnormal:o}},latestVitalsByStaff(){const e=new Map;for(const s of this.vitalsFiltered){const t=s.staff_email,a=e.get(t);(!a||new Date(s.session_date)>new Date(a.session_date))&&e.set(t,s)}const t=[...e.values()].sort(((e,t)=>new Date(t.session_date)-new Date(e.session_date)));return t.forEach(((e,t)=>e._key=e.session_id+"_"+e.staff_email+"_"+t)),t}},async mounted(){await this.loadData(),this.buildAbnormalByYear()},methods:{async loadData(){const e={Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},t=await fetch(`${this.baseUrl}/admin/staff-list`,{headers:e}).then((e=>{if(!(0,T.$)(e))return e.json()})).catch((()=>[]));this.staffMap=new Map(t.map((e=>[e.staff_email,e.staff_name])));const[s,a]=await Promise.all([fetch(`${this.baseUrl}/admin/stats/summary?groupBy=month`,{headers:e}).then((e=>e.json())),fetch(`${this.baseUrl}/admin/stats/labs?fields=ldl_result,tchol_result,hdl_result&groupBy=year`,{headers:e}).then((e=>e.json()))]);this.summary=s||null,this.labsSeriesYear=a&&a.series?a.series:[];const l=(s?.top_staff_by_sessions||[]).slice(0,20),o=l.map((e=>e.staff_email)),i=Array.from(new Set(o)),n=i.map((async t=>{const s=t.replace(/\./g,"XYZ"),[a,l]=await Promise.all([fetch(`${this.baseUrl}/stats/vitals/${s}`,{headers:e}).then((e=>e.json())).catch((()=>[])),fetch(`${this.baseUrl}/stats/labs/${s}?fields=ldl_result,tchol_result,hdl_result`,{headers:e}).then((e=>e.json())).catch((()=>[]))]),o=this.staffMap.get(t)||null;return a.forEach((e=>{e.staff_email=t,e.staff_name=o})),l.forEach((e=>{e.staff_email=t,e.staff_name=o})),{vitalsRows:a,labsRows:l}})),r=await Promise.all(n),d=[],u=[];r.forEach((({vitalsRows:e,labsRows:t})=>{(e||[]).forEach((e=>d.push(e))),(t||[]).forEach((e=>u.push(e)))}));const c=(e,t)=>new Date(e.session_date)-new Date(t.session_date);this.vitals=d.sort(c),this.labs=u.sort(c),this.attachNames()},yearOf(e){return e?new Date(e).getFullYear():""},setYear(e){this.activeYear=e},attachNames(){const e=e=>this.staffMap.get(e)||null;this.vitals.forEach((t=>{t.staff_name||(t.staff_name=e(t.staff_email))})),this.labs.forEach((t=>{t.staff_name||(t.staff_name=e(t.staff_email))}))},yearFromBucket(e){const t=String(e||"").slice(0,4),s=Number(t);return Number.isFinite(s)?s:null},filterByYear(e){return null==this.activeYear?e:e.filter((e=>this.yearOf(e.session_date)===this.activeYear))},filterByQuery(e){const t=(this.q||"").toLowerCase().trim();return t?e.filter((e=>{const s=(e.staff_name||"").toLowerCase(),a=(e.staff_email||"").toLowerCase();return s.includes(t)||a.includes(t)})):e},filteredYearSeries(){return null==this.activeYear?this.labsSeriesYear:(this.labsSeriesYear||[]).filter((e=>this.yearFromBucket(e.bucket)===this.activeYear))},sessionCountFromSummary(){const e=this.summary?.sessions_by_period||[];return null==this.activeYear?e.reduce(((e,t)=>e+(Number(t.count)||0)),0):e.filter((e=>this.yearFromBucket(String(e.bucket))===this.activeYear)).reduce(((e,t)=>e+(Number(t.count)||0)),0)},sumAbnormalFromSeries(e){let t=0,s=0,a=0;for(const l of e||[]){const e=e=>Number(l[e]||0);t+=e("ldl_result_abnormal")+e("tchol_result_abnormal")+e("hdl_result_abnormal"),s+=e("ldl_result_normal")+e("tchol_result_normal")+e("hdl_result_normal"),a+=e("ldl_result_not_done")+e("tchol_result_not_done")+e("hdl_result_not_done")}return{abnormal:t,normal:s,notdone:a}},buildAbnormalByYear(){const e={};for(const t of this.labsSeriesYear||[]){const s=this.yearFromBucket(t.bucket);if(!s)continue;const a={abnormal:Number(t.ldl_result_abnormal||0)+Number(t.tchol_result_abnormal||0)+Number(t.hdl_result_abnormal||0)};e[s]=(e[s]??0)+a.abnormal}this.abnormalByYear=e},isRowAbnormal(e){return[e.ldl_result,e.tchol_result,e.hdl_result].some((e=>"Abnormal"===e))},badgeClass(e){return e?"badge bad":"badge good"}}},j=s(1241);const J=(0,j.A)(V,[["render",H],["__scopeId","data-v-e315365c"]]);var Q=J;const Y={class:"dashboard"},W={class:"legend"},z={class:"chip-sub"},q=["onClick","title"],K={class:"chip-title"},G={class:"chip-sub"},Z={key:0,class:"kpis"},ee={class:"card"},te={class:"card-main"},se={class:"big"},ae={class:"card-sub"},le={class:"card"},oe={class:"card-main"},ie={class:"big"},ne={class:"card"},re={class:"card-main"},de={class:"big"},ue={class:"card"},ce={class:"card-main"},me={class:"big"},he={class:"card-sub"},pe={class:"grid"},ke={class:"panel"},fe={key:0},be={class:"panel"},ye={key:0};function Le(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Y,[t[14]||(t[14]=(0,l.Lk)("h2",null,"Statistics â€” Overview",-1)),(0,l.Lk)("div",W,[(0,l.Lk)("button",{class:(0,o.C4)(["chip",{active:null===i.activeSessionId}]),onClick:t[0]||(t[0]=e=>n.setActiveSession(null)),title:"Show all sessions"},[t[1]||(t[1]=(0,l.Lk)("div",{class:"chip-title"},"All",-1)),(0,l.Lk)("div",z,"Abnormal labs: "+(0,o.v_)(n.totalsAll.abnormalLabs),1)],2),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.sortedSessions,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e.session_id,class:(0,o.C4)(["chip",{active:i.activeSessionId===e.session_id}]),onClick:t=>n.setActiveSession(e.session_id),title:n.fmtDate(e.session_date)},[(0,l.Lk)("div",K,(0,o.v_)(n.yearOf(e.session_date)),1),(0,l.Lk)("div",G,"Abnormal labs: "+(0,o.v_)(i.abnormalBySession[e.session_id]??0),1)],10,q)))),128))]),t[15]||(t[15]=(0,l.Lk)("h3",null,"Latest Values:",-1)),n.vitalsFiltered.length||n.labsFiltered.length?((0,l.uX)(),(0,l.CE)("div",Z,[(0,l.Lk)("div",ee,[t[2]||(t[2]=(0,l.Lk)("div",{class:"card-label"},"BMI",-1)),(0,l.Lk)("div",te,[(0,l.Lk)("span",se,(0,o.v_)(n.kpiBMI.value??"-"),1),(0,l.Lk)("span",{class:(0,o.C4)(["delta",n.deltaClass(n.kpiBMI.delta)])},(0,o.v_)(n.prettyDelta(n.kpiBMI.delta)),3)]),(0,l.Lk)("div",ae,(0,o.v_)(n.kpiBMI.caption),1)]),(0,l.Lk)("div",le,[t[3]||(t[3]=(0,l.Lk)("div",{class:"card-label"},"Blood Pressure",-1)),(0,l.Lk)("div",oe,[(0,l.Lk)("span",ie,(0,o.v_)(n.kpiBP.value??"-"),1),(0,l.Lk)("span",{class:(0,o.C4)(["delta",n.deltaClass(n.kpiBP.delta)])},(0,o.v_)(n.prettyDelta(n.kpiBP.delta)),3)]),t[4]||(t[4]=(0,l.Lk)("div",{class:"card-sub"},"Systolic / Diastolic (mmHg)",-1))]),(0,l.Lk)("div",ne,[t[5]||(t[5]=(0,l.Lk)("div",{class:"card-label"},"Pulse",-1)),(0,l.Lk)("div",re,[(0,l.Lk)("span",de,(0,o.v_)(n.kpiPulse.value??"-"),1),(0,l.Lk)("span",{class:(0,o.C4)(["delta",n.deltaClass(n.kpiPulse.delta)])},(0,o.v_)(n.prettyDelta(n.kpiPulse.delta)),3)]),t[6]||(t[6]=(0,l.Lk)("div",{class:"card-sub"},"Beats per minute",-1))]),(0,l.Lk)("div",ue,[t[7]||(t[7]=(0,l.Lk)("div",{class:"card-label"},"Abnormal Labs",-1)),(0,l.Lk)("div",ce,[(0,l.Lk)("span",me,(0,o.v_)(n.kpiLabs.abnormal),1)]),(0,l.Lk)("div",he," Normal: "+(0,o.v_)(n.kpiLabs.normal)+" Â· Not done: "+(0,o.v_)(n.kpiLabs.notdone),1)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",pe,[(0,l.Lk)("div",ke,[t[10]||(t[10]=(0,l.Lk)("div",{class:"panel-title"},"Latest Vitals (in selection)",-1)),(0,l.Lk)("table",null,[t[9]||(t[9]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Session"),(0,l.Lk)("th",null,"Weight (kg)"),(0,l.Lk)("th",null,"Height (m)"),(0,l.Lk)("th",null,"BMI"),(0,l.Lk)("th",null,"BP (Sys/Dia)"),(0,l.Lk)("th",null,"Pulse")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.vitalsFiltered.slice().reverse().slice(0,5),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.session_id},[(0,l.Lk)("td",null,(0,o.v_)(n.yearOf(e.session_date)),1),(0,l.Lk)("td",null,(0,o.v_)(e.weight_kg??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.height_m??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.bmi??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.bp_sys??"-")+"/"+(0,o.v_)(e.bp_dia??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.pulse_bpm??"-"),1)])))),128)),n.vitalsFiltered.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",fe,t[8]||(t[8]=[(0,l.Lk)("td",{colspan:"6",class:"empty"},"No vitals in this selection.",-1)])))])])]),(0,l.Lk)("div",be,[t[13]||(t[13]=(0,l.Lk)("div",{class:"panel-title"},"Key Lipids (LDL / Total Chol / HDL)",-1)),(0,l.Lk)("table",null,[t[12]||(t[12]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Session"),(0,l.Lk)("th",null,"LDL"),(0,l.Lk)("th",null,"Total Chol"),(0,l.Lk)("th",null,"HDL"),(0,l.Lk)("th",null,"Abnormal?")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.labsFiltered.slice().reverse().slice(0,5),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.session_id},[(0,l.Lk)("td",null,(0,o.v_)(n.yearOf(e.session_date)),1),(0,l.Lk)("td",null,(0,o.v_)(e.ldl_result??"Not done"),1),(0,l.Lk)("td",null,(0,o.v_)(e.tchol_result??"Not done"),1),(0,l.Lk)("td",null,(0,o.v_)(e.hdl_result??"Not done"),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,o.C4)(n.badgeClass(n.isRowAbnormal(e)))},(0,o.v_)(n.isRowAbnormal(e)?"Yes":"No"),3)])])))),128)),n.labsFiltered.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",ye,t[11]||(t[11]=[(0,l.Lk)("td",{colspan:"5",class:"empty"},"No lab rows in this selection.",-1)])))])])])])])}var _e={name:"AnalyticsDashboard",data(){return{baseUrl:O.A.API_BASE_URL,sessions:[],vitals:[],labs:[],activeSessionId:null,abnormalBySession:{}}},computed:{vitalsFiltered(){return this.activeSessionId?this.vitals.filter((e=>e.session_id===this.activeSessionId)):this.vitals},labsFiltered(){return this.activeSessionId?this.labs.filter((e=>e.session_id===this.activeSessionId)):this.labs},sortedSessions(){return[...this.sessions].sort(((e,t)=>{const s=new Date(e.session_date).getTime(),a=new Date(t.session_date).getTime();return a-s}))},totalsAll(){const e=this.countLabStatuses(this.labs);return{abnormalLabs:e.Abnormal}},kpiBMI(){const e=this.lastByDate(this.vitalsFiltered),t=this.prevByDate(this.vitalsFiltered),s=e?.bmi??null,a=null!=e?.bmi&&null!=t?.bmi?+(e.bmi-t.bmi).toFixed(1):null;return{value:s,delta:a,caption:e?`Latest session: ${this.yearOf(e.session_date)}`:"â€”"}},kpiBP(){const e=this.lastByDate(this.vitalsFiltered),t=this.prevByDate(this.vitalsFiltered),s=null!=e?.bp_sys&&null!=e?.bp_dia?`${e.bp_sys}/${e.bp_dia}`:null;let a=null;if(null!=e?.bp_sys&&null!=t?.bp_sys&&null!=e?.bp_dia&&null!=t?.bp_dia){a=`â†‘${e.bp_sys-t.bp_sys}/â†‘${e.bp_dia-t.bp_dia}`;const s=e.bp_sys-t.bp_sys,l=e.bp_dia-t.bp_dia;s<=0&&l<=0&&(a=`â†“${Math.abs(s)}/${Math.abs(l)}`)}return{value:s,delta:a,caption:e?`Latest session: ${this.yearOf(e.session_date)}`:"â€”"}},kpiPulse(){const e=this.lastByDate(this.vitalsFiltered),t=this.prevByDate(this.vitalsFiltered),s=e?.pulse_bpm??null,a=null!=e?.pulse_bpm&&null!=t?.pulse_bpm?e.pulse_bpm-t.pulse_bpm:null;return{value:s,delta:a,caption:e?`Latest session: ${this.yearOf(e.session_date)}`:"â€”"}},kpiLabs(){const e=this.countLabStatuses(this.labsFiltered);return{abnormal:e.Abnormal,normal:e.Normal,notdone:e["Not done"]}}},async mounted(){await this.loadData(),this.buildAbnormalIndex(),this.activeSessionId=null},methods:{fmtDate(e){return new Date(e).toLocaleDateString()},yearOf(e){return new Date(e).getFullYear()},async loadData(){const e=JSON.parse(localStorage.getItem("user_info"));if(!e)return;const t=e.email.replace(/\./g,"XYZ"),s={Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},[a,l,o]=await Promise.all([fetch(`${this.baseUrl}/checkup-sessions/stats/${t}`,{headers:s}).then((e=>{if(!(0,T.$)(e))return e.json()})),fetch(`${this.baseUrl}/stats/vitals/${t}`,{headers:s}).then((e=>e.json())),fetch(`${this.baseUrl}/stats/labs/${t}?fields=ldl_result,tchol_result,hdl_result`,{headers:s}).then((e=>e.json()))]);this.sessions=(a||[]).sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date))),this.vitals=(l||[]).sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date))),this.labs=(o||[]).sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date))),this.activeSessionId=this.sessions.at(-1)?.session_id??null},setActiveSession(e){this.activeSessionId=e},buildAbnormalIndex(){const e={};for(const t of this.labs){const s=t.session_id,a=[t.ldl_result,t.tchol_result,t.hdl_result].filter(Boolean),l=a.filter((e=>"Abnormal"===e)).length;e[s]=(e[s]??0)+l}this.abnormalBySession=e},lastByDate(e){return e.length?e.slice().sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date))).at(-1):null},prevByDate(e){if(e.length<2)return null;const t=e.slice().sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date)));return t.at(-2)},countLabStatuses(e){const t={Normal:0,Abnormal:0,"Not done":0};for(const s of e)[s.ldl_result,s.tchol_result,s.hdl_result].forEach((e=>{const s=e??"Not done";null==t[s]&&(t[s]=0),t[s]+=1}));return t},isRowAbnormal(e){return[e.ldl_result,e.tchol_result,e.hdl_result].some((e=>"Abnormal"===e))},deltaClass(e){return null==e?"":"string"===typeof e?e.startsWith("â†“")?"neg":"pos":e<0?"neg":e>0?"pos":""},prettyDelta(e){return null==e?"â€”":"string"===typeof e?e:e>0?`+${e}`:`${e}`},badgeClass(e){return e?"badge bad":"badge good"}}};const ge=(0,j.A)(_e,[["render",Le],["__scopeId","data-v-b353916c"]]);var ve=ge,Se={name:"MyDashboard",components:{AnalyticsAllDashboard:Q,AnalyticsDashboard:ve},data(){return{currentUserInfo:null,showInfo:!1}},computed:{jwtToken(){return localStorage.getItem("jwt_token")},userRole(){return this.currentUserInfo&&this.currentUserInfo.role||"Restricted"},userDisplayName(){return this.currentUserInfo?.fullname?this.currentUserInfo.fullname:this.currentUserInfo?.username?this.currentUserInfo.username:"Unknown User"},roleLabel(){return{doctor:"Doctor",staff:"Staff",admin:"Admin",restricted:"Restricted"}[this.userRole]||"Restricted"}},created(){this.loadUserInfo()},mounted(){this.jwtToken&&this.currentUserInfo||(console.warn("Authentication token or user info missing in Dashboard. Redirecting to login."),this.logout())},methods:{loadUserInfo(){const e=localStorage.getItem("user_info");if(e)try{this.currentUserInfo=JSON.parse(e)}catch(t){console.error("Error parsing user_info in Dashboard:",t),this.currentUserInfo=null}else this.currentUserInfo=null},logout(){localStorage.removeItem("jwt_token"),localStorage.removeItem("user_info"),window.dispatchEvent(new Event("user-logout")),this.$router.push("/")}}};const Ce=(0,j.A)(Se,[["render",d],["__scopeId","data-v-6bf2fe83"]]);var we=Ce;const Ee={class:"register-container"},Ae={class:"form-row"},De={class:"form-row"},xe={class:"form-row"},Ie={class:"form-row"},Ue={key:0},Fe={class:"form-row"},Ne={class:"form-row"},$e={class:"form-row"},Me={class:"form-row"},Pe={class:"form-row"},Be={key:1},Xe={class:"form-row"},Re={class:"form-row"},He={class:"form-row"},Oe={class:"form-row"},Te={key:2},Ve={class:"form-row"},je={class:"form-row"},Je={class:"form-row"},Qe={class:"form-row"},Ye={class:"form-row"},We={key:3},ze={class:"form-row"},qe={class:"form-row"},Ke={key:4,class:"success"},Ge={key:5,class:"error"},Ze={class:"login-link"};function et(e,t,s,a,i,n){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",Ee,[t[49]||(t[49]=(0,l.Lk)("h2",null,"Register",-1)),(0,l.Lk)("form",{onSubmit:t[20]||(t[20]=(0,u.D$)(((...e)=>n.register&&n.register(...e)),["prevent"]))},[(0,l.Lk)("div",Ae,[t[21]||(t[21]=(0,l.Lk)("label",{for:"username"},"Username:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.form.username=e),type:"text",id:"username",required:""},null,512),[[u.Jo,i.form.username]])]),(0,l.Lk)("div",De,[t[22]||(t[22]=(0,l.Lk)("label",{for:"password"},"Password:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.form.password=e),type:"password",id:"password",required:""},null,512),[[u.Jo,i.form.password]])]),(0,l.Lk)("div",xe,[t[23]||(t[23]=(0,l.Lk)("label",{for:"confirmPassword"},"Confirm Password:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.form.confirmPassword=e),type:"password",id:"confirmPassword",required:""},null,512),[[u.Jo,i.form.confirmPassword]])]),(0,l.Lk)("div",Ie,[t[25]||(t[25]=(0,l.Lk)("label",{for:"role"},"Role:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.form.role=e),id:"role",required:""},t[24]||(t[24]=[(0,l.Lk)("option",{value:null,disabled:""},"-- Please select a role --",-1),(0,l.Lk)("option",{value:"student"},"Student",-1),(0,l.Lk)("option",{value:"lecturer"},"Lecturer",-1),(0,l.Lk)("option",{value:"advisor"},"Advisor",-1),(0,l.Lk)("option",{value:"admin"},"Admin",-1)]),512),[[u.u1,i.form.role]])]),"student"===i.form.role?((0,l.uX)(),(0,l.CE)("div",Ue,[t[31]||(t[31]=(0,l.Lk)("h3",null,"Student Details",-1)),(0,l.Lk)("div",Fe,[t[26]||(t[26]=(0,l.Lk)("label",{for:"fullName"},"Full Name:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.form.fullName=e),type:"text",id:"fullName",required:""},null,512),[[u.Jo,i.form.fullName]])]),(0,l.Lk)("div",Ne,[t[27]||(t[27]=(0,l.Lk)("label",{for:"matricNo"},"Matric No:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.form.matricNo=e),type:"text",id:"matricNo",required:""},null,512),[[u.Jo,i.form.matricNo]])]),(0,l.Lk)("div",$e,[t[28]||(t[28]=(0,l.Lk)("label",{for:"email"},"Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.form.email=e),type:"email",id:"email",required:""},null,512),[[u.Jo,i.form.email]])]),(0,l.Lk)("div",Me,[t[29]||(t[29]=(0,l.Lk)("label",{for:"yearOfStudy"},"Year of Study:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.form.yearOfStudy=e),type:"number",id:"yearOfStudy",required:"",min:"1",max:"6"},null,512),[[u.Jo,i.form.yearOfStudy]])]),(0,l.Lk)("div",Pe,[t[30]||(t[30]=(0,l.Lk)("label",{for:"programme"},"Programme:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.form.programme=e),type:"text",id:"programme",required:""},null,512),[[u.Jo,i.form.programme]])])])):(0,l.Q3)("",!0),"lecturer"===i.form.role?((0,l.uX)(),(0,l.CE)("div",Be,[t[36]||(t[36]=(0,l.Lk)("h3",null,"Lecturer Details",-1)),(0,l.Lk)("div",Xe,[t[32]||(t[32]=(0,l.Lk)("label",{for:"lecturerName"},"Full Name:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>i.form.lecturerName=e),type:"text",id:"lecturerName",required:""},null,512),[[u.Jo,i.form.lecturerName]])]),(0,l.Lk)("div",Re,[t[33]||(t[33]=(0,l.Lk)("label",{for:"lecturerStaffId"},"Staff ID:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>i.form.lecturerStaffId=e),type:"text",id:"lecturerStaffId",required:""},null,512),[[u.Jo,i.form.lecturerStaffId]])]),(0,l.Lk)("div",He,[t[34]||(t[34]=(0,l.Lk)("label",{for:"lecturerEmail"},"Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>i.form.lecturerEmail=e),type:"email",id:"lecturerEmail",required:""},null,512),[[u.Jo,i.form.lecturerEmail]])]),(0,l.Lk)("div",Oe,[t[35]||(t[35]=(0,l.Lk)("label",{for:"lecturerDepartment"},"Department:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>i.form.lecturerDepartment=e),type:"text",id:"lecturerDepartment",required:""},null,512),[[u.Jo,i.form.lecturerDepartment]])])])):(0,l.Q3)("",!0),"advisor"===i.form.role?((0,l.uX)(),(0,l.CE)("div",Te,[t[42]||(t[42]=(0,l.Lk)("h3",null,"Academic Advisor Details",-1)),(0,l.Lk)("div",Ve,[t[37]||(t[37]=(0,l.Lk)("label",{for:"advisorName"},"Full Name:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.form.advisorName=e),type:"text",id:"advisorName",required:""},null,512),[[u.Jo,i.form.advisorName]])]),(0,l.Lk)("div",je,[t[38]||(t[38]=(0,l.Lk)("label",{for:"advisorStaffId"},"Staff ID:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>i.form.advisorStaffId=e),type:"text",id:"advisorStaffId",required:""},null,512),[[u.Jo,i.form.advisorStaffId]])]),(0,l.Lk)("div",Je,[t[39]||(t[39]=(0,l.Lk)("label",{for:"advisorEmail"},"Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>i.form.advisorEmail=e),type:"email",id:"advisorEmail",required:""},null,512),[[u.Jo,i.form.advisorEmail]])]),(0,l.Lk)("div",Qe,[t[40]||(t[40]=(0,l.Lk)("label",{for:"advisorDepartment"},"Department:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>i.form.advisorDepartment=e),type:"text",id:"advisorDepartment",required:""},null,512),[[u.Jo,i.form.advisorDepartment]])]),(0,l.Lk)("div",Ye,[t[41]||(t[41]=(0,l.Lk)("label",{for:"adviseeQuota"},"Advisee Quota:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[17]||(t[17]=e=>i.form.adviseeQuota=e),type:"number",id:"adviseeQuota",required:""},null,512),[[u.Jo,i.form.adviseeQuota]])])])):(0,l.Q3)("",!0),"admin"===i.form.role?((0,l.uX)(),(0,l.CE)("div",We,[t[45]||(t[45]=(0,l.Lk)("h3",null,"Admin Details",-1)),(0,l.Lk)("div",ze,[t[43]||(t[43]=(0,l.Lk)("label",{for:"adminName"},"Full Name:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.form.adminName=e),type:"text",id:"adminName",required:""},null,512),[[u.Jo,i.form.adminName]])]),(0,l.Lk)("div",qe,[t[44]||(t[44]=(0,l.Lk)("label",{for:"adminEmail"},"Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>i.form.adminEmail=e),type:"email",id:"adminEmail",required:""},null,512),[[u.Jo,i.form.adminEmail]])])])):(0,l.Q3)("",!0),t[48]||(t[48]=(0,l.Lk)("button",{type:"submit"},"Register",-1)),i.successMessage?((0,l.uX)(),(0,l.CE)("p",Ke,(0,o.v_)(i.successMessage),1)):(0,l.Q3)("",!0),i.errorMessage?((0,l.uX)(),(0,l.CE)("p",Ge,(0,o.v_)(i.errorMessage),1)):(0,l.Q3)("",!0),(0,l.Lk)("p",Ze,[t[47]||(t[47]=(0,l.eW)(" Already have an account? ")),(0,l.bF)(r,{to:"/"},{default:(0,l.k6)((()=>t[46]||(t[46]=[(0,l.eW)("Login here")]))),_:1,__:[46]})])],32)])])}var tt={name:"MyRegister",data(){return{successMessage:"",errorMessage:"",form:{username:"",password:"",confirmPassword:"",role:null,fullName:"",matricNo:"",email:"",yearOfStudy:"",programme:"",lecturerName:"",lecturerStaffId:"",lecturerEmail:"",lecturerDepartment:"",advisorName:"",advisorStaffId:"",advisorEmail:"",advisorDepartment:"",adviseeQuota:"",adminName:"",adminEmail:""}}},watch:{"form.role"(e,t){"student"!==e&&"student"===t&&(this.form.fullName="",this.form.matricNo="",this.form.email="",this.form.yearOfStudy="",this.form.programme=""),"lecturer"!==e&&"lecturer"===t&&(this.form.lecturerName="",this.form.lecturerStaffId="",this.form.lecturerEmail="",this.form.lecturerDepartment=""),"advisor"!==e&&"advisor"===t&&(this.form.advisorName="",this.form.advisorStaffId="",this.form.advisorEmail="",this.form.advisorDepartment="",this.form.adviseeQuota="")}},methods:{async register(){if(this.errorMessage="",this.successMessage="",this.form.password!==this.form.confirmPassword)return void(this.errorMessage="Passwords do not match.");if(null===this.form.role)return void(this.errorMessage="Please select a role.");const e={username:this.form.username,password:this.form.password,role:this.form.role};if("student"===this.form.role){if(!this.form.fullName||!this.form.matricNo||!this.form.email||!this.form.yearOfStudy||!this.form.programme)return void(this.errorMessage="All student details (Full Name, Matric No, Email, Year of Study, Programme) are required.");e.full_name=this.form.fullName,e.matric_no=this.form.matricNo,e.email=this.form.email,e.year_of_study=parseInt(this.form.yearOfStudy),e.programme=this.form.programme}if("lecturer"===this.form.role){if(!this.form.lecturerName||!this.form.lecturerStaffId||!this.form.lecturerEmail||!this.form.lecturerDepartment)return void(this.errorMessage="All lecturer details are required.");e.full_name=this.form.lecturerName,e.email=this.form.lecturerEmail,e.lecturer_id=this.form.lecturerStaffId,e.department=this.form.lecturerDepartment,e.status="active"}else if("advisor"===this.form.role){if(!this.form.advisorName||!this.form.advisorStaffId||!this.form.advisorEmail||!this.form.advisorDepartment||!this.form.adviseeQuota)return void(this.errorMessage="All advisor details (Full Name, Staff ID, Email, Department, Advisee Quota) are required.");e.full_name=this.form.advisorName,e.email=this.form.advisorEmail,e.advisor_id=this.form.advisorStaffId,e.department=this.form.advisorDepartment,e.advisee_quota=parseInt(this.form.adviseeQuota)}if("admin"===this.form.role){if(!this.form.adminName||!this.form.adminEmail)return void(this.errorMessage="All admin details (Full Name and Email) are required.");e.full_name=this.form.adminName,e.email=this.form.adminEmail}console.log("Submitting registration:",e);try{const t=await fetch("http://localhost:8000/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();t.ok?(this.successMessage="Registration successful! Redirecting to login...",this.errorMessage="",this.resetForm(),setTimeout((()=>{this.$router.push("/")}),2e3)):(this.errorMessage=s.error||"Registration failed.",console.error("Registration Error:",s))}catch(t){console.error("Network error during registration:",t),this.errorMessage="Network error. Could not connect to the server. Please try again."}},resetForm(){this.form={username:"",password:"",confirmPassword:"",role:null,fullName:"",matricNo:"",email:"",yearOfStudy:"",programme:"",lecturerName:"",lecturerStaffId:"",lecturerEmail:"",lecturerDepartment:"",advisorName:"",advisorStaffId:"",advisorEmail:"",advisorDepartment:"",adviseeQuota:"",adminName:"",adminEmail:""}}}};const st=(0,j.A)(tt,[["render",et],["__scopeId","data-v-02d500ac"]]);var at=st;const lt={class:"login-container"},ot={class:"form-row"},it={class:"form-row"},nt={key:0,class:"success"},rt={key:1,class:"error"};function dt(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",lt,[t[6]||(t[6]=(0,l.Lk)("h2",null,"Login",-1)),(0,l.Lk)("form",{onSubmit:t[2]||(t[2]=(0,u.D$)(((...e)=>n.login&&n.login(...e)),["prevent"]))},[(0,l.Lk)("div",ot,[t[3]||(t[3]=(0,l.Lk)("label",{for:"email"},"Email:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.email=e),type:"text",id:"email",required:""},null,512),[[u.Jo,i.email]])]),(0,l.Lk)("div",it,[t[4]||(t[4]=(0,l.Lk)("label",{for:"password"},"Password:",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),type:"password",id:"password",required:""},null,512),[[u.Jo,i.password]])]),t[5]||(t[5]=(0,l.Lk)("button",{type:"submit"},"Login",-1))],32)]),i.successMessage?((0,l.uX)(),(0,l.CE)("p",nt,(0,o.v_)(i.successMessage),1)):(0,l.Q3)("",!0),i.errorMessage?((0,l.uX)(),(0,l.CE)("p",rt,(0,o.v_)(i.errorMessage),1)):(0,l.Q3)("",!0)])}var ut={name:"MyLogin",data(){return{email:"",password:"",errorMessage:"",successMessage:""}},methods:{async login(){this.errorMessage="",this.successMessage="",console.group("Login Process"),console.log("Login attempt started for user:",this.email);const e=O.A.API_BASE_URL;try{const t=await fetch(`${e}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.email,password:this.password})}),s=await t.json();t.ok&&s.token?(console.log("Login API response successful. Token received."),this.successMessage=`Login successful! Welcome, ${s.user.email}. Redirecting...`,localStorage.setItem("jwt_token",s.token),localStorage.setItem("user_info",JSON.stringify(s.user)),console.log("Attempting redirection to /dashboard..."),window.dispatchEvent(new Event("user-login")),this.$router?this.$router.push("/dashboard").then((()=>{})).catch((e=>{console.error("Router push to /dashboard failed (promise rejected):",e),this.errorMessage="Navigation error after login."})):(console.warn("Vue Router instance not found. Falling back to window.location.href. Ensure router is correctly installed/configured in main.js."),window.location.href="dashboard.html")):(this.errorMessage=s.error||"Login failed. Please check your credentials.",console.error("Login failed with API error:",this.errorMessage))}catch(t){console.error("Login network/fetch error or uncaught exception:",t),this.errorMessage="Could not connect to the server. Please try again."}finally{console.groupEnd()}}}};const ct=(0,j.A)(ut,[["render",dt],["__scopeId","data-v-2fbad2ae"]]);var mt=ct;const ht={class:"profile-page"},pt={key:0},kt={class:"field"},ft={class:"field"},bt={class:"field"},yt=["value"],Lt={key:0,class:"field"},_t={key:0},gt={key:1},vt={class:"field"},St={class:"actions"},Ct=["disabled","title"],wt=["disabled"];function Et(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",ht,[t[12]||(t[12]=(0,l.Lk)("h2",null,"User Profile",-1)),i.loading?((0,l.uX)(),(0,l.CE)("div",pt,"Loading profileâ€¦")):((0,l.uX)(),(0,l.CE)("form",{key:1,onSubmit:t[6]||(t[6]=(0,u.D$)(((...e)=>n.save&&n.save(...e)),["prevent"]))},[(0,l.Lk)("div",kt,[t[8]||(t[8]=(0,l.Lk)("label",null,"Full Name",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.form.fullname=e),type:"text",placeholder:"Full name"},null,512),[[u.Jo,i.form.fullname,void 0,{trim:!0}]])]),(0,l.Lk)("div",ft,[t[9]||(t[9]=(0,l.Lk)("label",null,"Email",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.form.email=e),type:"email",readonly:"",class:"readonly"},null,512),[[u.Jo,i.form.email]])]),(0,l.Lk)("div",bt,[t[10]||(t[10]=(0,l.Lk)("label",null,"Role",-1)),(0,l.Lk)("input",{value:n.formattedRole,type:"text",readonly:"",class:"readonly"},null,8,yt)]),"Staff"===n.formattedRole||"Admin"===n.formattedRole?((0,l.uX)(),(0,l.CE)("div",Lt,["Staff"===n.formattedRole?((0,l.uX)(),(0,l.CE)("label",_t,"Job Title")):(0,l.Q3)("",!0),"Admin"===n.formattedRole?((0,l.uX)(),(0,l.CE)("label",gt,"Department")):(0,l.Q3)("",!0),"Staff"===n.formattedRole?(0,l.bo)(((0,l.uX)(),(0,l.CE)("input",{key:2,"onUpdate:modelValue":t[2]||(t[2]=e=>i.form.job_title=e),type:"text",placeholder:"Job Title"},null,512)),[[u.Jo,i.form.job_title,void 0,{trim:!0}]]):(0,l.Q3)("",!0),"Admin"===n.formattedRole?(0,l.bo)(((0,l.uX)(),(0,l.CE)("input",{key:3,"onUpdate:modelValue":t[3]||(t[3]=e=>i.form.department=e),type:"text",placeholder:"Department"},null,512)),[[u.Jo,i.form.department,void 0,{trim:!0}]]):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",vt,[t[11]||(t[11]=(0,l.Lk)("label",null,"Phone No.",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.form.phone_no=e),type:"tel",placeholder:"e.g. +60 12-345 6789"},null,512),[[u.Jo,i.form.phone_no,void 0,{trim:!0}]])]),(0,l.Lk)("div",St,[(0,l.Lk)("button",{type:"submit",class:"btn primary",disabled:!n.isDirty||i.saving,title:n.isDirty?"":"No changes to save"},(0,o.v_)(i.saving?"Savingâ€¦":"Save Changes"),9,Ct),(0,l.Lk)("button",{type:"button",class:"btn ghost",onClick:t[5]||(t[5]=(...e)=>n.reset&&n.reset(...e)),disabled:!n.isDirty||i.saving,title:"Reset changes"}," Reset ",8,wt)])],32)),(0,l.Lk)("button",{type:"button",style:{"margin-top":"1rem"},onClick:t[7]||(t[7]=t=>e.$router.push("/dashboard"))},"Back")])}var At={name:"MyProfile",data(){return{baseUrl:O.A.API_BASE_URL,loading:!0,saving:!1,original:null,form:{fullname:"",email:"",role:"",phone_no:""}}},computed:{formattedRole(){const e=this.form.role;if(!e)return"Unknown Role";const t={admin:"Admin",staff:"Staff",doctor:"Doctor"};return t[e]||e.charAt(0).toUpperCase()+e.slice(1)},isDirty(){const e=e=>({fullname:e.fullname||"",phone_no:e.phone_no||"",job_title:e.job_title||"",department:e.department||""});try{return JSON.stringify(e(this.form))!==JSON.stringify(e(this.original||{}))}catch{return!0}}},mounted(){this.loadUserData()},methods:{loadUserData(){const e=JSON.parse(localStorage.getItem("user_info")||"null"),t=e.email.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/user/role-based/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.form=e,this.form.email=e.staff_email||e.doctor_email||e.admin_email||"",this.form.fullname=e.staff_name||e.doctor_name||e.admin_name||"",this.original=JSON.parse(JSON.stringify(this.form))})).catch((e=>{console.error("Error fetching user data:",e)})),this.loading=!1},reset(){this.form=JSON.parse(JSON.stringify(this.original))},async save(){if(!this.isDirty||this.saving)return;this.saving=!0;const e=this.form.email.replace(/\./g,"XYZ");try{const t=await fetch(`${this.baseUrl}/user/edit/role-based/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},body:JSON.stringify({fullname:this.form.fullname,phone_no:this.form.phone_no,role:this.form.role,job_title:this.form.job_title,department:this.form.department})});if(!t.ok)throw new Error(`Save failed (${t.status})`);const s=await t.json(),a=JSON.parse(localStorage.getItem("user_info")||"{}"),l={...a,fullname:s.fullname??this.form.fullname};localStorage.setItem("user_info",JSON.stringify(l)),this.form={...this.form,fullname:l.fullname,phone_no:l.phone_no},this.original=JSON.parse(JSON.stringify(this.form)),this.loadUserData(),window.dispatchEvent(new Event("user-login")),alert("Profile saved ðŸ‘")}catch(t){console.error(t),alert(t.message||"Failed to save profile")}finally{this.saving=!1}}}};const Dt=(0,j.A)(At,[["render",Et],["__scopeId","data-v-681dc49c"]]);var xt=Dt;const It={class:"session-wrap"},Ut={class:"head"},Ft={class:"title"},Nt={class:"muted"},$t={class:"subnav"};function Mt(e,t,s,a,i,n){const r=(0,l.g2)("RouterLink"),d=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",It,[(0,l.Lk)("div",Ut,[(0,l.Lk)("div",null,[(0,l.Lk)("div",Ft,"Session "+(0,o.v_)(n.sessionId),1),(0,l.Lk)("div",Nt,(0,o.v_)(i.staffName||"(no name)")+" â€” "+(0,o.v_)(i.staffEmail),1)]),(0,l.Lk)("button",{class:"ghost",onClick:t[0]||(t[0]=t=>e.$router.push("/dashboard"))},"Back to Dashboard")]),(0,l.Lk)("nav",$t,[(0,l.bF)(r,{to:n.sub("medical-history"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.eW)("Medical History")]))),_:1,__:[1]},8,["to"]),(0,l.bF)(r,{to:n.sub("lifestyle"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[2]||(t[2]=[(0,l.eW)("Lifestyle")]))),_:1,__:[2]},8,["to"]),(0,l.bF)(r,{to:n.sub("physical"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)("Physical Exams")]))),_:1,__:[3]},8,["to"]),(0,l.bF)(r,{to:n.sub("investigations"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)("Investigations")]))),_:1,__:[4]},8,["to"])]),((0,l.uX)(),(0,l.Wv)(d,{key:e.$route.fullPath}))])}const Pt=new Map;async function Bt(e){const t=O.A.API_BASE_URL;if(Pt.has(e))return Pt.get(e);const s=await fetch(`${t}/session-header/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}});if(!s.ok)throw new Error("Failed to fetch session header");const a=await s.json();return Pt.set(e,a),a}function Xt(e,t){Pt.set(e,t)}function Rt(e){Pt.delete(e)}var Ht={provide(){return{refreshSessionHeader:()=>this.refreshHeader(),currentSessionHeader:()=>this.sessionHeader}},data(){return{baseUrl:O.A.API_BASE_URL,staffEmail:"",staffName:"",sessionHeader:null}},name:"ViewSession",computed:{sessionId(){return this.$route.params.sessionId}},async mounted(){this.getStaffInfo(),this.sessionHeader=await Bt(this.sessionId)},methods:{async getStaffInfo(){const e=await fetch(`${this.baseUrl}/staff-session/${this.sessionId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}),t=await e.json();(0,T.$)(e)||(this.staffEmail=t.staff_email,this.staffName=t.staff_name)},async refreshHeader(){const e=this.$route.params.sessionId;this.sessionHeader=await Bt(e),Xt(e,this.sessionHeader)},sub(e){return{name:`session-${e}`,params:{sessionId:this.sessionId},query:this.$route.query}}}};const Ot=(0,j.A)(Ht,[["render",Mt],["__scopeId","data-v-06306129"]]);var Tt=Ot;const Vt={class:"ns-wrap"},jt={class:"head"},Jt={class:"muted"},Qt={class:"subnav"};function Yt(e,t,s,a,i,n){const r=(0,l.g2)("RouterLink"),d=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",Vt,[(0,l.Lk)("div",jt,[(0,l.Lk)("div",null,[t[1]||(t[1]=(0,l.Lk)("div",{class:"title"},"Non-Session Details",-1)),(0,l.Lk)("div",Jt,(0,o.v_)(i.staffEmail||"unable to fetch email"),1)]),(0,l.Lk)("button",{class:"ghost",onClick:t[0]||(t[0]=t=>e.$router.push("/dashboard"))},"Back to Dashboard")]),(0,l.Lk)("nav",Qt,[(0,l.bF)(r,{to:n.sub("staff-info"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[2]||(t[2]=[(0,l.eW)("Personal Info")]))),_:1,__:[2]},8,["to"]),(0,l.bF)(r,{to:n.sub("occ-history"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)("Occupational History")]))),_:1,__:[3]},8,["to"]),(0,l.bF)(r,{to:n.sub("fam-history"),"exact-active-class":"active"},{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)("Family History")]))),_:1,__:[4]},8,["to"])]),((0,l.uX)(),(0,l.Wv)(d,{key:e.$route.fullPath}))])}var Wt={name:"ViewNonSession",provide(){return{currentStaffHeader:()=>this.staffHeader,refreshStaffHeader:()=>this.refreshHeader()}},data(){return{baseUrl:O.A.API_BASE_URL,staffEmail:"",staffName:"",staffHeader:null,loading:!1}},mounted(){this.fetchStaffEmail()},methods:{fetchStaffEmail(){this.staffEmail=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||""},encodeEmailForPath(e){return encodeURIComponent((e||"").replace(/\./g,"XYZ"))},async refreshHeader(){if(this.staffEmail){this.loading=!0;try{const e=this.encodeEmailForPath(this.staffEmail),t=await fetch(`${this.baseUrl}/admin/non-session/staff/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}),s=await t.json(),a=s?.staff||{};this.staffName=a.staff_name||"",this.staffHeader={staff_email:a.staff_email||this.staffEmail,staff_name:a.staff_name||"",job_title:a.job_title||"",phone_no:a.phone_no||""}}catch(e){console.error(e),this.staffHeader={staff_email:this.staffEmail,staff_name:""}}finally{this.loading=!1}}},sub(e){return{name:`ns-${e}`,params:{staffEmail:this.staffEmail}}}}};const zt=(0,j.A)(Wt,[["render",Yt],["__scopeId","data-v-13187a95"]]);var qt=zt;const Kt={class:"stats"},Gt={class:"switcher"};function Zt(e,t,s,a,i,n){const r=(0,l.g2)("AnalyticsAllDashboard"),d=(0,l.g2)("AnalyticsAllCharts"),u=(0,l.g2)("AnalyticsAllDashboard2"),c=(0,l.g2)("AnalyticsAllCharts2");return(0,l.uX)(),(0,l.CE)("div",Kt,[t[5]||(t[5]=(0,l.Lk)("h2",null,"Statistics â€” All Staff",-1)),(0,l.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.push("/dashboard")),style:{"margin-bottom":"18px"}},"Back to Dashboard"),(0,l.Lk)("div",Gt,[(0,l.Lk)("button",{class:(0,o.C4)({active:"dashboard"===e.mode}),onClick:t[1]||(t[1]=t=>e.mode="dashboard")},"Overview",2),(0,l.Lk)("button",{class:(0,o.C4)({active:"charts"===e.mode}),onClick:t[2]||(t[2]=t=>e.mode="charts")},"Charts",2),(0,l.Lk)("button",{class:(0,o.C4)({active:"dashboard2"===e.mode}),onClick:t[3]||(t[3]=t=>e.mode="dashboard2")},"Overview-2",2),(0,l.Lk)("button",{class:(0,o.C4)({active:"charts2"===e.mode}),onClick:t[4]||(t[4]=t=>e.mode="charts2")},"Charts-2",2)]),((0,l.uX)(),(0,l.Wv)(l.PR,null,["dashboard"===e.mode?((0,l.uX)(),(0,l.Wv)(r,{key:0})):"charts"===e.mode?((0,l.uX)(),(0,l.Wv)(d,{key:1})):"dashboard2"===e.mode?((0,l.uX)(),(0,l.Wv)(u,{key:2})):((0,l.uX)(),(0,l.Wv)(c,{key:3}))],1024))])}const es={class:"analytics-charts"},ts={key:0,class:"session-bar"},ss=["title"],as={class:"band-controls"},ls={class:"band-item"},os={class:"band-item"},is={class:"grid"},ns={class:"card wide"},rs={ref:"bmiScatterCanvas",height:"220"},ds={key:0,class:"muted",style:{"margin-top":"8px"}},us={class:"card"},cs={ref:"bmiCanvas",height:"120"},ms={class:"card"},hs={ref:"bpCanvas",height:"120"},ps={class:"card"},ks={ref:"pulseCanvas",height:"120"},fs={class:"card wide"},bs={ref:"lipidsCanvas",height:"160"};function ys(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",es,[t[13]||(t[13]=(0,l.Lk)("h2",null,"Health Statistics Charts",-1)),i.sessionsByPeriod.length?((0,l.uX)(),(0,l.CE)("div",ts,[t[4]||(t[4]=(0,l.Lk)("span",{class:"hint"},"Sessions",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.sessionsByPeriod,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e.bucket,class:"session-pill",title:String(e.bucket)},(0,o.v_)(n.labelFromBucket(e.bucket)),9,ss)))),128))])):(0,l.Q3)("",!0),(0,l.Lk)("div",as,[(0,l.Lk)("div",ls,[t[5]||(t[5]=(0,l.Lk)("label",null,[(0,l.Lk)("b",null,"Low"),(0,l.eW)(" upper bound")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.1","onUpdate:modelValue":t[0]||(t[0]=e=>i.bmiThresholds.lowMax=e),onInput:t[1]||(t[1]=(...e)=>n.onBandInput&&n.onBandInput(...e))},null,544),[[u.Jo,i.bmiThresholds.lowMax,void 0,{number:!0}]])]),(0,l.Lk)("div",os,[t[6]||(t[6]=(0,l.Lk)("label",null,[(0,l.Lk)("b",null,"Fit"),(0,l.eW)(" upper bound")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.1","onUpdate:modelValue":t[2]||(t[2]=e=>i.bmiThresholds.fitMax=e),onInput:t[3]||(t[3]=(...e)=>n.onBandInput&&n.onBandInput(...e))},null,544),[[u.Jo,i.bmiThresholds.fitMax,void 0,{number:!0}]])]),t[7]||(t[7]=(0,l.Lk)("div",{class:"band-legend"},[(0,l.Lk)("span",{class:"dot dot-low"}),(0,l.eW)(" Low "),(0,l.Lk)("span",{class:"dot dot-fit"}),(0,l.eW)(" Fit "),(0,l.Lk)("span",{class:"dot dot-exceed"}),(0,l.eW)(" Exceed ")],-1))]),(0,l.Lk)("div",is,[(0,l.Lk)("div",ns,[t[8]||(t[8]=(0,l.Lk)("div",{class:"card-title"},"BMI Distribution (latest per staff)",-1)),(0,l.Lk)("canvas",rs,null,512),i.bmiPoints.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",ds,"No BMI data found for the selected staff set."))]),(0,l.Lk)("div",us,[t[9]||(t[9]=(0,l.Lk)("div",{class:"card-title"},"BMI Trend (avg)",-1)),(0,l.Lk)("canvas",cs,null,512)]),(0,l.Lk)("div",ms,[t[10]||(t[10]=(0,l.Lk)("div",{class:"card-title"},"Blood Pressure Trend (avg)",-1)),(0,l.Lk)("canvas",hs,null,512)]),(0,l.Lk)("div",ps,[t[11]||(t[11]=(0,l.Lk)("div",{class:"card-title"},"Pulse Trend (avg)",-1)),(0,l.Lk)("canvas",ks,null,512)]),(0,l.Lk)("div",fs,[t[12]||(t[12]=(0,l.Lk)("div",{class:"card-title"},"Key Lipids by Period (Normal / Abnormal / Not done)",-1)),(0,l.Lk)("canvas",bs,null,512)])])])}var Ls=s(17);Ls.t1.register(Ls.ZT,Ls.A6,Ls.No,Ls.E8,Ls.FN,Ls.kc,Ls.PP,Ls.m_,Ls.s$,Ls.dN,Ls.hE,Ls.Pz);var _s={name:"AnalyticsCharts",data(){return{baseUrl:O.A.API_BASE_URL,sessionsByPeriod:[],vitalsSeries:[],labsSeries:[],staffMap:new Map,bmiPoints:[],bmiThresholds:{lowMax:23.5,fitMax:24.9},charts:{bmi:null,bp:null,pulse:null,lipids:null,bmiScatter:null},scatterDebounce:null}},async mounted(){await this.loadData(),this.renderAllCharts(),window.addEventListener("resize",this.resizeCharts)},beforeUnmount(){this.destroyCharts(),window.removeEventListener("resize",this.resizeCharts)},methods:{async loadData(){const e={Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},[t,s,a]=await Promise.all([fetch(`${this.baseUrl}/admin/stats/summary?groupBy=month`,{headers:e}).then((e=>e.json())),fetch(`${this.baseUrl}/admin/stats/vitals?fields=bmi,bp_sys,bp_dia,pulse_bpm&groupBy=month`,{headers:e}).then((e=>e.json())),fetch(`${this.baseUrl}/admin/stats/labs?fields=ldl_result,tchol_result,hdl_result&groupBy=month`,{headers:e}).then((e=>e.json()))]);this.sessionsByPeriod=(t?.sessions_by_period||[]).map((e=>({bucket:e.bucket,count:Number(e.count||0)}))),this.vitalsSeries=s?.series||[],this.labsSeries=a?.series||[];const l=30,o=(t?.top_staff_by_sessions||[]).slice(0,l),i=Array.from(new Set(o.map((e=>e.staff_email)))),n=await Promise.all(i.map((async t=>{const s=t.replace(/\./g,"XYZ"),a=await fetch(`${this.baseUrl}/stats/vitals/${s}`,{headers:e}).then((e=>{if(!(0,T.$)(e))return e.json()})).catch((()=>[]));if(!Array.isArray(a)||!a.length)return null;a.sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date)));const l=a.at(-1),o=l?.bmi;if(null==o||isNaN(o))return null;const i=this.staffMap.get(t)||null;return{email:t,name:i,bmi:Number(o),date:l.session_date}}))),r=n.filter(Boolean)||[];this.bmiPoints=r.map(((e,t)=>({x:t+1,y:e.bmi,email:e.email,name:e.name,date:e.date})))},fmtDate(e){return new Date(e).toLocaleDateString()},labelFromBucket(e){const t=String(e||"");return t.length>=7?t.slice(0,7):t},destroyCharts(){Object.keys(this.charts).forEach((e=>{this.charts[e]&&(this.charts[e].destroy(),this.charts[e]=null)}))},resizeCharts(){Object.values(this.charts).forEach((e=>e&&e.resize()))},renderAllCharts(){this.destroyCharts(),this.renderBMI(),this.renderBP(),this.renderPulse(),this.renderLipids(),this.renderBMIScatter()},renderBMI(){const e=this.$refs.bmiCanvas?.getContext("2d");if(!e)return;const t=this.vitalsSeries.map((e=>this.labelFromBucket(e.bucket))),s=this.vitalsSeries.map((e=>e.avg_bmi??null));this.charts.bmi=new Ls.t1(e,{type:"line",data:{labels:t,datasets:[{label:"BMI (avg)",data:s,tension:.3,fill:!1,pointRadius:4}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{mode:"index",intersect:!1},datalabels:{align:"top",anchor:"end",offset:4,color:"#4b5563",font:{size:11,weight:"bold"},formatter:e=>null!=e?Number(e).toFixed(1):"",display:"auto"}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"BMI"}},x:{title:{display:!0,text:"Period"}}}}})},renderBP(){const e=this.$refs.bpCanvas?.getContext("2d");if(!e)return;const t=this.vitalsSeries.map((e=>this.labelFromBucket(e.bucket))),s=this.vitalsSeries.map((e=>e.avg_bp_sys??null)),a=this.vitalsSeries.map((e=>e.avg_bp_dia??null));this.charts.bp=new Ls.t1(e,{type:"line",data:{labels:t,datasets:[{label:"Systolic (avg)",data:s,tension:.3,pointRadius:3},{label:"Diastolic (avg)",data:a,tension:.3,pointRadius:3}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{mode:"index",intersect:!1},datalabels:{align:"top",anchor:"end",offset:4,color:"#4b5563",font:{size:10,weight:"bold"},backgroundColor:"rgba(255,255,255,0.8)",borderRadius:4,padding:2,formatter:e=>null!=e?Math.round(e):"",display:"auto"}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"mmHg"}},x:{title:{display:!0,text:"Period"}}}}})},renderPulse(){const e=this.$refs.pulseCanvas?.getContext("2d");if(!e)return;const t=this.vitalsSeries.map((e=>this.labelFromBucket(e.bucket))),s=this.vitalsSeries.map((e=>e.avg_pulse_bpm??null));this.charts.pulse=new Ls.t1(e,{type:"line",data:{labels:t,datasets:[{label:"Pulse (avg bpm)",data:s,tension:.3,pointRadius:3}]},options:{responsive:!0,plugins:{legend:{display:!0},datalabels:{align:"top",anchor:"end",offset:4,color:"#4b5563",font:{size:11,weight:"bold"},formatter:e=>null!=e?Number(e).toFixed(1):"",display:"auto"}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"bpm"}},x:{title:{display:!0,text:"Period"}}}}})},renderLipids(){const e=this.$refs.lipidsCanvas?.getContext("2d");if(!e)return;const t=this.labsSeries.map((e=>this.labelFromBucket(e.bucket))),s=this.labsSeries.map((e=>Number(e.ldl_result_normal||0)+Number(e.tchol_result_normal||0)+Number(e.hdl_result_normal||0))),a=this.labsSeries.map((e=>Number(e.ldl_result_abnormal||0)+Number(e.tchol_result_abnormal||0)+Number(e.hdl_result_abnormal||0))),l=this.labsSeries.map((e=>Number(e.ldl_result_not_done||0)+Number(e.tchol_result_not_done||0)+Number(e.hdl_result_not_done||0)));this.charts.lipids=new Ls.t1(e,{type:"bar",data:{labels:t,datasets:[{label:"Normal",data:s,stack:"lipids",backgroundColor:"#008000"},{label:"Abnormal",data:a,stack:"lipids",backgroundColor:"#ff0000"},{label:"Not done",data:l,stack:"lipids",backgroundColor:"#cccccc"}]},options:{responsive:!0,plugins:{legend:{display:!0}},scales:{x:{stacked:!0,title:{display:!0,text:"Period"}},y:{stacked:!0,beginAtZero:!0,ticks:{stepSize:1},title:{display:!0,text:"Count of Tests"}}}}})},onBandInput(){clearTimeout(this.scatterDebounce),this.scatterDebounce=setTimeout((()=>{this.renderBMIScatter()}),120)},renderBMIScatter(){const e=this.$refs.bmiScatterCanvas;if(!e)return;const t=e.getContext("2d");if(!t)return;if(this.charts.bmiScatter){try{this.charts.bmiScatter.stop()}catch(u){}try{this.charts.bmiScatter.destroy()}catch(u){}this.charts.bmiScatter=null}const{lowMax:s,fitMax:a}=this.bmiThresholds,l=[],o=[],i=[],n=[];this.bmiPoints.forEach(((e,t)=>{n[t]=e.name||e.email;const r={x:e.x,y:e.y};e.y<=s?l.push(r):e.y<=a?o.push(r):i.push(r)}));const r={id:"thresholdLines",afterDraw:e=>{const{ctx:t,chartArea:l,scales:o}=e||{};if(!t||!l||!o?.y)return;const i=(e,s=[4,3])=>{const a=o.y.getPixelForValue(e);t.save(),t.setLineDash(s),t.strokeStyle="#718096",t.lineWidth=1,t.beginPath(),t.moveTo(l.left,a),t.lineTo(l.right,a),t.stroke(),t.restore()};i(s),i(a,[6,3])}},d=[{label:"Low",data:l,pointRadius:4,backgroundColor:"#63b3ed"},{label:"Fit",data:o,pointRadius:4,backgroundColor:"#48bb78"},{label:"Exceed",data:i,pointRadius:4,backgroundColor:"#f56565"}];requestAnimationFrame((()=>{this.charts.bmiScatter=new Ls.t1(t,{type:"scatter",data:{datasets:d},options:{animation:!1,responsive:!0,plugins:{legend:{display:!0},tooltip:{callbacks:{title:e=>{const t=e[0]?.parsed?.x,s=(t??1)-1;return n[s]||`Staff #${t}`},label:e=>`BMI: ${e.parsed.y}`}}},scales:{x:{type:"linear",title:{display:!0,text:"Staff (top by sessions)"},ticks:{stepSize:1,callback:e=>{const t=Math.round(e)-1,s=n[t];if(!s)return"";const a=String(s);return a.length>12?a.slice(0,12)+"â€¦":a}},min:.5,max:Math.max(1.5,this.bmiPoints.length+.5)},y:{title:{display:!0,text:"BMI"},beginAtZero:!1}}},plugins:[r]})}))}}};const gs=(0,j.A)(_s,[["render",ys],["__scopeId","data-v-1d99bed4"]]);var vs=gs;const Ss={class:"abnormality-drilldown container"},Cs={class:"filters"},ws={class:"filter-group"},Es={class:"filter-group"},As={class:"filter-group"},Ds={class:"date-row"},xs=["disabled"],Is={key:0,class:"spinner"},Us={key:1,class:"std-table"},Fs={key:2,class:"muted"};function Ns(e,t,s,a,i,n){const r=(0,l.g2)("VueDatePicker");return(0,l.uX)(),(0,l.CE)("div",Ss,[t[13]||(t[13]=(0,l.Lk)("h2",null,"Lab Abnormality Drill-down",-1)),(0,l.Lk)("div",Cs,[(0,l.Lk)("div",ws,[t[6]||(t[6]=(0,l.Lk)("label",null,"Type",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.type=e)},t[5]||(t[5]=[(0,l.Fv)('<option value="cholesterol" data-v-a5eb9ffe>Cholesterol (LDL, TChol, HDL, TG)</option><option value="liver" data-v-a5eb9ffe>Liver Function (Bilirubin, GGT, AST, ALT)</option><option value="glucose" data-v-a5eb9ffe>Glucose (FBS, RBS)</option><option value="uric_acid" data-v-a5eb9ffe>Uric Acid</option><option value="renal" data-v-a5eb9ffe>Renal Panel (BUN, Creat, Electrolytes)</option>',5)]),512),[[u.u1,i.type]])]),(0,l.Lk)("div",Es,[t[8]||(t[8]=(0,l.Lk)("label",null,"Result Status",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.result_status=e)},t[7]||(t[7]=[(0,l.Lk)("option",{value:"all"},"All",-1),(0,l.Lk)("option",{value:"abnormal"},"Abnormal only",-1),(0,l.Lk)("option",{value:"normal"},"Normal only",-1),(0,l.Lk)("option",{value:"not done"},"Not done only",-1)]),512),[[u.u1,i.result_status]])]),(0,l.Lk)("div",As,[t[10]||(t[10]=(0,l.Lk)("label",null,"Date Range",-1)),(0,l.Lk)("div",Ds,[(0,l.bF)(r,{modelValue:i.from,"onUpdate:modelValue":t[2]||(t[2]=e=>i.from=e),"max-date":new Date,"enable-time-picker":!1,"auto-apply":"",placeholder:"Start Date"},null,8,["modelValue","max-date"]),t[9]||(t[9]=(0,l.Lk)("span",null,"-",-1)),(0,l.bF)(r,{modelValue:i.to,"onUpdate:modelValue":t[3]||(t[3]=e=>i.to=e),"max-date":new Date,"enable-time-picker":!1,"auto-apply":"",placeholder:"End Date"},null,8,["modelValue","max-date"])])]),(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>n.load&&n.load(...e)),disabled:i.loading},"Refresh",8,xs)]),i.loading?((0,l.uX)(),(0,l.CE)("div",Is,"Loadingâ€¦")):((0,l.uX)(),(0,l.CE)("table",Us,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[t[11]||(t[11]=(0,l.Lk)("th",null,"Staff",-1)),t[12]||(t[12]=(0,l.Lk)("th",null,"Session Date",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.displayedFields,(e=>((0,l.uX)(),(0,l.CE)("th",{key:e},(0,o.v_)(n.formatField(e)),1)))),128))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.results,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.session_id},[(0,l.Lk)("td",null,(0,o.v_)(e.staff_name),1),(0,l.Lk)("td",null,(0,o.v_)(n.formatDateShort(e.session_date)),1),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.displayedFields,(t=>((0,l.uX)(),(0,l.CE)("td",{key:t,class:(0,o.C4)(n.highlightCell(e[t]))},(0,o.v_)(e[t]||"â€”"),3)))),128))])))),128))])])),i.loading||0!==i.results.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("p",Fs,"No records found for the selected filters."))])}function $s(e,t={}){if(!e)return"-";const s=e instanceof Date?e:new Date(e);return isNaN(s)?"-":new Intl.DateTimeFormat("en-MY",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,...t}).format(s)}function Ms(e){return $s(e,{hour:void 0,minute:void 0})}var Ps=s(5838);const Bs={ldl_result:"LDL",tchol_result:"Total Chol",hdl_result:"HDL",tg_result:"TG",tbil_result:"Total Bilirubin",ggt_result:"GGT",ast_result:"AST",alt_result:"ALT",fbs_result:"FBS",rbs_result:"RBS",ua_result:"Uric Acid",bu_result:"Urea",creat_result:"Creatinine",na_result:"Na",k_result:"K",cl_result:"Cl"},Xs={cholesterol:["ldl_result","tchol_result","hdl_result","tg_result"],liver:["tbil_result","ggt_result","ast_result","alt_result"],glucose:["fbs_result","rbs_result"],uric_acid:["ua_result"],renal:["bu_result","creat_result","na_result","k_result","cl_result"]};var Rs={components:{VueDatePicker:Ps.V},data(){return{type:"cholesterol",result_status:"all",from:null,to:null,debounceTimer:null,abortController:null,results:[],loading:!1}},computed:{displayedFields(){return Xs[this.type]}},methods:{formatDateShort:Ms,debouncedLoad(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{this.load()}),500)},async load(){const e=e=>{if(!e)return null;if("string"===typeof e)return e;try{const t=6e4*e.getTimezoneOffset(),s=new Date(e-t).toISOString().slice(0,10);return s}catch(t){return null}};this.loading=!0;const t={Authorization:`Bearer ${localStorage.getItem("jwt_token")}`};let s=`${O.A.API_BASE_URL}/admin/stats/staff-abnormality?type=${this.type}&result_status=${this.result_status}`;const a=e(this.from),l=e(this.to);a&&(s+=`&from=${a}`),l&&(s+=`&to=${l}`);try{const e=await fetch(s,{headers:t});if((0,T.$)(e))return;if(!e.ok)throw new Error("Failed");const a=await e.json();this.results=a.results||[]}catch(o){"AbortError"!==o.name&&(console.error(o),alert("Failed to load data"))}finally{this.loading=!1}},formatField(e){return Bs[e]||e},highlightCell(e){return e?"abnormal"===e.toLowerCase()?"abnormal":"normal"===e.toLowerCase()?"normal":"":""},gotoSession(e){this.$router.push(`/staff/session/${e}/investigations`)}},mounted(){this.load()},watch:{from(){this.debouncedLoad()},to(){this.debouncedLoad()},type(){this.debouncedLoad()},result_status(){this.debouncedLoad()}}};const Hs=(0,j.A)(Rs,[["render",Ns],["__scopeId","data-v-a5eb9ffe"]]);var Os=Hs;const Ts={class:"abnormality-dashboard"},Vs={class:"top-controls"},js={class:"summary"},Js={key:0,class:"red"},Qs={class:"groups-grid"},Ys={class:"group-card"},Ws={ref:"cholesterolCanvas"},zs={class:"group-card"},qs={ref:"liverCanvas"},Ks={class:"group-card"},Gs={ref:"glucoseCanvas"},Zs={class:"group-card"},ea={ref:"renalCanvas"},ta={class:"group-card wide"},sa={ref:"otherCanvas"};function aa(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Ts,[t[7]||(t[7]=(0,l.Lk)("h2",null,"Company Lab Abnormality Dashboard (Latest Session per Staff)",-1)),(0,l.Lk)("div",Vs,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.selectedYear=e)},[t[1]||(t[1]=(0,l.Lk)("option",{value:null},"All Years",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e},(0,o.v_)(e),1)))),128))],512),[[u.u1,i.selectedYear]]),(0,l.Lk)("div",js,[(0,l.eW)((0,o.v_)(n.latestSessionsCount)+" unique staff checked â€¢ ",1),n.totalAbnormal>0?((0,l.uX)(),(0,l.CE)("strong",Js,(0,o.v_)(n.totalAbnormal)+" abnormal results found",1)):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Qs,[(0,l.Lk)("div",Ys,[t[2]||(t[2]=(0,l.Lk)("h3",null,"Cholesterol Profile",-1)),(0,l.Lk)("canvas",Ws,null,512)]),(0,l.Lk)("div",zs,[t[3]||(t[3]=(0,l.Lk)("h3",null,"Liver Function",-1)),(0,l.Lk)("canvas",qs,null,512)]),(0,l.Lk)("div",Ks,[t[4]||(t[4]=(0,l.Lk)("h3",null,"Glucose",-1)),(0,l.Lk)("canvas",Gs,null,512)]),(0,l.Lk)("div",Zs,[t[5]||(t[5]=(0,l.Lk)("h3",null,"Renal Panel",-1)),(0,l.Lk)("canvas",ea,null,512)]),(0,l.Lk)("div",ta,[t[6]||(t[6]=(0,l.Lk)("h3",null,"Other Important Tests",-1)),(0,l.Lk)("canvas",sa,null,512)])])])}var la=s(6591),oa=s(3408);la.Ay.register(oa.A);const ia={cholesterol:{title:"Cholesterol Profile",tests:[{label:"LDL (>3.4)",field:"ldl_result"},{label:"Total Chol (>5.2)",field:"tchol_result"},{label:"HDL (<1.0 M / <1.3 F)",field:"hdl_result"},{label:"Triglycerides (>1.7)",field:"tg_result"}],color:"#f97316"},liver:{title:"Liver Function",tests:[{label:"ALT (<66)",field:"alt_result"},{label:"AST (<51)",field:"ast_result"},{label:"GGT (<51)",field:"ggt_result"},{label:"Bilirubin (>21)",field:"tbil_result"}],color:"#dc2626"},glucose:{title:"Glucose",tests:[{label:"FBS (>5.6)",field:"fbs_result"},{label:"RBS (>7.8)",field:"rbs_result"}],color:"#7c3aed"},renal:{title:"Renal Panel",tests:[{label:"Creatinine (>115)",field:"creat_result"},{label:"Urea (>7.1)",field:"bu_result"},{label:"Uric Acid (>420)",field:"ua_result"}],color:"#0891b2"},other:{title:"Other Important Tests",tests:[{label:"Sodium (â‰ 135-145)",field:"na_result"},{label:"Potassium (â‰ 3.5-5.0)",field:"k_result"},{label:"Chloride (â‰ 98-107)",field:"cl_result"}],color:"#6b7280"}};var na={data(){return{selectedYear:null,latestPerStaff:[],charts:{},loading:!0}},computed:{years(){const e=[...new Set(this.latestPerStaff.filter((e=>e.session_date)).map((e=>new Date(e.session_date).getFullYear())))];return e.sort(((e,t)=>t-e))},filtered(){return this.selectedYear?this.latestPerStaff.filter((e=>new Date(e.session_date).getFullYear()===this.selectedYear)):this.latestPerStaff},latestSessionsCount(){return this.filtered.length},totalAbnormal(){let e=0;return Object.values(ia).forEach((t=>{t.tests.forEach((t=>{e+=this.filtered.filter((e=>"abnormal"===e[t.field]?.toLowerCase())).length}))})),e}},watch:{selectedYear(){this.renderAll()}},async mounted(){await this.loadLatestPerStaff(),this.renderAll()},methods:{async loadLatestPerStaff(){this.loading=!0;try{const e=await fetch(`${O.A.API_BASE_URL}/admin/stats/latest-lab-per-staff`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}});if(!e.ok)throw new Error(e.statusText);if((0,T.$)(e))return;const t=await e.json();this.latestPerStaff=t.results||[],console.log("Data Loaded:",this.latestPerStaff.length,"rows")}catch(e){console.error("API Error:",e),this.latestPerStaff=[]}this.loading=!1},renderAll(){this.$nextTick((()=>{this.destroyAll(),Object.keys(ia).forEach((e=>{try{this.renderGroup(e)}catch(t){console.error(`Failed to render chart for ${e}:`,t)}}))}))},destroyAll(){Object.values(this.charts).forEach((e=>e?.destroy())),this.charts={}},renderGroup(e){const t=ia[e],s=this.$refs[e+"Canvas"];if(!s)return void console.warn(`CANVAS MISSING: Could not find <canvas ref="${e}Canvas"> in your HTML.`);const a=this.filtered,l=a.length||1,o=[],i=[],n=[];t.tests.forEach((e=>{const t=a.filter((t=>"abnormal"===t[e.field]?.toLowerCase())).length;o.push(e.label),i.push(t),n.push(Number((t/l*100).toFixed(1)))})),this.charts[e]=new la.Ay(s,{type:"bar",data:{labels:o,datasets:[{data:n,backgroundColor:t.color+"cc",borderColor:t.color,borderWidth:2,borderRadius:8,barThickness:32}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`${e.parsed.x}% (${i[e.dataIndex]} staff)`}},datalabels:{anchor:"end",align:"end",color:"#1a1a1a",font:{weight:"bold"},formatter:(e,t)=>i[t.dataIndex]>0?i[t.dataIndex]:""}},scales:{x:{max:100,ticks:{callback:e=>e+"%"},beginAtZero:!0},y:{ticks:{font:{size:12}}}}}})}},beforeUnmount(){this.destroyAll()}};const ra=(0,j.A)(na,[["render",aa],["__scopeId","data-v-099bc841"]]);var da=ra,ua={name:"AnalyticsAllPage",data:()=>({mode:"dashboard"}),components:{AnalyticsAllCharts:vs,AnalyticsAllDashboard:Q,AnalyticsAllCharts2:da,AnalyticsAllDashboard2:Os}};const ca=(0,j.A)(ua,[["render",Zt]]);var ma=ca;const ha={class:"manage-users"},pa={class:"filters"},ka={class:"actions",style:{"margin-bottom":"18px"}},fa={key:0},ba={key:0,style:{color:"grey"}},ya={class:"actions"},La=["onClick"],_a=["onClick"],ga=["onClick"],va=["onClick"];function Sa(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",ha,[t[8]||(t[8]=(0,l.Lk)("h2",null,"Manage Users",-1)),(0,l.Lk)("div",pa,[t[4]||(t[4]=(0,l.Lk)("label",{for:"roleFilter"},"Filter by Role:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.roleFilter=e),id:"roleFilter"},t[3]||(t[3]=[(0,l.Lk)("option",{value:""},"All",-1),(0,l.Lk)("option",{value:"doctor"},"Doctor",-1),(0,l.Lk)("option",{value:"staff"},"Staff",-1),(0,l.Lk)("option",{value:"admin"},"Admin",-1)]),512),[[u.u1,i.roleFilter]])]),(0,l.Lk)("div",ka,[(0,l.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.registerUser&&n.registerUser(...e)),style:{color:"white",background:"blue"}},"Register New User"),(0,l.Lk)("button",{onClick:t[2]||(t[2]=t=>e.$router.push("/dashboard")),style:{"margin-left":"8px"}},"Back to Dashboard")]),(0,l.Lk)("table",null,[t[7]||(t[7]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"User ID"),(0,l.Lk)("th",null,"Full Name"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"Role"),(0,l.Lk)("th",null,"Actions")])],-1)),(0,l.Lk)("tbody",null,[0===n.filteredUsers.length?((0,l.uX)(),(0,l.CE)("tr",fa,t[5]||(t[5]=[(0,l.Lk)("td",{colspan:"5",class:"text-center py-4"},"Loading...",-1)]))):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(n.filteredUsers,(s=>((0,l.uX)(),(0,l.CE)("tr",{key:s.email},[(0,l.Lk)("td",null,(0,o.v_)(s.user_id),1),(0,l.Lk)("td",null,(0,o.v_)(s.fullname||"-"),1),(0,l.Lk)("td",null,[(0,l.eW)((0,o.v_)(s.email)+" ",1),s.email===n.currentAdmin?((0,l.uX)(),(0,l.CE)("span",ba,t[6]||(t[6]=[(0,l.Lk)("i",null,"(self)",-1)]))):(0,l.Q3)("",!0)]),(0,l.Lk)("td",null,(0,o.v_)(n.formatRole(s.role)),1),(0,l.Lk)("td",ya,[(0,l.Lk)("button",{onClick:e=>n.editUser(s)},"Edit",8,La),(0,l.Lk)("button",{onClick:t=>e.$router.push(`/admin/view-user/${s.email}`)},"View Info (role-based)",8,_a),(0,l.Lk)("button",{onClick:t=>e.$router.push(`/reset-password/${s.user_id}/${s.email}`)},"Reset Password",8,ga),(0,l.Lk)("button",{class:"danger",onClick:e=>n.deleteUser(s)},"Delete",8,va)])])))),128))])])])}var Ca={name:"ManageUsers",data(){return{baseUrl:O.A.API_BASE_URL,roleFilter:"",users:[]}},computed:{filteredUsers(){return this.roleFilter?this.users.filter((e=>e.role===this.roleFilter)):this.users},currentAdmin(){return JSON.parse(localStorage.getItem("user_info")).email}},methods:{registerUser(){this.$router.push("/admin/register-user")},formatRole(e){if(!e)return"Unknown";const t={admin:"Admin",doctor:"Doctor",staff:"Staff"};return t[e]||e.charAt(0).toUpperCase()+e.slice(1)},editUser(e){this.$router.push(`/admin/edit-user/${e.user_id}`)},deleteUser(e){if(confirm(`Delete ${e.fullname}?`)){const t=localStorage.getItem("jwt_token");fetch(`${this.baseUrl}/admin/user/${e.user_id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Failed to delete user");window.location.reload()})).catch((e=>{alert("Error deleting user: "+e.message)}))}}},mounted(){const e=localStorage.getItem("jwt_token");fetch(`${this.baseUrl}/admin/users`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.users=e})).catch((e=>{console.error("Failed to fetch users:",e)}))}};const wa=(0,j.A)(Ca,[["render",Sa],["__scopeId","data-v-6bbb021d"]]);var Ea=wa;const Aa={class:"reset-pass"};function Da(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Aa,[(0,l.Lk)("h2",null,(0,o.v_)(n.title),1),(0,l.Lk)("form",{onSubmit:t[2]||(t[2]=(0,u.D$)(((...e)=>n.resetPassword&&n.resetPassword(...e)),["prevent"]))},[(0,l.Lk)("div",null,[t[3]||(t[3]=(0,l.Lk)("label",null,"User ID: ",-1)),(0,l.Lk)("span",null,[(0,l.Lk)("b",null,(0,o.v_)(i.userId),1)])]),(0,l.Lk)("div",null,[t[4]||(t[4]=(0,l.Lk)("label",null,"Email: ",-1)),(0,l.Lk)("span",null,[(0,l.Lk)("b",null,(0,o.v_)(i.userEmail),1)])]),(0,l.Lk)("div",null,[t[5]||(t[5]=(0,l.Lk)("label",{for:"newPassword"},"New Password: ",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.newPassword=e),required:""},null,512),[[u.Jo,i.newPassword]])]),t[6]||(t[6]=(0,l.Lk)("button",{type:"submit"},"Reset Password",-1)),(0,l.Lk)("button",{type:"button",onClick:t[1]||(t[1]=t=>e.$router.back()),style:{"margin-left":"1rem"}},"Back")],32)])}var xa={data(){return{baseUrl:O.A.API_BASE_URL,newPassword:"",isAdmin:!1,userId:"",userEmail:"",adminName:""}},computed:{title(){return this.isAdmin?"Reset Password - Action by (Admin): "+this.adminName:"Reset Your Password"}},mounted(){const e=JSON.parse(localStorage.getItem("user_info")),t=this.$route.params.userId||e.id;this.userEmail=this.$route.params.userEmail||e.email,this.isAdmin="admin"===e.role,this.adminName=e.fullname,this.userId=t},methods:{resetPassword(){const e=window.confirm("Do you sure you want to reset password for this user?");if(!e)return void alert("Password reset cancelled.");const t=this.isAdmin?`${this.baseUrl}/admin/user/reset-password/${this.userId}`:`${this.baseUrl}/user/reset-password/${this.userId}`;fetch(t,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify({new_password:this.newPassword})}).then((e=>e.json())).then((()=>{alert("Password reset successfully"),this.$router.push("/admin/manage-users")})).catch((e=>{console.error("Error resetting password:",e)}))}}};const Ia=(0,j.A)(xa,[["render",Da],["__scopeId","data-v-a29bab2a"]]);var Ua=Ia;const Fa={class:"register-user"},Na=["for"],$a=["for"],Ma=["type"],Pa={key:2},Ba={key:0,class:"divider"},Xa={key:1,class:"option-line"},Ra={key:2,class:"option-line"},Ha={key:3,class:"grid2"},Oa={class:"actions"},Ta=["disabled"];function Va(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Fa,[t[25]||(t[25]=(0,l.Lk)("h2",null,"Register User",-1)),(0,l.Lk)("form",{onSubmit:t[10]||(t[10]=(0,u.D$)(((...e)=>n.registerUser&&n.registerUser(...e)),["prevent"]))},[(0,l.Lk)("div",null,[t[11]||(t[11]=(0,l.Lk)("label",{for:"fullname"},"Full Name: ",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.form.fullname=e),id:"fullname",type:"text",required:""},null,512),[[u.Jo,i.form.fullname,void 0,{trim:!0}]])]),(0,l.Lk)("div",null,[this.isAdminSelected?((0,l.uX)(),(0,l.CE)("label",{key:0,for:e.email},"Username: ",8,Na)):((0,l.uX)(),(0,l.CE)("label",{key:1,for:e.email},"Email: ",8,$a)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.form.email=e),id:"email",type:this.isAdminSelected?"text":"email",required:""},null,8,Ma),[[u.hp,i.form.email,void 0,{trim:!0}]]),t[12]||(t[12]=(0,l.Lk)("br",null,null,-1)),this.isAdminSelected?((0,l.uX)(),(0,l.CE)("small",Pa,"(Username instead of email for Admin account to avoid confusion)")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",null,[t[13]||(t[13]=(0,l.Lk)("label",{for:"password"},"Password: ",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.form.password=e),id:"password",type:"text",required:""},null,512),[[u.Jo,i.form.password]])]),(0,l.Lk)("div",null,[t[15]||(t[15]=(0,l.Lk)("label",{for:"role"},"Role: ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.form.role=e),id:"role",required:""},t[14]||(t[14]=[(0,l.Lk)("option",{value:"",disabled:""},"Select role",-1),(0,l.Lk)("option",{value:"staff"},"Staff",-1),(0,l.Lk)("option",{value:"doctor"},"Doctor",-1),(0,l.Lk)("option",{value:"admin"},"Admin",-1)]),512),[[u.u1,i.form.role]])]),n.isStaff?((0,l.uX)(),(0,l.CE)("div",Ba)):(0,l.Q3)("",!0),n.isStaff?((0,l.uX)(),(0,l.CE)("div",Xa,[(0,l.Lk)("label",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>i.form.init_staff_profile=e)},null,512),[[u.lH,i.form.init_staff_profile]]),t[16]||(t[16]=(0,l.eW)(" Create staff profile record "))]),t[17]||(t[17]=(0,l.Lk)("small",{class:"muted"},[(0,l.eW)("Creates a minimal row in "),(0,l.Lk)("code",null,"staff"),(0,l.eW)(" if not present.")],-1))])):(0,l.Q3)("",!0),n.isStaff?((0,l.uX)(),(0,l.CE)("div",Ra,[(0,l.Lk)("label",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>i.form.init_session=e)},null,512),[[u.lH,i.form.init_session]]),t[18]||(t[18]=(0,l.eW)(" Create initial session now "))]),t[19]||(t[19]=(0,l.Lk)("small",{class:"muted"},"Initialize session-linked tables (empty).",-1))])):(0,l.Q3)("",!0),n.isStaff&&i.form.init_session?((0,l.uX)(),(0,l.CE)("div",Ha,[(0,l.Lk)("label",null,[t[20]||(t[20]=(0,l.eW)(" Session Date ")),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=e=>i.form.session_date=e)},null,512),[[u.Jo,i.form.session_date]])]),(0,l.Lk)("label",null,[t[22]||(t[22]=(0,l.eW)(" Session Type ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.form.session_type=e)},t[21]||(t[21]=[(0,l.Fv)('<option value="annual" data-v-acb2d5b2>Annual</option><option value="pre-employment" data-v-acb2d5b2>Pre-employment</option><option value="followup" data-v-acb2d5b2>Follow-up</option><option value="return-to-work" data-v-acb2d5b2>Return to Work</option><option value="ad-hoc" data-v-acb2d5b2>Ad-hoc</option>',5)]),512),[[u.u1,i.form.session_type]])]),(0,l.Lk)("label",null,[t[24]||(t[24]=(0,l.eW)(" Status ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.form.session_status=e)},t[23]||(t[23]=[(0,l.Lk)("option",{value:"draft"},"draft",-1),(0,l.Lk)("option",{value:"submitted"},"submitted",-1),(0,l.Lk)("option",{value:"locked"},"locked",-1)]),512),[[u.u1,i.form.session_status]])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Oa,[(0,l.Lk)("button",{type:"submit",disabled:i.submitting},(0,o.v_)(i.submitting?"Registeringâ€¦":"Register"),9,Ta),(0,l.Lk)("button",{type:"button",class:"ghost",onClick:t[9]||(t[9]=t=>e.$router.push("/admin/manage-users"))}," Back ")])],32),i.message?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,o.C4)([{success:i.success,error:!i.success},"msg"])},(0,o.v_)(i.message),3)):(0,l.Q3)("",!0)])}var ja={name:"RegisterUser",data(){return{baseUrl:O.A.API_BASE_URL,submitting:!1,isAdminSelected:!1,form:{fullname:"",email:"",password:"",role:"",init_staff_profile:!0,init_session:!0,session_date:(new Date).toISOString().slice(0,10),session_type:"annual",session_status:"draft",duplicate_recent:!1},message:"",success:!1}},computed:{isStaff(){return"staff"===this.form.role}},watch:{"form.role"(e){"staff"!==e&&(this.form.init_staff_profile=!0,this.form.init_session=!0,this.form.duplicate_recent=!1),this.isAdminSelected="admin"===e}},methods:{async registerUser(){this.message="",this.success=!1,this.submitting=!0;try{const e=localStorage.getItem("jwt_token"),t={fullname:this.form.fullname,email:this.form.email,password:this.form.password,role:this.form.role,init_staff_profile:this.form.init_staff_profile??!0,init_session:this.isStaff&&!!this.form.init_session,session_date:this.isStaff&&this.form.init_session?this.form.session_date:null,session_type:this.isStaff&&this.form.init_session?this.form.session_type:null,session_status:this.isStaff&&this.form.init_session?this.form.session_status:null,duplicate_recent:!(!this.isStaff||!this.form.init_session)&&!!this.form.duplicate_recent},s=await fetch(`${this.baseUrl}/admin/register`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const e=await s.text();throw new Error(e||"Registration failed")}this.message="User registered successfully",this.success=!0,this.form={fullname:"",email:"",password:"",role:"",init_staff_profile:!1,init_session:!1,session_date:(new Date).toISOString().slice(0,10),session_type:"annual",session_status:"draft",duplicate_recent:!1}}catch(e){this.message=e.message||"Registration failed",this.success=!1}finally{this.submitting=!1}}}};const Ja=(0,j.A)(ja,[["render",Va],["__scopeId","data-v-acb2d5b2"]]);var Qa=Ja;const Ya={class:"edit-user"},Wa={key:0,style:{color:"#888"}},za=["for"],qa=["for"],Ka=["type"],Ga={key:2,style:{color:"#888"}},Za={key:3},el={key:0,style:{color:"#888"}},tl=["disabled"];function sl(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Ya,[t[13]||(t[13]=(0,l.Lk)("h2",null,"Edit User Info",-1)),(0,l.Lk)("form",{onSubmit:t[4]||(t[4]=(0,u.D$)(((...e)=>n.updateUser&&n.updateUser(...e)),["prevent"]))},[(0,l.Lk)("div",null,[t[5]||(t[5]=(0,l.Lk)("label",{for:"fullname"},"Full Name: ",-1)),t[6]||(t[6]=(0,l.Lk)("br",null,null,-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.user.fullname=e),required:""},null,512),[[u.Jo,i.user.fullname]]),t[7]||(t[7]=(0,l.Lk)("br",null,null,-1)),i.originalUser.fullname&&i.user.fullname!==i.originalUser.fullname?((0,l.uX)(),(0,l.CE)("span",Wa," (Current: "+(0,o.v_)(i.originalUser.fullname)+") ",1)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",null,[this.isAdminSelected?((0,l.uX)(),(0,l.CE)("label",{key:0,for:e.email},"Username: ",8,za)):((0,l.uX)(),(0,l.CE)("label",{key:1,for:e.email},"Email: ",8,qa)),t[8]||(t[8]=(0,l.Lk)("br",null,null,-1)),(0,l.bo)((0,l.Lk)("input",{type:this.isAdminSelected?"text":"email","onUpdate:modelValue":t[1]||(t[1]=e=>i.user.email=e),required:""},null,8,Ka),[[u.hp,i.user.email]]),t[9]||(t[9]=(0,l.Lk)("br",null,null,-1)),i.originalUser.email&&i.user.email!==i.originalUser.email?((0,l.uX)(),(0,l.CE)("span",Ga," (Current: "+(0,o.v_)(i.originalUser.email)+") ",1)):(0,l.Q3)("",!0),t[10]||(t[10]=(0,l.Lk)("br",null,null,-1)),this.isAdminSelected?((0,l.uX)(),(0,l.CE)("small",Za,"(Username instead of email for Admin account to avoid confusion)")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",null,[t[12]||(t[12]=(0,l.Lk)("label",{for:"role"},"Role: ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.user.role=e),required:""},t[11]||(t[11]=[(0,l.Lk)("option",{value:"admin"},"Admin",-1),(0,l.Lk)("option",{value:"doctor"},"Doctor",-1),(0,l.Lk)("option",{value:"staff"},"Staff",-1),(0,l.Lk)("option",{value:"restricted"},"Restricted",-1)]),512),[[u.u1,i.user.role]]),i.originalUser.role&&i.user.role!==i.originalUser.role?((0,l.uX)(),(0,l.CE)("span",el," (Current: "+(0,o.v_)(i.originalUser.role)+") ",1)):(0,l.Q3)("",!0)]),(0,l.Lk)("button",{class:"action-btn",type:"submit",disabled:!n.isModalChanged},"Save Changes",8,tl),(0,l.Lk)("button",{type:"button",onClick:t[3]||(t[3]=t=>e.$router.push("/admin/manage-users")),style:{"margin-left":"1rem"}},"Back")],32)])}var al={data(){return{baseUrl:O.A.API_BASE_URL,isAdminSelected:!1,user:{user_id:"",fullname:"",email:"",role:""},originalUser:{fullname:"",email:"",role:""}}},mounted(){const e=this.$route.params.userId;this.fetchUserInfo(e)},computed:{isModalChanged(){return this.user.fullname!==this.originalUser.fullname||this.user.email!==this.originalUser.email||this.user.role!==this.originalUser.role}},watch:{"user.role"(e){this.isAdminSelected="admin"===e}},methods:{fetchUserInfo(e){fetch(`${this.baseUrl}/admin/user/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.user=e,this.originalUser.fullname=e.fullname,this.originalUser.email=e.email,this.originalUser.role=e.role})).catch((e=>{console.error("Error fetching user data:",e)}))},updateUser(){fetch(`${this.baseUrl}/admin/user/${this.user.user_id}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(this.user)}).then((e=>e.json())).then((()=>{alert("User info updated successfully"),this.$router.push("/admin/manage-users")})).catch((e=>{console.error("Error updating user info:",e)}))}}};const ll=(0,j.A)(al,[["render",sl],["__scopeId","data-v-3d929ef9"]]);var ol=ll;const il={class:"manage-sessions"},nl={class:"grid2"},rl=["value"],dl={style:{display:"flex",gap:".5rem","align-items":"center","margin-top":"8px"}},ul={style:{display:"flex",gap:".5rem","align-items":"center","margin-top":"8px"}},cl=["disabled"],ml={key:0,class:"muted"},hl={class:"modal-actions"},pl=["disabled"],kl={class:"grid2"},fl=["value"],bl={key:0},yl=["value"],Ll=["disabled"],_l={key:1},gl={key:0},vl={key:2},Sl={key:3},Cl={class:"modal-actions"},wl=["disabled"],El={class:"toolbar"},Al={class:"filters",style:{"margin-top":"5px"}},Dl=["value"],xl={style:{display:"flex",gap:"8px"}},Il=["disabled"],Ul=["disabled"],Fl=["disabled"],Nl=["disabled"],$l={class:"filters"},Ml={style:{display:"flex","align-items":"center","margin-bottom":"8px","justify-content":"flex-end"}},Pl=["disabled","onClick"],Bl={key:0},Xl={key:0},Rl={key:1},Hl={key:1},Ol={key:2},Tl={key:3},Vl={key:4},jl={key:5},Jl={key:6},Ql={key:7},Yl={key:8},Wl={key:9},zl={key:0},ql={class:"pair"},Kl={class:"v"},Gl={key:1},Zl={key:2},eo={key:3},to={key:4},so={key:5},ao={key:6},lo={key:7},oo={key:8},io={key:9},no={class:"report-pill"},ro={key:0,class:"pill ok"},uo={key:1,class:"pill muted"},co=["onClick"],mo={key:0,class:"muted"},ho={key:1,class:"muted"},po={key:2,class:"report-list"},ko={class:"meta"},fo={class:"sub"},bo={class:"upload-block"},yo=["href"],Lo=["onClick","disabled"],_o={key:3},go={key:4,class:"upload-block"},vo=["onUpdate:modelValue"],So=["onChange"],Co=["onClick","disabled"],wo={class:"actions"},Eo=["onClick"],Ao=["onClick"],Do={key:0,class:"menu-list"},xo=["onClick"],Io=["onClick"],Uo=["onClick"],Fo={key:0,class:"empty-row"};function No(e,t,s,a,i,n){const r=(0,l.g2)("VueDatePicker"),d=(0,l.g2)("ExportExcel");return(0,l.uX)(),(0,l.CE)("div",il,[t[70]||(t[70]=(0,l.Lk)("h2",null,"Manage Sessions",-1)),n.isFilteredView?((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:t[0]||(t[0]=t=>e.$router.back()),class:""},"Back")):((0,l.uX)(),(0,l.CE)("button",{key:1,onClick:t[1]||(t[1]=t=>e.$router.push("/dashboard")),class:""},"Back to Dashboard")),i.isCreateOpen?((0,l.uX)(),(0,l.CE)("div",{key:2,class:"modal-overlay",onClick:t[12]||(t[12]=(...e)=>n.closeCreateModal&&n.closeCreateModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[11]||(t[11]=(0,u.D$)((()=>{}),["stop"])),style:{"max-width":"540px"}},[t[50]||(t[50]=(0,l.Lk)("h3",null,"Create Checkup Session",-1)),(0,l.Lk)("form",{onSubmit:t[10]||(t[10]=(0,u.D$)(((...e)=>n.submitCreate&&n.submitCreate(...e)),["prevent"]))},[(0,l.Lk)("div",nl,[(0,l.Lk)("label",null,[t[42]||(t[42]=(0,l.eW)(" Staff Email ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.createForm.staff_email=e),required:"",onChange:t[3]||(t[3]=(...e)=>n.syncDuplicateDefault&&n.syncDuplicateDefault(...e))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.staffEmailList,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.staff_email,value:e.staff_email},(0,o.v_)(e.staff_name)+" ("+(0,o.v_)(e.staff_email)+") ",9,rl)))),128))],544),[[u.u1,i.createForm.staff_email]])]),(0,l.Lk)("div",null,[t[43]||(t[43]=(0,l.Lk)("label",null," Session Date ",-1)),(0,l.bF)(r,{modelValue:i.createForm.session_date,"onUpdate:modelValue":t[4]||(t[4]=e=>i.createForm.session_date=e),"max-date":new Date((new Date).getFullYear()+1,11,31),"year-range":[1900,(new Date).getFullYear()+1],"auto-apply":"","enable-time-picker":!1},null,8,["modelValue","max-date","year-range"])]),(0,l.Lk)("label",null,[t[45]||(t[45]=(0,l.eW)(" Type ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.createForm.session_type=e),required:""},t[44]||(t[44]=[(0,l.Fv)('<option value="annual" data-v-f86708ce>Annual</option><option value="pre-employment" data-v-f86708ce>Pre-employment</option><option value="followup" data-v-f86708ce>Follow-up</option><option value="return-to-work" data-v-f86708ce>Return to Work</option><option value="ad-hoc" data-v-f86708ce>Ad-hoc</option>',5)]),512),[[u.u1,i.createForm.session_type]])]),(0,l.Lk)("label",null,[t[47]||(t[47]=(0,l.eW)(" Status ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.createForm.status=e),required:""},t[46]||(t[46]=[(0,l.Lk)("option",{value:"draft"},"draft",-1),(0,l.Lk)("option",{value:"submitted"},"submitted",-1),(0,l.Lk)("option",{value:"locked"},"locked",-1)]),512),[[u.u1,i.createForm.status]])])]),(0,l.Lk)("label",dl,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>i.createForm.no_forms=e)},null,512),[[u.lH,i.createForm.no_forms]]),t[48]||(t[48]=(0,l.eW)(" No forms (doctor follow-up) "))]),(0,l.Lk)("label",ul,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>i.createForm.duplicate_recent=e),disabled:i.createForm.no_forms||!n.hasPrevForSelected},null,8,cl),[[u.lH,i.createForm.duplicate_recent]]),t[49]||(t[49]=(0,l.eW)(" Duplicate data from previous session ")),n.hasPrevForSelected?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",ml,"â€” no previous session found"))]),(0,l.Lk)("div",hl,[(0,l.Lk)("button",{type:"submit",disabled:i.creating},(0,o.v_)(i.creating?"Creatingâ€¦":"Create"),9,pl),(0,l.Lk)("button",{type:"button",class:"ghost",onClick:t[9]||(t[9]=(...e)=>n.closeCreateModal&&n.closeCreateModal(...e))},"Cancel")])],32)])])):(0,l.Q3)("",!0),i.isEditOpen?((0,l.uX)(),(0,l.CE)("div",{key:3,class:"modal-overlay",onClick:t[21]||(t[21]=(...e)=>n.closeEditModal&&n.closeEditModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[20]||(t[20]=(0,u.D$)((()=>{}),["stop"])),style:{"max-width":"540px"}},[t[58]||(t[58]=(0,l.Lk)("h3",null,"Edit Checkup Session",-1)),(0,l.Lk)("form",{onSubmit:t[19]||(t[19]=(0,u.D$)(((...e)=>n.submitEdit&&n.submitEdit(...e)),["prevent"]))},[(0,l.Lk)("div",kl,[(0,l.Lk)("label",null,[t[51]||(t[51]=(0,l.eW)(" Staff (read-only) ")),(0,l.Lk)("input",{type:"text",value:i.editForm.staff_email,disabled:""},null,8,fl)]),i.isAdminRole?((0,l.uX)(),(0,l.CE)("label",bl,[t[52]||(t[52]=(0,l.eW)(" Assigned Doctor ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.editForm.assigned_doctor_email=e)},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.doctorEmailList,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.doctor_email,value:e.doctor_email},(0,o.v_)(e.doctor_name)+" ("+(0,o.v_)(e.doctor_email)+") ",9,yl)))),128))],512),[[u.u1,i.editForm.assigned_doctor_email]])])):(0,l.Q3)("",!0),(0,l.Lk)("label",null,[t[53]||(t[53]=(0,l.eW)(" Session Remarks ")),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[14]||(t[14]=e=>i.editForm.session_remarks=e),placeholder:"Overall session remarks",disabled:i.isAdminRole},null,8,Ll),[[u.Jo,i.editForm.session_remarks]])]),i.isAdminRole?((0,l.uX)(),(0,l.CE)("div",_l,[i.isAdminRole?((0,l.uX)(),(0,l.CE)("label",gl,"Session Date")):(0,l.Q3)("",!0),(0,l.bF)(r,{modelValue:i.editForm.session_date,"onUpdate:modelValue":t[15]||(t[15]=e=>i.editForm.session_date=e),"max-date":new Date((new Date).getFullYear()+1,11,31),"year-range":[1900,(new Date).getFullYear()+1],"auto-apply":"","enable-time-picker":!1},null,8,["modelValue","max-date","year-range"])])):(0,l.Q3)("",!0),i.isAdminRole?((0,l.uX)(),(0,l.CE)("label",vl,[t[55]||(t[55]=(0,l.eW)(" Type ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[16]||(t[16]=e=>i.editForm.session_type=e),required:""},t[54]||(t[54]=[(0,l.Fv)('<option value="annual" data-v-f86708ce>Annual</option><option value="pre-employment" data-v-f86708ce>Pre-employment</option><option value="followup" data-v-f86708ce>Follow-up</option><option value="return-to-work" data-v-f86708ce>Return to Work</option><option value="ad-hoc" data-v-f86708ce>Ad-hoc</option>',5)]),512),[[u.u1,i.editForm.session_type]])])):(0,l.Q3)("",!0),i.isAdminRole?((0,l.uX)(),(0,l.CE)("label",Sl,[t[57]||(t[57]=(0,l.eW)(" Status ")),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>i.editForm.status=e),required:""},t[56]||(t[56]=[(0,l.Lk)("option",{value:"draft"},"draft",-1),(0,l.Lk)("option",{value:"submitted"},"submitted",-1),(0,l.Lk)("option",{value:"locked"},"locked",-1)]),512),[[u.u1,i.editForm.status]])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Cl,[(0,l.Lk)("button",{type:"submit",disabled:i.editing},(0,o.v_)(i.editing?"Savingâ€¦":"Save Changes"),9,wl),(0,l.Lk)("button",{type:"button",class:"ghost",onClick:t[18]||(t[18]=(...e)=>n.closeEditModal&&n.closeEditModal(...e))},"Cancel")])],32)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",El,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[22]||(t[22]=e=>i.search=e),type:"text",class:"search-input",placeholder:"Search staff (name or email)â€¦"},null,512),[[u.Jo,i.search,void 0,{trim:!0}]]),(0,l.Lk)("div",Al,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[23]||(t[23]=e=>i.yearFilter=e)},[t[59]||(t[59]=(0,l.Lk)("option",{value:""},"All Years",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.availableYears,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e.toString()},(0,o.v_)(e),9,Dl)))),128))],512),[[u.u1,i.yearFilter]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[24]||(t[24]=e=>i.typeFilter=e)},t[60]||(t[60]=[(0,l.Fv)('<option value="" data-v-f86708ce>All Types</option><option value="annual" data-v-f86708ce>Annual</option><option value="pre-employment" data-v-f86708ce>Pre-employment</option><option value="followup" data-v-f86708ce>Follow-up</option><option value="return-to-work" data-v-f86708ce>Return to Work</option><option value="ad-hoc" data-v-f86708ce>Ad-hoc</option>',6)]),512),[[u.u1,i.typeFilter]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[25]||(t[25]=e=>i.statusFilter=e)},t[61]||(t[61]=[(0,l.Lk)("option",{value:""},"All Status",-1),(0,l.Lk)("option",{value:"draft"},"Draft",-1),(0,l.Lk)("option",{value:"submitted"},"Submitted",-1),(0,l.Lk)("option",{value:"locked"},"Locked",-1)]),512),[[u.u1,i.statusFilter]])])]),(0,l.Lk)("div",xl,[(0,l.Lk)("div",null,[(0,l.Lk)("button",{disabled:i.page<=1||i.loading,onClick:t[26]||(t[26]=(...e)=>n.goFirst&&n.goFirst(...e))},"Â« First",8,Il),(0,l.Lk)("button",{disabled:i.page<=1||i.loading,onClick:t[27]||(t[27]=(...e)=>n.prevPage&&n.prevPage(...e))},"â€¹ Prev",8,Ul),(0,l.Lk)("span",null,"Page "+(0,o.v_)(i.page)+" / "+(0,o.v_)(n.totalPages||1),1),(0,l.Lk)("button",{disabled:i.page>=n.totalPages||i.loading,onClick:t[28]||(t[28]=(...e)=>n.nextPage&&n.nextPage(...e))},"Next â€º",8,Fl),(0,l.Lk)("button",{disabled:i.page>=n.totalPages||i.loading,onClick:t[29]||(t[29]=(...e)=>n.goLast&&n.goLast(...e))},"Last Â»",8,Nl)]),(0,l.Lk)("div",$l,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[30]||(t[30]=e=>i.pageSize=e),onChange:t[31]||(t[31]=(...e)=>n.changePageSize&&n.changePageSize(...e))},t[62]||(t[62]=[(0,l.Lk)("option",{value:10},"10",-1),(0,l.Lk)("option",{value:20},"20",-1),(0,l.Lk)("option",{value:50},"50",-1)]),544),[[u.u1,i.pageSize,void 0,{number:!0}]])]),(0,l.Lk)("div",Ml,[i.isAdminRole?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"new-btn",onClick:t[32]||(t[32]=(...e)=>n.createNewSession&&n.createNewSession(...e))}," + New Session ")):(0,l.Q3)("",!0),(0,l.Lk)("button",{onClick:t[33]||(t[33]=e=>i.showMetadata=!i.showMetadata),class:"new-btn"},(0,o.v_)(i.showMetadata?"Hide Metadata Columns":"Show Metadata Columns"),1),(0,l.Lk)("button",{onClick:t[34]||(t[34]=e=>i.showHasTables=!i.showHasTables),class:"new-btn"},(0,o.v_)(i.showHasTables?"Hide Has-Forms Columns":"Show Has-Forms Columns"),1),(0,l.Lk)("div",null,[(0,l.bF)(d,{rows:n.pagedSessions,allRows:i.sessions,columns:n.nsColumns,filename:"session-list.xlsx",sheetName:"Session Data",title:"Export Session Columns"},{trigger:(0,l.k6)((({open:e,disabled:t})=>[(0,l.Lk)("button",{disabled:t,onClick:e,class:"new-btn"},"Export Excel",8,Pl)])),_:1},8,["rows","allRows","columns"])])])]),(0,l.Lk)("div",{class:"table-wrap",onScroll:t[40]||(t[40]=(...e)=>n.onTableScroll&&n.onTableScroll(...e))},[(0,l.Lk)("table",null,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[n.isFilteredView?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("th",Bl,"Staff")),(0,l.Lk)("th",{onClick:t[35]||(t[35]=(...e)=>n.toggleDateSort&&n.toggleDateSort(...e)),style:{"min-width":"110px",cursor:"pointer"}},[t[63]||(t[63]=(0,l.eW)(" Date ")),"asc"===i.sortDir?((0,l.uX)(),(0,l.CE)("span",Xl,"â–²")):((0,l.uX)(),(0,l.CE)("span",Rl,"â–¼"))]),t[64]||(t[64]=(0,l.Lk)("th",{style:{width:"min-content"}},"Type",-1)),t[65]||(t[65]=(0,l.Lk)("th",{style:{width:"min-content"}},"Status",-1)),i.isAdminRole&&i.showMetadata?((0,l.uX)(),(0,l.CE)("th",Hl,"Created By")):(0,l.Q3)("",!0),i.isAdminRole&&i.showMetadata?((0,l.uX)(),(0,l.CE)("th",Ol,"Created At")):(0,l.Q3)("",!0),i.isAdminRole&&i.showMetadata?((0,l.uX)(),(0,l.CE)("th",Tl,"Updated By")):(0,l.Q3)("",!0),i.showMetadata?((0,l.uX)(),(0,l.CE)("th",Vl,"Updated At")):(0,l.Q3)("",!0),i.showMetadata?((0,l.uX)(),(0,l.CE)("th",jl,"Has Forms (All)")):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("th",Jl,"Has Forms (Medical History)")):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("th",Ql,"Has Forms (Lifestyle)")):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("th",Yl,"Has Forms (Physical Exams)")):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("th",Wl,"Has Forms (Investigations)")):(0,l.Q3)("",!0),t[66]||(t[66]=(0,l.Lk)("th",{class:"nowrap"},"Reports",-1)),t[67]||(t[67]=(0,l.Lk)("th",{style:{"min-width":"120px"}},"Doctor Info",-1)),t[68]||(t[68]=(0,l.Lk)("th",null,"Action",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.pagedSessions,((s,a)=>((0,l.uX)(),(0,l.CE)("tr",{key:s.session_id??a},[n.isFilteredView?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("td",zl,[(0,l.Lk)("div",ql,[(0,l.Lk)("span",Kl,[(0,l.Lk)("b",null,(0,o.v_)(s.staff_name),1)])])])),(0,l.Lk)("td",null,(0,o.v_)(n.formatDate(s.session_date)),1),(0,l.Lk)("td",null,(0,o.v_)(s.session_type),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,o.C4)(["status-pill",s.status])},(0,o.v_)(s.status),3)]),i.isAdminRole&&i.showMetadata?((0,l.uX)(),(0,l.CE)("td",Gl,(0,o.v_)(s.created_by||"-"),1)):(0,l.Q3)("",!0),i.isAdminRole&&i.showMetadata?((0,l.uX)(),(0,l.CE)("td",Zl,(0,o.v_)(n.formatDate(s.created_at)),1)):(0,l.Q3)("",!0),i.isAdminRole&&i.showMetadata?((0,l.uX)(),(0,l.CE)("td",eo,(0,o.v_)(s.updated_by||"-"),1)):(0,l.Q3)("",!0),i.showMetadata?((0,l.uX)(),(0,l.CE)("td",to,(0,o.v_)(n.formatDate(s.updated_at)),1)):(0,l.Q3)("",!0),i.showMetadata?((0,l.uX)(),(0,l.CE)("td",so,(0,o.v_)(s.has_forms_all?"Yes":"No"),1)):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("td",ao,[(0,l.Lk)("span",{style:(0,o.Tr)({color:s.has_mh?"#3e8e41":"#8b0a1a"})},(0,o.v_)(s.has_mh?"Yes":"No"),5)])):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("td",lo,[(0,l.Lk)("span",{style:(0,o.Tr)({color:s.has_lifestyle?"#3e8e41":"#8b0a1a"})},(0,o.v_)(s.has_lifestyle?"Yes":"No"),5)])):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("td",oo,[(0,l.Lk)("span",{style:(0,o.Tr)({color:s.has_pe1&&s.has_pe2?"#3e8e41":"#8b0a1a"})},(0,o.v_)(s.has_pe1&&s.has_pe2?"Yes":"No"),5)])):(0,l.Q3)("",!0),i.showHasTables?((0,l.uX)(),(0,l.CE)("td",io,[(0,l.Lk)("span",{style:(0,o.Tr)({color:s.has_investigations&&s.has_ilab?"#3e8e41":"#8b0a1a"})},(0,o.v_)(s.has_investigations&&s.has_ilab?"Yes":"No"),5)])):(0,l.Q3)("",!0),(0,l.Lk)("td",{class:"reports-cell",onClick:t[38]||(t[38]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",no,[n.reportExists(s)?((0,l.uX)(),(0,l.CE)("span",ro,"uploaded")):((0,l.uX)(),(0,l.CE)("span",uo,"none"))]),(0,l.Lk)("div",{class:"report-menu",onClick:t[37]||(t[37]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("button",{class:"menu-btn",onClick:(0,u.D$)((e=>n.toggleReportMenu(s.session_id)),["stop"])}," Reports â–¾ ",8,co),i.openReportMenuId===s.session_id?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"menu-list",onClick:t[36]||(t[36]=(0,u.D$)((()=>{}),["stop"]))},[i.reportsLoadingId===s.session_id?((0,l.uX)(),(0,l.CE)("div",mo,"Loadingâ€¦")):0===(i.reportsBySession[s.session_id]||[]).length?((0,l.uX)(),(0,l.CE)("div",ho," No reports. ")):((0,l.uX)(),(0,l.CE)("div",po,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.reportsBySession[s.session_id],(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.report_id},[(0,l.Lk)("div",ko,[(0,l.Lk)("strong",null,(0,o.v_)(e.title||(e.file_name.length>10?e.file_name.substring(0,7)+"...":e.file_name)),1),(0,l.Lk)("div",fo,(0,o.v_)((e.file_size/1024).toFixed(0))+" KB â€¢ "+(0,o.v_)(n.formatDate(e.uploaded_at)),1),(0,l.Lk)("div",bo,[(0,l.Lk)("a",{href:`${i.baseUrl}/reports/${e.report_id}/download`,target:"_blank",rel:"noopener",class:"btn"}," View/Download ",8,yo),(0,l.Lk)("a",{class:"btn-danger",onClick:t=>n.deleteReport(s.session_id,e.report_id),disabled:i.deletingReportId===e.report_id,title:"Delete"},(0,o.v_)(i.deletingReportId===e.report_id?"Deletingâ€¦":"Delete"),9,Lo)])])])))),128))])),((0,l.uX)(),(0,l.CE)("hr",_o)),n.reportExists(s)?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",go,[(0,l.bo)((0,l.Lk)("input",{class:"title-input",type:"text",placeholder:"Optional title","onUpdate:modelValue":e=>i.uploadTitleBySession[s.session_id]=e},null,8,vo),[[u.Jo,i.uploadTitleBySession[s.session_id]]]),(0,l.Lk)("input",{class:"file-input",type:"file",accept:"application/pdf",onChange:e=>n.onPickFile(s.session_id,e)},null,40,So),(0,l.Lk)("button",{class:"upload-btn",onClick:e=>n.uploadReport(s),disabled:!i.uploadFileBySession[s.session_id]||i.uploadingSessionId===s.session_id},(0,o.v_)(i.uploadingSessionId===s.session_id?"Uploadingâ€¦":"Upload PDF"),9,Co)]))])):(0,l.Q3)("",!0)])]),(0,l.Lk)("td",null,[(0,l.Lk)("p",{class:(0,o.C4)({"muted-text":null===s.assigned_doctor_email})},(0,o.v_)(s.assigned_doctor_email||"Unassigned"),3),(0,l.Lk)("p",{class:(0,o.C4)({"muted-text":null===s.session_remarks})},(0,o.v_)(s.session_remarks||"No remarks"),3)]),(0,l.Lk)("td",wo,[(0,l.Lk)("button",{onClick:e=>n.viewSession(s)},"Open",8,Eo),(0,l.Lk)("div",{class:"action-menu",onClick:t[39]||(t[39]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("button",{class:"menu-btn",onClick:e=>n.toggleRowMenu(s.session_id)},"Actions â–¾",8,Ao),i.openRowMenuId===s.session_id?((0,l.uX)(),(0,l.CE)("div",Do,[(0,l.Lk)("button",{onClick:e=>n.openEdit(s)},"Edit Session",8,xo),(0,l.Lk)("button",{onClick:t=>e.$router.push({name:"export-medical",query:{session_id:s.session_id,staff_email:s.staff_email}})}," Export Session Excel ",8,Io),(0,l.Lk)("button",{class:"danger",onClick:e=>n.deleteSession(s)},"Delete Session & Data",8,Uo)])):(0,l.Q3)("",!0)])])])))),128)),0===n.filteredSessions.length?((0,l.uX)(),(0,l.CE)("tr",Fo,t[69]||(t[69]=[(0,l.Lk)("td",{colspan:"8"},[(0,l.Lk)("div",{class:"empty-state"},"No sessions found.")],-1)]))):(0,l.Q3)("",!0)])])],32),(0,l.Lk)("div",{class:"x-scroll",ref:"xScroll",onScroll:t[41]||(t[41]=(...e)=>n.onXScroll&&n.onXScroll(...e))},[(0,l.Lk)("div",{style:(0,o.Tr)({width:i.tableScrollWidth+"px",height:"1px"})},null,4)],544)])}const $o=["disabled"],Mo={class:"export-dialog"},Po={key:0,class:"scope"},Bo={class:"scope-item"},Xo={class:"scope-item"},Ro={class:"scope-count"},Ho={class:"cols"},Oo=["value"],To={class:"dialog-actions"},Vo=["disabled"];function jo(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.RG)(e.$slots,"trigger",{open:n.open,disabled:!n.hasAnyRows},(()=>[(0,l.Lk)("button",{disabled:!n.hasAnyRows,onClick:t[0]||(t[0]=(...e)=>n.open&&n.open(...e))},"Export Excel",8,$o)]),!0),i.show?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"export-backdrop",onClick:t[8]||(t[8]=(0,u.D$)(((...e)=>n.close&&n.close(...e)),["self"]))},[(0,l.Lk)("div",Mo,[(0,l.Lk)("h3",null,(0,o.v_)(s.title||"Export columns"),1),n.hasAllRows?((0,l.uX)(),(0,l.CE)("div",Po,[t[12]||(t[12]=(0,l.Lk)("strong",null,"Data scope:",-1)),(0,l.Lk)("label",Bo,[(0,l.bo)((0,l.Lk)("input",{type:"radio",value:"displayed","onUpdate:modelValue":t[1]||(t[1]=e=>i.exportScope=e)},null,512),[[u.XL,i.exportScope]]),t[9]||(t[9]=(0,l.eW)(" Displayed only (filtered/paged) "))]),(0,l.Lk)("label",Xo,[(0,l.bo)((0,l.Lk)("input",{type:"radio",value:"all","onUpdate:modelValue":t[2]||(t[2]=e=>i.exportScope=e)},null,512),[[u.XL,i.exportScope]]),t[10]||(t[10]=(0,l.eW)(" All rows "))]),(0,l.Lk)("span",Ro,[t[11]||(t[11]=(0,l.Lk)("b",null,"Rows:",-1)),(0,l.eW)(" "+(0,o.v_)(n.effectiveRows.length),1)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Ho,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.normalizedColumns,((e,s)=>((0,l.uX)(),(0,l.CE)("label",{key:e.key??s,class:"col-item"},[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>i.selected=e),value:e.key},null,8,Oo),[[u.lH,i.selected]]),(0,l.eW)(" "+(0,o.v_)(e.label),1)])))),128))]),(0,l.Lk)("div",To,[(0,l.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>n.selectAll&&n.selectAll(...e))},"Select all"),(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>n.clearAll&&n.clearAll(...e))},"Clear"),t[13]||(t[13]=(0,l.Lk)("div",{class:"spacer"},null,-1)),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>n.close&&n.close(...e))},"Cancel"),(0,l.Lk)("button",{disabled:!n.effectiveRows.length||!i.selected.length,onClick:t[7]||(t[7]=(...e)=>n.exportNow&&n.exportNow(...e)),style:{"background-color":"#2563eb",color:"white"}}," Export ",8,Vo)])])])):(0,l.Q3)("",!0)],64)}var Jo=s(3230),Qo={name:"ExportExcel",props:{rows:{type:Array,default:()=>[]},allRows:{type:Array,default:()=>null},columns:{type:[Array,Object],required:!0},filename:{type:String,default:""},sheetName:{type:String,default:"Sheet1"},title:{type:String,default:""},defaultSelectedKeys:{type:Array,default:null}},data(){return{show:!1,selected:[],exportScope:"displayed"}},computed:{normalizedColumns(){return Array.isArray(this.columns)?this.columns:this.columns&&"object"===typeof this.columns?Object.values(this.columns):(console.warn('[ExportExcel] "columns" not array/object:',this.columns),[])},hasAllRows(){return Array.isArray(this.allRows)&&this.allRows.length>0},hasAnyRows(){return(this.rows?.length||0)>0||(this.allRows?.length||0)>0},effectiveRows(){return"all"===this.exportScope&&this.hasAllRows?this.allRows:this.rows||[]}},watch:{normalizedColumns(e){e?.length&&!this.selected.length&&(this.selected=e.map((e=>e.key)))}},mounted(){this.normalizedColumns.length||console.warn("[ExportExcel] No columns provided or failed to normalize."),this.selected=Array.isArray(this.defaultSelectedKeys)&&this.defaultSelectedKeys.length?[...this.defaultSelectedKeys]:this.normalizedColumns.map((e=>e.key))},methods:{open(){this.show=!0},close(){this.show=!1},selectAll(){this.selected=this.normalizedColumns.map((e=>e.key))},clearAll(){this.selected=[]},_getXLSX(){if("undefined"!==typeof Jo)return Jo;if("undefined"!==typeof window&&window.XLSX)return window.XLSX;throw new Error('XLSX not found. Install "xlsx" or include the CDN script.')},_valueFor(e,t){const s=e.getter?e.getter(t):t?.[e.key];return e.format?e.format(s,t):s??""},_autosize(e,t,s){const a=t.map((e=>{const t=(e.label||"").toString().length,a=s.reduce(((t,s)=>{const a=s[e.label],l=(null==a?"":String(a)).length;return Math.max(t,l)}),0);return{wch:Math.min(Math.max(10,Math.max(t,a)+2),60)}}));e["!cols"]=a},exportNow(){try{const e=this._getXLSX(),t=this.normalizedColumns.filter((e=>this.selected.includes(e.key)));if(!t.length)return;const s=this.effectiveRows.map((e=>{const s={};for(const a of t)s[a.label]=this._valueFor(a,e);return s})),a=e.utils.json_to_sheet(s,{skipHeader:!1});this._autosize(a,t,s);const l=e.utils.book_new();e.utils.book_append_sheet(l,a,this.sheetName||"Sheet1");const o="all"===this.exportScope?"all":"displayed",i=this.filename||`export-${o}-${(new Date).toISOString().slice(0,10)}.xlsx`;e.writeFile(l,i),this.close()}catch(e){console.error(e),alert("Export failed. Check console for details.")}}}};const Yo=(0,j.A)(Qo,[["render",jo],["__scopeId","data-v-e1a073a0"]]);var Wo=Yo,zo={components:{ExportExcel:Wo,VueDatePicker:Ps.V},props:{rows:{type:Array,default:()=>[]}},data(){let e=null;try{e=JSON.parse(localStorage.getItem("user_info"))?.role||null}catch{}return{isAdminRole:"admin"===e,page:1,pageSize:10,sortDir:"desc",loading:!1,tableScrollWidth:0,resizeObs:null,baseUrl:O.A.API_BASE_URL,sessions:[],staffEmailList:[],doctorEmailList:[],search:"",yearFilter:"",typeFilter:"",statusFilter:"",showMetadata:!1,showHasTables:!1,openRowMenuId:null,openReportMenuId:null,reportsBySession:{},reportsLoadingId:null,uploadTitleBySession:{},uploadFileBySession:{},uploadingSessionId:null,deletingReportId:null,reportHas:{},isCreateOpen:!1,creating:!1,createForm:{staff_email:"",session_date:(new Date).toISOString().slice(0,10),session_type:"annual",status:"draft",duplicate_recent:!0,no_forms:!1,init_tables:!0},hasPrevByStaff:{},isEditOpen:!1,editing:!1,editForm:{session_id:null,staff_email:"",assigned_doctor_email:null,session_remarks:null,session_date:"",session_type:"annual",status:"draft"},duplicating:!1}},computed:{isFilteredView(){return!!this.$route.query.staff},totalPages(){const e=Math.ceil(this.filteredSessions.length/this.pageSize)||1;return e},pagedSessions(){const e=(this.page-1)*this.pageSize;return this.sortedSessions.slice(e,e+this.pageSize)},sortedSessions(){const e="asc"===this.sortDir?1:-1;return[...this.filteredSessions].sort(((t,s)=>{const a=qo(t.session_date),l=qo(s.session_date);return isNaN(a)&&isNaN(l)?0:isNaN(a)?1:isNaN(l)?-1:a===l?0:a>l?e:-e}))},availableYears(){const e=Array.isArray(this.sessions)?this.sessions:[],t=new Set(e.map((e=>{const t=e?.session_date?new Date(e.session_date):null;return t&&!isNaN(t)?t.getFullYear():null})).filter((e=>null!==e)));return Array.from(t).sort(((e,t)=>t-e))},filteredSessions(){const e=this.search.toLowerCase();return this.sessions.filter((t=>{const s=!e||t.staff_name&&t.staff_name.toLowerCase().includes(e)||t.staff_email&&t.staff_email.toLowerCase().includes(e),a=!this.yearFilter||new Date(t.session_date).getFullYear().toString()===this.yearFilter,l=!this.statusFilter||t.status===this.statusFilter,o=!this.typeFilter||t.session_type===this.typeFilter;return s&&a&&o&&l}))},hasPrevForSelected(){return!!this.hasPrevByStaff[this.createForm.staff_email]},nsColumns(){return[{key:"staff_name",label:"Staff Name"},{key:"staff_email",label:"Staff Email"},{key:"session_date",label:"Session Date"},{key:"session_type",label:"Session Type"},{key:"status",label:"Status"},{key:"created_by",label:"Created By"},{key:"created_at",label:"Created At"},{key:"updated_by",label:"Updated By"},{key:"updated_at",label:"Updated At"},{key:"assigned_doctor_email",label:"Assigned Doctor Email"},{key:"session_remarks",label:"Session Remarks"}]}},mounted(){this.fetchSessions(),this.fetchEmails(),window.addEventListener("click",this.closeMenus),this.applyStaffQuery(),this._onDocClick_reports||(this._onDocClick_reports=e=>{e.target.closest(".report-menu")||(this.openReportMenuId=null)},document.addEventListener("click",this._onDocClick_reports)),this.$nextTick((()=>this.measureXBar())),window.addEventListener("resize",this.measureXBar),this.resizeObs=new ResizeObserver((()=>this.measureXBar()));const e=this.$el.querySelector(".table-wrap");e&&this.resizeObs.observe(e)},watch:{"$route.query.staff"(){this.applyStaffQuery()},activeStaffEmail:{immediate:!0,handler(e){!e||this.createForm.staff_email&&!this.isCreateOpen||(this.createForm.staff_email=e)}},search(){this.page=1},yearFilter(){this.page=1},statusFilter(){this.page=1},sessions:{deep:!0,handler(){this.page>this.totalPages&&(this.page=this.totalPages)}},totalPages(e){this.page>e&&(this.page=e),this.page<1&&(this.page=1)},"createForm.session_type"(e){this.createForm.no_forms="followup"===e},"createForm.no_forms"(e){e&&(this.createForm.duplicate_recent=!1)}},beforeUnmount(){window.removeEventListener("click",this.closeMenus),window.removeEventListener("resize",this.measureXBar),this.resizeObs&&this.resizeObs.disconnect()},methods:{goFirst(){this.page=1},prevPage(){this.page>1&&this.page--},nextPage(){this.page<this.totalPages&&this.page++},goLast(){this.page=this.totalPages},changePageSize(){this.page=1},toggleDateSort(){this.sortDir="asc"===this.sortDir?"desc":"asc"},formatDate:$s,measureXBar(){const e=this.$el.querySelector(".table-wrap");e&&(this.tableScrollWidth=e.scrollWidth,this.$refs.xScroll&&(this.$refs.xScroll.scrollLeft=e.scrollLeft))},onTableScroll(e){this.$refs.xScroll&&(this.$refs.xScroll.scrollLeft=e.target.scrollLeft)},onXScroll(e){const t=this.$el.querySelector(".table-wrap");t&&(t.scrollLeft=e.target.scrollLeft)},async fetchEmails(){try{const e=await fetch(`${this.baseUrl}/admin/staff-list`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}),t=await e.json();this.staffEmailList=Array.isArray(t)?t:[]}catch(e){console.error(e),this.staffEmailList=[]}try{const e=await fetch(`${this.baseUrl}/admin/doctor-list`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}),t=await e.json();this.doctorEmailList=Array.isArray(t)?t:[]}catch(e){console.error(e),this.doctorEmailList=[]}},async fetchSessions(){try{const e=await fetch(`${this.baseUrl}/admin/sessions`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}),t=await e.json();if((0,T.$)(e))return;this.sessions=Array.isArray(t)?t:Array.isArray(t?.sessions)?t.sessions:[],this.sessions.forEach((e=>{e.has_forms_all=e.has_investigations&&e.has_ilab&&e.has_lifestyle&&e.has_mh&&e.has_pe1&&e.has_pe2})),this.refreshReportFlagsForSessions(this.sessions.map((e=>e.session_id))),this.hasPrevByStaff=this.sessions.reduce(((e,t)=>(e[t.staff_email]=!0,e)),{})}catch(e){console.error(e),this.sessions=[]}},applyStaffQuery(){const e=this.$route.query.staff;if(!e)return;const t=decodeURIComponent(e);this.search=t},toggleRowMenu(e){this.openRowMenuId=this.openRowMenuId===e?null:e},closeMenus(){this.openRowMenuId=null},createNewSession(){const e=this.$route?.query?.staff||"";this.createForm={staff_email:e||this.staffEmailList[0]?.staff_email||"",session_date:(new Date).toISOString().slice(0,10),session_type:"annual",status:"draft",duplicate_recent:!0,no_forms:!1,init_tables:!this.createForm.no_forms},this.hasPrevForSelected||(this.createForm.duplicate_recent=!1),this.isCreateOpen=!0},closeCreateModal(){this.isCreateOpen=!1},syncDuplicateDefault(){this.hasPrevForSelected||(this.createForm.duplicate_recent=!1)},async submitCreate(){if(this.createForm.staff_email)if(this.isAdminRole){this.createForm.no_forms&&(this.createForm.init_tables=!1,this.createForm.duplicate_recent=!1),this.creating=!0;try{const e=this.createForm.duplicate_recent&&this.hasPrevForSelected?`${this.baseUrl}/sessions/duplicate-last`:`${this.baseUrl}/create-session`,t=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify({staff_email:this.createForm.staff_email,session_date:this.createForm.session_date,session_type:this.createForm.session_type,status:this.createForm.status,created_by:JSON.parse(localStorage.getItem("user_info")).email,init_tables:!this.createForm.no_forms})});if(!t.ok){const e=await t.text();throw new Error(e||"Create failed")}await this.fetchSessions(),this.hasPrevByStaff=this.sessions.reduce(((e,t)=>(e[t.staff_email]=!0,e)),{}),this.isCreateOpen=!1}catch(e){alert(e.message||"Failed to create session")}finally{this.creating=!1}}else alert("Only admins can create sessions.");else alert("Please select a staff.")},viewSession(e){const t=e;this.$router.push({name:"session-medical-history",params:{sessionId:t.session_id},query:{staff:t.staff_email,name:t.staff_name}})},openEdit(e){this.editForm={session_id:e.session_id,staff_email:e.staff_email,assigned_doctor_email:e.assigned_doctor_email,session_remarks:e.session_remarks,session_date:this.toYMD(e.session_date),session_type:e.session_type,status:e.status},this.isEditOpen=!0},closeEditModal(){this.isEditOpen=!1,this.editing=!1,this.editForm={session_id:null,staff_email:"",assigned_doctor_email:null,session_remarks:null,session_date:"",session_type:"annual",status:"draft"}},toYMD(e){if(!e)return"";const t=new Date(e);return isNaN(t)?String(e).slice(0,10):t.toISOString().slice(0,10)},async submitEdit(){const{session_id:e,assigned_doctor_email:t,session_remarks:s,session_date:a,session_type:l,status:o}=this.editForm;if(e&&a&&l&&o){this.editing=!0;try{const i=JSON.parse(localStorage.getItem("user_info")).email,n={assigned_doctor_email:t||null,session_remarks:s??null,session_date:a,session_type:l,status:o,updated_by:i},r=await fetch(`${this.baseUrl}/edit-session/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new Error(await r.text()||"Failed to update session");await this.fetchSessions(),Rt(e);try{const t=await Bt(e,{force:!0});Xt(e,t)}catch{}this.isEditOpen=!1}catch(i){alert(i.message||"Failed to update session")}finally{this.editing=!1}}else alert("Please fill all fields.")},async deleteSession(e){const t=e.session_id;if(t&&confirm(`Delete session #${t} for ${e.staff_email}? This will also remove its report files.`))try{let e=this.reportsBySession[t];if(!Array.isArray(e)){const s=await fetch(`${this.baseUrl}/sessions/${t}/reports`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}});e=await s.json()||[]}if(Array.isArray(e)&&e.length){const t=e[0];try{await fetch(`${this.baseUrl}/reports/${t.report_id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}})}catch(s){}}const a=await fetch(`${this.baseUrl}/delete-session/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}});if(!a.ok){const e=await a.text();throw new Error(e||"Failed to delete session")}if(this.sessions=this.sessions.filter((e=>e.session_id!==t)),this.$delete)this.$delete(this.reportsBySession,t),this.$delete(this.reportHas,t);else{const e={...this.reportsBySession};delete e[t],this.reportsBySession=e;const s={...this.reportHas};delete s[t],this.reportHas=s}this.openReportMenuId===t&&(this.openReportMenuId=null),this.openRowMenuId===t&&(this.openRowMenuId=null)}catch(s){console.error(s),alert(s.message||"Failed to delete session")}},reportExists(e){const t=e.session_id;return void 0!==this.reportHas[t]?this.reportHas[t]:!!e.has_report},setReportExists(e,t){const s={...this.reportHas,[e]:!!t};this.reportHas=s,this.$nextTick((()=>this.reportHas=s))},async refreshReportFlagsForSessions(e){Array.isArray(e)&&0!==e.length&&await Promise.all(e.map((async e=>{try{const t=await fetch(`${this.baseUrl}/admin/checkup-reports/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}});if(!t.ok)throw 0;const s=await t.json();this.setReportExists(e,Array.isArray(s)&&s.length>0)}catch{this.setReportExists(e,!1)}})))},onReportUploaded(e){this.setReportExists(e,!0)},onReportDeleted(e){this.setReportExists(e,!1)},toggleReportMenu(e){this.openReportMenuId=this.openReportMenuId===e?null:e,this.openReportMenuId&&this.ensureReportsLoaded(e)},ensureReportsLoaded(e){this.reportsBySession[e]||(this.reportsLoadingId=e,fetch(`${this.baseUrl}/sessions/${e}/reports`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>e.json())).then((t=>{this.$set?this.$set(this.reportsBySession,e,Array.isArray(t)?t:[]):this.reportsBySession={...this.reportsBySession,[e]:Array.isArray(t)?t:[]}})).catch((()=>{this.$set?this.$set(this.reportsBySession,e,[]):this.reportsBySession={...this.reportsBySession,[e]:[]}})).finally((()=>{this.reportsLoadingId=null})))},onPickFile(e,t){const s=t.target.files&&t.target.files[0];if(s)return"application/pdf"!==s.type?(alert("Please select a PDF file."),void(t.target.value="")):void(this.$set?this.$set(this.uploadFileBySession,e,s):this.uploadFileBySession={...this.uploadFileBySession,[e]:s})},uploadReport(e){const t=e.session_id,s=this.uploadFileBySession[t];if(!s)return;const a=new FormData;a.append("file",s);const l=this.uploadTitleBySession[t]||"";l&&a.append("title",l),this.uploadingSessionId=t,fetch(`${this.baseUrl}/sessions/${t}/upload-report`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},body:a}).then((e=>e.ok?e.json():Promise.reject(e))).then((()=>{if(this.onReportUploaded(t),this.$set?(this.$set(this.uploadTitleBySession,t,""),this.$set(this.uploadFileBySession,t,null)):(this.uploadTitleBySession={...this.uploadTitleBySession,[t]:""},this.uploadFileBySession={...this.uploadFileBySession,[t]:null}),this.$delete)this.$delete(this.reportsBySession,t);else{const e={...this.reportsBySession};delete e[t],this.reportsBySession=e}this.ensureReportsLoaded(t)})).catch((async e=>{let t="Upload failed";try{t=(await e.json()).error||t}catch(s){console.warn("Upload: could not parse error JSON",s)}alert(t)})).finally((()=>{this.uploadingSessionId=null}))},deleteReport(e,t){confirm("Delete this report?")&&(this.deletingReportId=t,fetch(`${this.baseUrl}/reports/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>e.ok?e.json():Promise.reject(e))).then((()=>{const s=this.reportsBySession[e]||[],a=s.filter((e=>e.report_id!==t));this.onReportDeleted(e),this.$set?this.$set(this.reportsBySession,e,a):this.reportsBySession={...this.reportsBySession,[e]:a}})).catch((async e=>{let t="Delete failed";try{t=(await e.json()).error||t}catch(s){console.warn("Delete: could not parse error JSON",s)}alert(t)})).finally((()=>{this.deletingReportId=null})))}}};function qo(e){return"number"===typeof e?e:Date.parse(e)}const Ko=(0,j.A)(zo,[["render",No],["__scopeId","data-v-f86708ce"]]);var Go=Ko;const Zo={class:"ns-page"},ei={class:"topbar"},ti={class:"filters"},si={class:"pager",style:{height:"calc(2.5rem + 16px)"}},ai=["disabled"],li=["disabled"],oi={class:"toolbar"},ii={class:"summary-bar"},ni={class:"pill ok"},ri={class:"pill bad"},di={class:"pill mini ok"},ui={class:"pill mini bad"},ci={style:{"margin-bottom":"1rem"}},mi=["disabled","onClick"],hi={key:0,class:"center"},pi={key:1,class:"center"},ki={key:2,class:"center"},fi={key:3,class:"center"},bi={key:4,class:"center"},yi=["onClick"],Li={class:"pair"},_i={class:"v"},gi={key:0,class:"center"},vi={key:1,class:"center"},Si={class:"pair"},Ci={class:"v"},wi={key:0,class:"mini-ts"},Ei={key:1,class:"since-pill"},Ai={key:2,class:"center"},Di={class:"tcount"},xi={key:0},Ii={key:1,class:"since-pill"},Ui={key:3,class:"center"},Fi={class:"tcount"},Ni={class:"num"},$i={key:0,class:"mini-ts"},Mi={key:1,class:"since-pill"},Pi={key:4,class:"center"},Bi={key:0,class:"mini-ts"},Xi={key:1,class:"since-pill"},Ri={class:"center"},Hi=["onClick"],Oi=["onClick"],Ti=["onClick"],Vi={key:0},ji={key:1},Ji={class:"drawer-header"},Qi={key:0,class:"subtitle"},Yi={class:"drawer-body"},Wi={key:0,class:"box"},zi={class:"grid2"},qi={class:"pair"},Ki={class:"v"},Gi={class:"pair"},Zi={class:"v"},en={class:"pair"},tn={class:"v"},sn={class:"pair"},an={class:"v"},ln={class:"pair"},on={class:"v"},nn={class:"pair"},rn={class:"v"},dn={class:"box"},un={key:0},cn={class:"mini"},mn={key:1,class:"muted"},hn={class:"box"},pn={key:0},kn={class:"mini"},fn={key:1,class:"muted"},bn={class:"box"},yn={key:0},Ln={class:"mini"},_n={class:"box"},gn={style:{"margin-bottom":"1rem"}},vn={key:1,class:"muted"},Sn={class:"drawer-footer"},Cn=["disabled"],wn=["disabled"];function En(e,t,s,a,i,n){const r=(0,l.g2)("ExportExcel");return(0,l.uX)(),(0,l.CE)("div",Zo,[t[67]||(t[67]=(0,l.Lk)("h2",null,"Manage Staff Personal Info",-1)),(0,l.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.push("/dashboard")),class:""},"Back"),(0,l.Lk)("div",ei,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.search=e),onInput:t[2]||(t[2]=(...e)=>n.debouncedFetch&&n.debouncedFetch(...e)),type:"search",placeholder:"Search staff by name, email, or staff noâ€¦",class:"search"},null,544),[[u.Jo,i.search]]),(0,l.Lk)("div",ti,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.statusFilter=e)},t[16]||(t[16]=[(0,l.Lk)("option",{value:"all"},"All Status",-1),(0,l.Lk)("option",{value:"complete"},"Complete",-1),(0,l.Lk)("option",{value:"incomplete"},"Incomplete",-1)]),512),[[u.u1,i.statusFilter]])]),(0,l.Lk)("div",si,[(0,l.Lk)("button",{disabled:1===i.page||i.loading,onClick:t[4]||(t[4]=(...e)=>n.prevPage&&n.prevPage(...e))},"Prev",8,ai),(0,l.Lk)("span",null,"Page "+(0,o.v_)(i.page),1),(0,l.Lk)("button",{style:{"margin-left":"8px"},disabled:i.loading||i.items.length<i.pageSize,onClick:t[5]||(t[5]=(...e)=>n.nextPage&&n.nextPage(...e))},"Next",8,li)])]),(0,l.Lk)("div",oi,[(0,l.Lk)("div",ii,[(0,l.Lk)("span",ni,"Complete: "+(0,o.v_)(n.counts.filtered.complete),1),(0,l.Lk)("span",ri,"Incomplete: "+(0,o.v_)(n.counts.filtered.incomplete),1),t[17]||(t[17]=(0,l.Lk)("span",{class:"sep"},"|",-1)),t[18]||(t[18]=(0,l.Lk)("span",{class:"muted"},"All staff â†’",-1)),(0,l.Lk)("span",di,"C: "+(0,o.v_)(n.counts.all.complete),1),(0,l.Lk)("span",ui,"I: "+(0,o.v_)(n.counts.all.incomplete),1)]),(0,l.Lk)("div",ci,[(0,l.Lk)("button",{class:"new-btn",onClick:t[6]||(t[6]=e=>i.showSummaryColumns=!i.showSummaryColumns)},(0,o.v_)(i.showSummaryColumns?"Hide":"Show")+" Details Columns ",1),(0,l.bF)(r,{rows:n.displayedItems,allRows:i.items,columns:n.nsColumns,filename:"non-session.xlsx",sheetName:"Non-Session Data",title:"Export Non-Session Columns"},{trigger:(0,l.k6)((({open:e,disabled:t})=>[(0,l.Lk)("button",{disabled:t,onClick:e,class:"new-btn"},"Export Excel",8,mi)])),_:1},8,["rows","allRows","columns"])])]),(0,l.Lk)("div",{class:"table-wrap",onScroll:t[8]||(t[8]=(...e)=>n.onTableScroll&&n.onTableScroll(...e))},[(0,l.Lk)("table",null,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[t[19]||(t[19]=(0,l.Lk)("th",null,"Name",-1)),i.showSummaryColumns?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("th",hi,"Staff Info Status")),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("th",pi,"Personal Info")):(0,l.Q3)("",!0),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("th",ki,"Occupational History")):(0,l.Q3)("",!0),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("th",fi,"Family (named entries)")):(0,l.Q3)("",!0),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("th",bi,"Family Disease")):(0,l.Q3)("",!0),t[20]||(t[20]=(0,l.Lk)("th",{class:"center"},"Session Counts",-1)),t[21]||(t[21]=(0,l.Lk)("th",{class:"nowrap",style:{}},"Actions",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.displayedItems,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.staff_email,onClick:t=>n.openDetails(e),class:"clickable"},[(0,l.Lk)("td",null,[(0,l.Lk)("div",Li,[(0,l.Lk)("span",_i,(0,o.v_)(e.staff_name||"-"),1)])]),i.showSummaryColumns?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("td",gi,[(0,l.Lk)("span",{class:(0,o.C4)(["chip",e.non_session_score>=3?"ok":"bad"])},(0,o.v_)(e.non_session_score>=3?"Complete":"Incomplete"),3)])),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("td",vi,[(0,l.Lk)("span",{class:(0,o.C4)(["chip",e.staff_info_complete?"ok":"bad"])},(0,o.v_)(e.staff_info_complete?"Complete":"Incomplete"),3),t[24]||(t[24]=(0,l.Lk)("br",null,null,-1)),t[25]||(t[25]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("div",Si,[t[22]||(t[22]=(0,l.Lk)("span",{class:"k"},"Doctor:",-1)),t[23]||(t[23]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("span",Ci,(0,o.v_)(e.personal_doctor_email||"-"),1)]),t[26]||(t[26]=(0,l.Lk)("br",null,null,-1)),e.staff_updated_at?((0,l.uX)(),(0,l.CE)("div",wi,(0,o.v_)(n.formatDate(e.staff_updated_at)),1)):(0,l.Q3)("",!0),t[27]||(t[27]=(0,l.Lk)("br",null,null,-1)),n.sinceCreated(e,"staff")?((0,l.uX)(),(0,l.CE)("div",Ei,"since created")):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("td",Ai,[(0,l.Lk)("div",Di,[e.occ_updated_at?((0,l.uX)(),(0,l.CE)("small",xi,(0,o.v_)(n.formatDate(e.occ_updated_at)),1)):(0,l.Q3)("",!0),t[28]||(t[28]=(0,l.Lk)("br",null,null,-1)),n.sinceCreated(e,"occ")?((0,l.uX)(),(0,l.CE)("div",Ii,"since created")):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("td",Ui,[(0,l.Lk)("span",{class:(0,o.C4)(["chip",e.family_min_ok?"ok":"bad"])},(0,o.v_)(e.family_min_ok?"Complete":"Incomplete"),3),t[32]||(t[32]=(0,l.Lk)("br",null,null,-1)),t[33]||(t[33]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("div",Fi,[(0,l.Lk)("span",Ni,(0,o.v_)(e.fam_named_count??0),1),t[29]||(t[29]=(0,l.Lk)("br",null,null,-1)),t[30]||(t[30]=(0,l.Lk)("br",null,null,-1)),e.fam_updated_at?((0,l.uX)(),(0,l.CE)("div",$i,(0,o.v_)(n.formatDate(e.fam_updated_at)),1)):(0,l.Q3)("",!0),t[31]||(t[31]=(0,l.Lk)("br",null,null,-1)),n.sinceCreated(e,"fam")?((0,l.uX)(),(0,l.CE)("div",Mi,"since created")):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0),i.showSummaryColumns?((0,l.uX)(),(0,l.CE)("td",Pi,[(0,l.Lk)("span",{class:(0,o.C4)(["chip",e.fhd_answered?"ok":"bad"])},(0,o.v_)(e.fhd_answered?"Complete":"Incomplete"),3),t[34]||(t[34]=(0,l.Lk)("br",null,null,-1)),t[35]||(t[35]=(0,l.Lk)("br",null,null,-1)),e.fhd_updated_at?((0,l.uX)(),(0,l.CE)("div",Bi,(0,o.v_)(n.formatDate(e.fhd_updated_at)),1)):(0,l.Q3)("",!0),t[36]||(t[36]=(0,l.Lk)("br",null,null,-1)),n.sinceCreated(e,"fhd")?((0,l.uX)(),(0,l.CE)("div",Xi,"since created")):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("td",Ri,(0,o.v_)(e.session_count),1),(0,l.Lk)("td",{class:"center",onClick:t[7]||(t[7]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("button",{onClick:t=>n.goEditStaff(e.staff_email)},"Open",8,Hi),(0,l.Lk)("button",{onClick:t=>n.goSessions(e.staff_email)},"View Sessions",8,Oi),(0,l.Lk)("button",{onClick:t=>n.openDetails(e)},"Preview Details",8,Ti)])],8,yi)))),128)),i.loading||0!==n.displayedItems.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",Vi,t[37]||(t[37]=[(0,l.Lk)("td",{colspan:"8",class:"empty"},"No staff found for this filter.",-1)]))),i.loading?((0,l.uX)(),(0,l.CE)("tr",ji,t[38]||(t[38]=[(0,l.Lk)("td",{colspan:"8",class:"loading"},"Loadingâ€¦",-1)]))):(0,l.Q3)("",!0)])])],32),(0,l.Lk)("div",{class:"x-scroll",ref:"xScroll",onScroll:t[9]||(t[9]=(...e)=>n.onXScroll&&n.onXScroll(...e))},[(0,l.Lk)("div",{style:(0,o.Tr)({width:i.tableScrollWidth+"px",height:"1px"})},null,4)],544),(0,l.Lk)("div",{class:(0,o.C4)(["drawer",{open:i.detailOpen}]),onClick:t[15]||(t[15]=(0,u.D$)(((...e)=>n.closeDetails&&n.closeDetails(...e)),["self"]))},[(0,l.Lk)("div",{class:"drawer-panel",onClick:t[14]||(t[14]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",Ji,[(0,l.Lk)("div",null,[t[39]||(t[39]=(0,l.Lk)("div",{class:"title"},[(0,l.Lk)("strong",null," Non-Session Details")],-1)),i.detail?.staff?((0,l.uX)(),(0,l.CE)("div",Qi,(0,o.v_)(i.detail.staff.staff_name||"(no name)")+" â€” "+(0,o.v_)(i.detail.staff.staff_email),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("button",{class:"x",onClick:t[10]||(t[10]=(...e)=>n.closeDetails&&n.closeDetails(...e))},"âœ•")]),(0,l.Lk)("div",Yi,[i.detail?.staff?((0,l.uX)(),(0,l.CE)("section",Wi,[t[46]||(t[46]=(0,l.Lk)("h4",null,"Staff Info",-1)),(0,l.Lk)("div",zi,[(0,l.Lk)("div",qi,[t[40]||(t[40]=(0,l.Lk)("span",{class:"k"},"Staff No:",-1)),(0,l.Lk)("span",Ki,(0,o.v_)(i.detail.staff.staff_no||"-"),1)]),(0,l.Lk)("div",Gi,[t[41]||(t[41]=(0,l.Lk)("span",{class:"k"},"Job Title / Position:",-1)),(0,l.Lk)("span",Zi,(0,o.v_)(i.detail.staff.job_title||"-"),1)]),(0,l.Lk)("div",en,[t[42]||(t[42]=(0,l.Lk)("span",{class:"k"},"Department:",-1)),(0,l.Lk)("span",tn,(0,o.v_)(i.detail.staff.department||"-"),1)]),(0,l.Lk)("div",sn,[t[43]||(t[43]=(0,l.Lk)("span",{class:"k"},"Nationality:",-1)),(0,l.Lk)("span",an,(0,o.v_)(i.detail.staff.nationality||"-"),1)]),(0,l.Lk)("div",ln,[t[44]||(t[44]=(0,l.Lk)("span",{class:"k"},"Phone:",-1)),(0,l.Lk)("span",on,(0,o.v_)(i.detail.staff.phone_no||"-"),1)]),(0,l.Lk)("div",nn,[t[45]||(t[45]=(0,l.Lk)("span",{class:"k"},"Address:",-1)),(0,l.Lk)("span",rn,(0,o.v_)(i.detail.staff.address||"-"),1)])])])):(0,l.Q3)("",!0),(0,l.Lk)("section",dn,[(0,l.Lk)("h4",null,"Occupational History ("+(0,o.v_)(i.detail?.occupational_history?.length||0)+")",1),i.detail?.occupational_history?.length?((0,l.uX)(),(0,l.CE)("div",un,[(0,l.Lk)("table",cn,[t[47]||(t[47]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"#"),(0,l.Lk)("th",null,"Year"),(0,l.Lk)("th",null,"Company"),(0,l.Lk)("th",null,"Location"),(0,l.Lk)("th",null,"Job Title"),(0,l.Lk)("th",null,"Nature of Work")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.detail.occupational_history,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:e.oh_id||t},[(0,l.Lk)("td",null,(0,o.v_)(t+1),1),(0,l.Lk)("td",null,(0,o.v_)(e.year??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.company??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.location??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.job_title??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.nature_of_work??""),1)])))),128))])])])):((0,l.uX)(),(0,l.CE)("div",mn,"No occupational history."))]),(0,l.Lk)("section",hn,[(0,l.Lk)("h4",null,"Family Members ("+(0,o.v_)(i.detail?.family_history?.length||0)+")",1),i.detail?.family_history?.length?((0,l.uX)(),(0,l.CE)("div",pn,[(0,l.Lk)("table",kn,[t[48]||(t[48]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"#"),(0,l.Lk)("th",null,"Relationship"),(0,l.Lk)("th",null,"Name"),(0,l.Lk)("th",null,"Sex"),(0,l.Lk)("th",null,"Year of Birth"),(0,l.Lk)("th",null,"Age"),(0,l.Lk)("th",null,"Age at Death"),(0,l.Lk)("th",null,"Health / Cause of Death")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.detail.family_history,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:e.fh_id||t},[(0,l.Lk)("td",null,(0,o.v_)(t+1),1),(0,l.Lk)("td",null,(0,o.v_)(e.relationship),1),(0,l.Lk)("td",null,(0,o.v_)(e.relative_name??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.sex??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.year_of_born??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.age_now??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.age_at_death??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.state_health_death_cause??"-"),1)])))),128))])])])):((0,l.uX)(),(0,l.CE)("div",fn,"No family members."))]),(0,l.Lk)("section",bn,[t[66]||(t[66]=(0,l.Lk)("h4",null,"Family History Disease",-1)),i.detail?.family_history_disease?((0,l.uX)(),(0,l.CE)("div",yn,[(0,l.Lk)("table",Ln,[t[63]||(t[63]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Disease"),(0,l.Lk)("th",null,"Yes / No")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[49]||(t[49]=(0,l.Lk)("td",null,"Heart disease",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.heart_disease)),1)]),(0,l.Lk)("tr",null,[t[50]||(t[50]=(0,l.Lk)("td",null,"HBP",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.high_blood_pressure)),1)]),(0,l.Lk)("tr",null,[t[51]||(t[51]=(0,l.Lk)("td",null,"Diabetes",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.diabetes)),1)]),(0,l.Lk)("tr",null,[t[52]||(t[52]=(0,l.Lk)("td",null,"Stroke",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.stroke)),1)]),(0,l.Lk)("tr",null,[t[53]||(t[53]=(0,l.Lk)("td",null,"Kidney",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.kidney_disease)),1)]),(0,l.Lk)("tr",null,[t[54]||(t[54]=(0,l.Lk)("td",null,"Allergy",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.allergy)),1)]),(0,l.Lk)("tr",null,[t[55]||(t[55]=(0,l.Lk)("td",null,"Asthma",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.asthma)),1)]),(0,l.Lk)("tr",null,[t[56]||(t[56]=(0,l.Lk)("td",null,"Eczema",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.eczema)),1)]),(0,l.Lk)("tr",null,[t[57]||(t[57]=(0,l.Lk)("td",null,"TB",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.tuberculosis)),1)]),(0,l.Lk)("tr",null,[t[58]||(t[58]=(0,l.Lk)("td",null,"Epilepsy",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.epilepsy)),1)]),(0,l.Lk)("tr",null,[t[59]||(t[59]=(0,l.Lk)("td",null,"Mental Disorder",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.mental_disorder)),1)]),(0,l.Lk)("tr",null,[t[60]||(t[60]=(0,l.Lk)("td",null,"Alcohol",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.alcohol_dependence)),1)]),(0,l.Lk)("tr",null,[t[61]||(t[61]=(0,l.Lk)("td",null,"Drugs",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.drug_abuse)),1)]),(0,l.Lk)("tr",null,[t[62]||(t[62]=(0,l.Lk)("td",null,"Birth abnormality",-1)),(0,l.Lk)("td",null,(0,o.v_)(n.yn(i.detail.family_history_disease.birth_abnormality)),1)])])]),(0,l.Lk)("div",_n,[(0,l.Lk)("p",gn,[t[64]||(t[64]=(0,l.Lk)("b",null,"Details:",-1)),t[65]||(t[65]=(0,l.Lk)("br",null,null,-1)),(0,l.eW)((0,o.v_)(i.detail.family_history_disease.details),1)])])])):((0,l.uX)(),(0,l.CE)("div",vn,"No family disease summary."))])]),(0,l.Lk)("div",Sn,[(0,l.Lk)("button",{onClick:t[11]||(t[11]=e=>n.goEditStaff(i.detail?.staff?.staff_email)),disabled:!i.detail?.staff},"Open Info",8,Cn),(0,l.Lk)("button",{onClick:t[12]||(t[12]=e=>n.goSessions(i.detail?.staff?.staff_email)),disabled:!i.detail?.staff},"View Sessions",8,wn),(0,l.Lk)("button",{class:"ghost",onClick:t[13]||(t[13]=(...e)=>n.closeDetails&&n.closeDetails(...e))},"Close")])])],2)])}var An={name:"NonSessionCompleteness",components:{ExportExcel:Wo},data(){return{loading:!1,tableScrollWidth:0,resizeObs:null,baseUrl:O.A.API_BASE_URL,items:[],search:"",page:1,pageSize:20,statusFilter:"all",showSummaryColumns:!1,openRowMenuId:null,detailOpen:!1,detail:null,t:null}},mounted(){this.fetchSummary(),this.$nextTick((()=>this.measureXBar())),window.addEventListener("resize",this.measureXBar),this.resizeObs=new ResizeObserver((()=>this.measureXBar()));const e=this.$el.querySelector(".table-wrap");e&&this.resizeObs.observe(e)},beforeUnmount(){window.removeEventListener("resize",this.measureXBar),this.resizeObs&&this.resizeObs.disconnect()},computed:{isAdminRole(){const e=localStorage.getItem("user_info");if(e)try{const t=JSON.parse(e);return"admin"===t.role}catch(t){return console.error("Error parsing user_info from localStorage:",t),!1}return!1},displayedItems(){const e=Array.isArray(this.items)?this.items:[],t=(this.search||"").toLowerCase();let s=e.filter((e=>{const s=`${e.staff_name||""} ${e.staff_email||""} ${e.staff_no||""}`.toLowerCase();return!t||s.includes(t)}));return"all"!==this.statusFilter&&(s=s.filter((e=>this.rowStatus(e)===this.statusFilter))),s},counts(){const e={complete:0,incomplete:0},t={complete:0,incomplete:0};for(const s of Array.isArray(this.items)?this.items:[]){const t=this.rowStatus(s);e[t]=(e[t]||0)+1}for(const s of this.displayedItems){const e=this.rowStatus(s);t[e]=(t[e]||0)+1}return{all:e,filtered:t}},nsColumns(){return[{key:"staff_name",label:"Name"},{key:"staff_email",label:"Email"},{key:"staff_no",label:"Staff No"},{key:"job_title",label:"Job Title / Position"},{key:"department",label:"Department"},{key:"staff_info_complete",label:"Staff Info Complete",format:e=>e?"Yes":"No"},{key:"family_min_ok",label:"Family Minimum OK",format:e=>e?"Yes":"No"},{key:"fhd_answered",label:"Family Disease Answered",format:e=>e?"Yes":"No"},{key:"occ_count",label:"Occupational Entries"},{key:"fam_named_count",label:"Family Named Entries"},{key:"staff_updated_at",label:"Staff Updated At",format:e=>this.fmtDateTime?.(e)??e??""},{key:"occ_updated_at",label:"Occupational Updated At",format:e=>this.fmtDateTime?.(e)??e??""},{key:"fam_updated_at",label:"Family Updated At",format:e=>this.fmtDateTime?.(e)??e??""},{key:"fhd_updated_at",label:"Family Disease Updated At",format:e=>this.fmtDateTime?.(e)??e??""},{key:"status",label:"Overall Status",getter:e=>this.rowStatus?.(e)??""},{key:"non_session_score",label:"Score"}]}},methods:{formatDate:$s,measureXBar(){const e=this.$el.querySelector(".table-wrap");e&&(this.tableScrollWidth=e.scrollWidth,this.$refs.xScroll&&(this.$refs.xScroll.scrollLeft=e.scrollLeft))},onTableScroll(e){this.$refs.xScroll&&(this.$refs.xScroll.scrollLeft=e.target.scrollLeft)},onXScroll(e){const t=this.$el.querySelector(".table-wrap");t&&(t.scrollLeft=e.target.scrollLeft)},fetchSummary(){this.loading=!0;const e=new URLSearchParams({q:this.search||"",page:String(this.page),page_size:String(this.pageSize)});fetch(`${this.baseUrl}/admin/non-session/summary?${e.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.items=Array.isArray(e)?e:Array.isArray(e.items)?e.items:[]})).catch((()=>{this.items=[]})).finally((()=>{this.loading=!1,this.$nextTick((()=>this.measureXBar()))}))},debouncedFetch(){clearTimeout(this.t),this.t=setTimeout((()=>{this.page=1,this.fetchSummary()}),300)},nextPage(){this.page++,this.fetchSummary()},prevPage(){this.page>1&&(this.page--,this.fetchSummary())},sinceCreated(e,t){const s={staff:e.staff_updated_at,occ:e.occ_updated_at,fam:e.fam_updated_at,fhd:e.fhd_updated_at},a=new Date(s[t]),l=new Date(e.staff_created_at);return a.toDateString()===l.toDateString()&&a.getHours()===l.getHours()&&a.getMinutes()===l.getMinutes()},rowStatus(e){const t=e?.staff_info_complete?1:0,s=e?.family_min_ok?1:0,a=e?.fhd_answered?1:0,l=t&&s&&a;return l?"complete":"incomplete"},fmtDateTime(e){if(!e)return"";const t=new Date(e);if(isNaN(t))return e;const s={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return t.toLocaleString("default",s).replace(/:\d{2}$/,":00")},yn(e){return!0===e||1===e||"1"===e||"Y"===e||"y"===e?"Yes":"No"},openDetails(e){this.openRowMenuId=null,this.detailOpen=!0,this.detail=null;const t=encodeURIComponent(e.staff_email.replace(/\./g,"XYZ"));fetch(`${this.baseUrl}/admin/non-session/staff/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{this.detail=e||{}})).catch((()=>{}))},closeDetails(){this.detailOpen=!1,this.detail=null,this.openRowMenuId=null},goSessions(e){if(this.openRowMenuId=null,!e)return;const t=encodeURIComponent(e);this.isAdminRole?this.$router.push(`/admin/manage-sessions?staff=${t}`):this.$router.push(`/doctor/manage-sessions?staff=${t}`)},goEditStaff(e){if(this.openRowMenuId=null,!e)return;const t=encodeURIComponent(e);console.log("goEditStaff",t),this.$router.push(`/admin/non-session/${t}`)}}};const Dn=(0,j.A)(An,[["render",En],["__scopeId","data-v-058d56ae"]]);var xn=Dn;const In={key:0},Un={key:0},Fn={key:1},Nn={key:2},$n={key:1};function Mn(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)(l.FK,null,[t[32]||(t[32]=(0,l.Lk)("h2",null,"User Details",-1)),(0,l.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.push("/admin/manage-users"))},"Back to Manage Users"),i.user?((0,l.uX)(),(0,l.CE)("div",In,["doctor"===i.role?((0,l.uX)(),(0,l.CE)("div",Un,[t[4]||(t[4]=(0,l.Lk)("h3",null,"Doctor Details",-1)),(0,l.Lk)("p",null,[t[1]||(t[1]=(0,l.Lk)("strong",null,"Email:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.doctor_email||"-"),1)]),(0,l.Lk)("p",null,[t[2]||(t[2]=(0,l.Lk)("strong",null,"Name:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.doctor_name||"-"),1)]),(0,l.Lk)("p",null,[t[3]||(t[3]=(0,l.Lk)("strong",null,"Phone Number:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.phone_no||"-"),1)])])):"staff"===i.role?((0,l.uX)(),(0,l.CE)("div",Fn,[t[25]||(t[25]=(0,l.Lk)("h3",null,"Staff Details",-1)),(0,l.Lk)("p",null,[t[5]||(t[5]=(0,l.Lk)("strong",null,"Role:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.role),1)]),(0,l.Lk)("p",null,[t[6]||(t[6]=(0,l.Lk)("strong",null,"Staff UID:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.staff_uid),1)]),(0,l.Lk)("p",null,[t[7]||(t[7]=(0,l.Lk)("strong",null,"Email:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.staff_email),1)]),(0,l.Lk)("p",null,[t[8]||(t[8]=(0,l.Lk)("strong",null,"Name:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.staff_name||"-"),1)]),(0,l.Lk)("p",null,[t[9]||(t[9]=(0,l.Lk)("strong",null,"Created At:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.created_at||"-"),1)]),(0,l.Lk)("p",null,[t[10]||(t[10]=(0,l.Lk)("strong",null,"Last Updated:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.updated_at||"-"),1)]),(0,l.Lk)("p",null,[t[11]||(t[11]=(0,l.Lk)("strong",null,"Marital Status:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.marital_status||"-"),1)]),(0,l.Lk)("p",null,[t[12]||(t[12]=(0,l.Lk)("strong",null,"Sex:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.sex||"-"),1)]),(0,l.Lk)("p",null,[t[13]||(t[13]=(0,l.Lk)("strong",null,"Date of Birth:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.date_of_birth||"-"),1)]),(0,l.Lk)("p",null,[t[14]||(t[14]=(0,l.Lk)("strong",null,"Year of Birth:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.year_of_born||"-"),1)]),(0,l.Lk)("p",null,[t[15]||(t[15]=(0,l.Lk)("strong",null,"Age:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.age||"-"),1)]),(0,l.Lk)("p",null,[t[16]||(t[16]=(0,l.Lk)("strong",null,"IC/Passport:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.ic_passport||"-"),1)]),(0,l.Lk)("p",null,[t[17]||(t[17]=(0,l.Lk)("strong",null,"Nationality:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.nationality||"-"),1)]),(0,l.Lk)("p",null,[t[18]||(t[18]=(0,l.Lk)("strong",null,"Job Title:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.job_title||"-"),1)]),(0,l.Lk)("p",null,[t[19]||(t[19]=(0,l.Lk)("strong",null,"Staff No:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.staff_no||"-"),1)]),(0,l.Lk)("p",null,[t[20]||(t[20]=(0,l.Lk)("strong",null,"Phone No:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.phone_no||"-"),1)]),(0,l.Lk)("p",null,[t[21]||(t[21]=(0,l.Lk)("strong",null,"Address:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.address||"-"),1)]),(0,l.Lk)("p",null,[t[22]||(t[22]=(0,l.Lk)("strong",null,"Personal Doctor Email:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.personal_doctor_email||"N/A"),1)]),(0,l.Lk)("p",null,[t[23]||(t[23]=(0,l.Lk)("strong",null,"Doctor Phone No:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.doctor_phone_no||"N/A"),1)]),(0,l.Lk)("p",null,[t[24]||(t[24]=(0,l.Lk)("strong",null,"Reason for Examination:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.reason_for_examination),1)])])):"admin"===i.role?((0,l.uX)(),(0,l.CE)("div",Nn,[t[30]||(t[30]=(0,l.Lk)("h3",null,"Admin Details",-1)),(0,l.Lk)("p",null,[t[26]||(t[26]=(0,l.Lk)("strong",null,"Email:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.admin_email||"-"),1)]),(0,l.Lk)("p",null,[t[27]||(t[27]=(0,l.Lk)("strong",null,"Name:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.admin_name||"-"),1)]),(0,l.Lk)("p",null,[t[28]||(t[28]=(0,l.Lk)("strong",null,"Department:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.department||"-"),1)]),(0,l.Lk)("p",null,[t[29]||(t[29]=(0,l.Lk)("strong",null,"Phone No:",-1)),(0,l.eW)(" "+(0,o.v_)(i.user.phone_no||"-"),1)])])):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("div",$n,t[31]||(t[31]=[(0,l.Lk)("p",null,"Loading user data...",-1)])))],64)}var Pn={data(){return{baseUrl:O.A.API_BASE_URL,user:null,role:""}},mounted(){const e=this.$route.params.email.replace(/\./g,"XYZ");this.fetchUserInfo(e)},methods:{async fetchUserInfo(e){try{const t=await fetch(`${this.baseUrl}/user/role-based/${e}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"}}),s=await t.json();t.ok?(this.user=s,this.role=s.role):(0,T.$)(t)||alert("Error fetching user data: "+s.error)}catch(t){console.error("Error:",t),alert("Failed to load user data")}}}};const Bn=(0,j.A)(Pn,[["render",Mn]]);var Xn=Bn;const Rn={class:"pretty"},Hn={class:"form-grid"},On={class:"field"},Tn={class:"field"},Vn={class:"field"},jn={class:"field"},Jn={class:"field"},Qn={class:"field"},Yn={class:"field"},Wn={class:"field"},zn={class:"field"},qn={class:"field"},Kn={class:"field"},Gn={class:"field"},Zn={class:"field span-2"},er={class:"field"},tr={class:"field"},sr={class:"field"},ar={class:"field"},lr={class:"field span-2"},or={class:"modal-actions"},ir=["disabled"];function nr(e,t,s,a,i,n){const r=(0,l.g2)("VueDatePicker");return(0,l.uX)(),(0,l.CE)("div",null,[t[87]||(t[87]=(0,l.Lk)("h2",null,"Staff Personal Information",-1)),(0,l.Lk)("button",{class:"action-btn",onClick:t[0]||(t[0]=(...e)=>n.openModal&&n.openModal(...e))},"Edit"),(0,l.Lk)("table",Rn,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[24]||(t[24]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Full Name:")],-1)),t[25]||(t[25]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.staff_name||"-"),1)]),(0,l.Lk)("tr",null,[t[26]||(t[26]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Email:")],-1)),t[27]||(t[27]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.staff_email||"-"),1)]),(0,l.Lk)("tr",null,[t[28]||(t[28]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Last Updated at:")],-1)),t[29]||(t[29]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(n.formatDate(i.staffData.updated_at)||"-"),1)]),(0,l.Lk)("tr",null,[t[30]||(t[30]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Marital Status:")],-1)),t[31]||(t[31]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.marital_status?i.staffData.marital_status.charAt(0).toUpperCase()+i.staffData.marital_status.slice(1):"-"),1)]),(0,l.Lk)("tr",null,[t[32]||(t[32]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Gender:")],-1)),t[33]||(t[33]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)("M"===i.staffData.sex?"Male":"F"===i.staffData.sex?"Female":"-"),1)]),(0,l.Lk)("tr",null,[t[34]||(t[34]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Date of Birth:")],-1)),t[35]||(t[35]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(n.formatDateShort(i.staffData.date_of_birth)||"-"),1)]),(0,l.Lk)("tr",null,[t[36]||(t[36]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Year of Born:")],-1)),t[37]||(t[37]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.year_of_born??"-"),1)]),(0,l.Lk)("tr",null,[t[38]||(t[38]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Age:")],-1)),t[39]||(t[39]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.age??"-"),1)]),(0,l.Lk)("tr",null,[t[40]||(t[40]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"IC Passport:")],-1)),t[41]||(t[41]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.ic_passport||"-"),1)]),(0,l.Lk)("tr",null,[t[42]||(t[42]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Nationality:")],-1)),t[43]||(t[43]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.nationality||"-"),1)]),(0,l.Lk)("tr",null,[t[44]||(t[44]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Job Title / Position:")],-1)),t[45]||(t[45]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.job_title||"-"),1)]),(0,l.Lk)("tr",null,[t[46]||(t[46]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Department:")],-1)),t[47]||(t[47]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.department||"-"),1)]),(0,l.Lk)("tr",null,[t[48]||(t[48]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Staff No:")],-1)),t[49]||(t[49]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.staff_no||"-"),1)]),(0,l.Lk)("tr",null,[t[50]||(t[50]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Phone No:")],-1)),t[51]||(t[51]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.phone_no||"-"),1)]),(0,l.Lk)("tr",null,[t[52]||(t[52]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Address:")],-1)),t[53]||(t[53]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.address||"-"),1)]),(0,l.Lk)("tr",null,[t[54]||(t[54]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Personal Doctor Email:")],-1)),t[55]||(t[55]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.personal_doctor_email||"-"),1)]),(0,l.Lk)("tr",null,[t[56]||(t[56]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Doctor's Phone No:")],-1)),t[57]||(t[57]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.doctor_phone_no||"-"),1)]),(0,l.Lk)("tr",null,[t[58]||(t[58]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Reason for Examination:")],-1)),t[59]||(t[59]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.staffData.reason_for_examination||"-"),1)]),(0,l.Lk)("tr",null,[t[60]||(t[60]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Date of This (Current) Assessment:")],-1)),t[61]||(t[61]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(n.formatDateShort(i.staffData.date_of_this_assessment)||"-"),1)]),(0,l.Lk)("tr",null,[t[62]||(t[62]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Date of Last Assessment:")],-1)),t[63]||(t[63]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(n.formatDateShort(i.staffData.date_of_last_assessment)||"-"),1)])])]),i.isModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:t[23]||(t[23]=(...e)=>n.closeModal&&n.closeModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[22]||(t[22]=(0,u.D$)((()=>{}),["stop"]))},[t[86]||(t[86]=(0,l.Lk)("h3",null,"Edit Staff Personal Information",-1)),(0,l.Lk)("form",{onSubmit:t[21]||(t[21]=(0,u.D$)(((...e)=>n.submitStaffEdit&&n.submitStaffEdit(...e)),["prevent"]))},[(0,l.Lk)("div",Hn,[(0,l.Lk)("div",On,[t[64]||(t[64]=(0,l.Lk)("label",null,"Full Name",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.modalStaff.staff_name=e),required:""},null,512),[[u.Jo,i.modalStaff.staff_name]])]),(0,l.Lk)("div",Tn,[t[66]||(t[66]=(0,l.Lk)("label",null,"Marital Status",-1)),(0,l.bo)((0,l.Lk)("select",{style:{"margin-top":"0.5px"},"onUpdate:modelValue":t[2]||(t[2]=e=>i.modalStaff.marital_status=e)},t[65]||(t[65]=[(0,l.Lk)("option",{value:"single"},"Single",-1),(0,l.Lk)("option",{value:"married"},"Married",-1),(0,l.Lk)("option",{value:"divorced"},"Divorced",-1)]),512),[[u.u1,i.modalStaff.marital_status]])]),(0,l.Lk)("div",Vn,[t[68]||(t[68]=(0,l.Lk)("label",null,"Gender",-1)),(0,l.bo)((0,l.Lk)("select",{style:{"margin-top":"0.5px"},"onUpdate:modelValue":t[3]||(t[3]=e=>i.modalStaff.sex=e)},t[67]||(t[67]=[(0,l.Lk)("option",{value:"M"},"Male",-1),(0,l.Lk)("option",{value:"F"},"Female",-1)]),512),[[u.u1,i.modalStaff.sex]])]),(0,l.Lk)("div",jn,[t[69]||(t[69]=(0,l.Lk)("label",null,"Date of Birth",-1)),(0,l.bF)(r,{modelValue:i.modalStaff.date_of_birth,"onUpdate:modelValue":t[4]||(t[4]=e=>i.modalStaff.date_of_birth=e),"max-date":new Date,"year-range":[1900,(new Date).getFullYear()],"auto-apply":"","enable-time-picker":!1},null,8,["modelValue","max-date","year-range"])]),(0,l.Lk)("div",Jn,[t[70]||(t[70]=(0,l.Lk)("label",null,"Year of Born",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=e=>i.modalStaff.year_of_born=e),onInput:t[6]||(t[6]=(...e)=>n.syncAgeFromYear&&n.syncAgeFromYear(...e))},null,544),[[u.Jo,i.modalStaff.year_of_born,void 0,{number:!0}]])]),(0,l.Lk)("div",Qn,[t[71]||(t[71]=(0,l.Lk)("label",null,"Age",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>i.modalStaff.age=e)},null,512),[[u.Jo,i.modalStaff.age,void 0,{number:!0}]])]),(0,l.Lk)("div",Yn,[t[72]||(t[72]=(0,l.Lk)("label",null,[(0,l.eW)("IC / Passport "),(0,l.Lk)("small",{class:"mini-ts"},"- without dash (-)")],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>i.modalStaff.ic_passport=e),pattern:"[0-9a-zA-Z]*"},null,512),[[u.Jo,i.modalStaff.ic_passport]])]),(0,l.Lk)("div",Wn,[t[73]||(t[73]=(0,l.Lk)("label",null,"Nationality",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>i.modalStaff.nationality=e)},null,512),[[u.Jo,i.modalStaff.nationality]])]),(0,l.Lk)("div",zn,[t[74]||(t[74]=(0,l.Lk)("label",null,"Job Title / Position",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>i.modalStaff.job_title=e)},null,512),[[u.Jo,i.modalStaff.job_title]])]),(0,l.Lk)("div",qn,[t[76]||(t[76]=(0,l.Lk)("label",null,"Department",-1)),(0,l.bo)((0,l.Lk)("select",{style:{"margin-top":"0.5px"},"onUpdate:modelValue":t[11]||(t[11]=e=>i.modalStaff.department=e),required:""},t[75]||(t[75]=[(0,l.Fv)('<option value="OPS-A" data-v-17f52c08>OPS-A</option><option value="OPS-B" data-v-17f52c08>OPS-B</option><option value="OPS-C" data-v-17f52c08>OPS-C</option><option value="OPS-D" data-v-17f52c08>OPS-D</option><option value="OPS-Normal" data-v-17f52c08>OPS-Normal</option><option value="E&amp;M" data-v-17f52c08>E&amp;M</option><option value="HSE" data-v-17f52c08>HSE</option><option value="CS-Comm" data-v-17f52c08>CS &amp; Commercial</option><option value="Finance" data-v-17f52c08>Finance</option><option value="HR" data-v-17f52c08>HR</option><option value="IT" data-v-17f52c08>IT</option><option value="MO" data-v-17f52c08>MO</option>',12)]),512),[[u.u1,i.modalStaff.department]])]),(0,l.Lk)("div",Kn,[t[77]||(t[77]=(0,l.Lk)("label",null,"Staff No",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>i.modalStaff.staff_no=e)},null,512),[[u.Jo,i.modalStaff.staff_no]])]),(0,l.Lk)("div",Gn,[t[78]||(t[78]=(0,l.Lk)("label",null,"Phone No",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>i.modalStaff.phone_no=e)},null,512),[[u.Jo,i.modalStaff.phone_no]])]),(0,l.Lk)("div",Zn,[t[79]||(t[79]=(0,l.Lk)("label",null,"Address",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>i.modalStaff.address=e)},null,512),[[u.Jo,i.modalStaff.address]])]),(0,l.Lk)("div",er,[t[80]||(t[80]=(0,l.Lk)("label",null,"Personal Doctor Email",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>i.modalStaff.personal_doctor_email=e),readonly:"",class:"readonly"},null,512),[[u.Jo,i.modalStaff.personal_doctor_email]])]),(0,l.Lk)("div",tr,[t[81]||(t[81]=(0,l.Lk)("label",null,"Doctor's Phone No",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>i.modalStaff.doctor_phone_no=e),readonly:"",class:"readonly"},null,512),[[u.Jo,i.modalStaff.doctor_phone_no]])]),(0,l.Lk)("div",sr,[t[82]||(t[82]=(0,l.Lk)("label",null,"Date of This (Current) Assessment",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>i.modalStaff.date_of_this_assessment=e),readonly:"",class:"readonly"},null,512),[[u.Jo,i.modalStaff.date_of_this_assessment]])]),(0,l.Lk)("div",ar,[t[83]||(t[83]=(0,l.Lk)("label",null,"Date of Last Assessment",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>i.modalStaff.date_of_last_assessment=e),readonly:"",class:"readonly"},null,512),[[u.Jo,i.modalStaff.date_of_last_assessment]])]),(0,l.Lk)("div",lr,[t[85]||(t[85]=(0,l.Lk)("label",null,"Reason for Examination",-1)),(0,l.bo)((0,l.Lk)("select",{style:{"margin-top":"0.5px"},"onUpdate:modelValue":t[19]||(t[19]=e=>i.modalStaff.reason_for_examination=e),required:""},t[84]||(t[84]=[(0,l.Lk)("option",{value:"Pre-employment"},"Pre-employment",-1),(0,l.Lk)("option",{value:"Periodic / Medical Surveillance"},"Periodic / Medical Surveillance",-1)]),512),[[u.u1,i.modalStaff.reason_for_examination]])])]),(0,l.Lk)("div",or,[(0,l.Lk)("button",{type:"submit",class:"action-btn",disabled:!n.isModalChanged}," Save Changes ",8,ir),(0,l.Lk)("button",{type:"button",class:"action-btn",onClick:t[20]||(t[20]=(...e)=>n.closeModal&&n.closeModal(...e))},"Cancel")])],32)])])):(0,l.Q3)("",!0)])}var rr={components:{VueDatePicker:Ps.V},name:"ManageStaffInfo",data(){return{baseUrl:O.A.API_BASE_URL,isModalOpen:!1,staffData:{staff_uid:"",staff_email:"",staff_name:"",updated_at:"",marital_status:"",sex:"",date_of_birth:null,year_of_born:null,age:null,ic_passport:"",nationality:"",job_title:"",department:"",staff_no:"",phone_no:"",address:"",personal_doctor_email:"",doctor_phone_no:"",reason_for_examination:"",date_of_this_assessment:"",date_of_last_assessment:""},originalStaffData:null,modalStaff:{}}},computed:{isFormChanged(){if(!this.originalStaffData)return!1;const e=["staff_name","marital_status","sex","date_of_birth","year_of_born","age","ic_passport","nationality","job_title","department","staff_no","phone_no","address","personal_doctor_email","doctor_phone_no","reason_for_examination"];return e.some((e=>this.staffData[e]!==this.originalStaffData[e]))},isModalChanged(){if(!this.originalStaffData)return!1;const e=["staff_name","marital_status","sex","date_of_birth","year_of_born","age","ic_passport","nationality","job_title","department","staff_no","phone_no","address","personal_doctor_email","doctor_phone_no","reason_for_examination"];return e.some((e=>this.modalStaff[e]!==this.originalStaffData[e]))}},mounted(){this.fetchStaffInfo()},methods:{formatDateShort:Ms,formatDate:$s,fetchStaffInfo(){const e=localStorage.getItem("user_info");if(!e)return;const t=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",s=t.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/staff/info/${encodeURIComponent(s)}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.staffData=e||{},this.originalStaffData=JSON.parse(JSON.stringify(this.staffData))})).catch((e=>{console.error("Error fetching staff info:",e),alert("Failed to fetch staff info.")}))},openModal(){this.modalStaff=JSON.parse(JSON.stringify(this.staffData)),this.isModalOpen=!0},closeModal(){this.isModalOpen=!1,this.modalStaff=JSON.parse(JSON.stringify(this.staffData))},syncAgeFromYear(){const e=Number(this.modalStaff.year_of_born);if(e&&e>1900){const t=new Date,s=t.getFullYear()-e;this.modalStaff.age=s}},submitStaffEdit(){const e=(this.modalStaff.staff_email||this.staffData.staff_email||"").replace(/\./g,"XYZ");fetch(`${this.baseUrl}/staff/edit-info/${e}`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(this.modalStaff)}).then((e=>e.json())).then((()=>{alert("Personal info updated successfully"),this.isModalOpen=!1,this.fetchStaffInfo()})).catch((e=>{console.error("Error updating staff data:",e),alert("Failed to update data.")}))}}};const dr=(0,j.A)(rr,[["render",nr],["__scopeId","data-v-17f52c08"]]);var ur=dr;const cr={type:"submit"},mr={key:0},hr=["onClick"],pr=["onClick"];function kr(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[t[22]||(t[22]=(0,l.Lk)("h2",null,"Occupational History",-1)),i.isModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay-vertical",onClick:t[8]||(t[8]=(...e)=>n.closeModal&&n.closeModal(...e))},[(0,l.Lk)("div",{class:"modal-content-vertical",onClick:t[7]||(t[7]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("h3",null,(0,o.v_)(i.editingHistory?"Edit Occupational History":"Add New Occupational History"),1),(0,l.Lk)("form",{onSubmit:t[6]||(t[6]=(0,u.D$)(((...e)=>n.submitEntry&&n.submitEntry(...e)),["prevent"]))},[t[10]||(t[10]=(0,l.Lk)("label",{for:"year"},"Year:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=e=>i.modalHistory.year=e),required:""},null,512),[[u.Jo,i.modalHistory.year]]),t[11]||(t[11]=(0,l.Lk)("br",null,null,-1)),t[12]||(t[12]=(0,l.Lk)("label",{for:"company"},"Company:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.modalHistory.company=e),required:""},null,512),[[u.Jo,i.modalHistory.company]]),t[13]||(t[13]=(0,l.Lk)("br",null,null,-1)),t[14]||(t[14]=(0,l.Lk)("label",{for:"location"},"Location:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>i.modalHistory.location=e),required:""},null,512),[[u.Jo,i.modalHistory.location]]),t[15]||(t[15]=(0,l.Lk)("br",null,null,-1)),t[16]||(t[16]=(0,l.Lk)("label",{for:"job_title"},"Job Title:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>i.modalHistory.job_title=e),required:""},null,512),[[u.Jo,i.modalHistory.job_title]]),t[17]||(t[17]=(0,l.Lk)("br",null,null,-1)),t[18]||(t[18]=(0,l.Lk)("label",{for:"nature_of_work"},"Nature of Work:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>i.modalHistory.nature_of_work=e),required:""},null,512),[[u.Jo,i.modalHistory.nature_of_work]]),t[19]||(t[19]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("button",cr,(0,o.v_)(i.editingHistory?"Save Changes":"Add Entry"),1),(0,l.Lk)("button",{type:"button",onClick:t[5]||(t[5]=(...e)=>n.closeModal&&n.closeModal(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",null,[(0,l.Lk)("table",null,[t[21]||(t[21]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"#"),(0,l.Lk)("th",null,"Year"),(0,l.Lk)("th",null,"Company"),(0,l.Lk)("th",null,"Location"),(0,l.Lk)("th",null,"Job Title"),(0,l.Lk)("th",null,"Nature of Work"),(0,l.Lk)("th",null,"Actions")])],-1)),(0,l.Lk)("tbody",null,[i.occupationalHistory.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",mr,t[20]||(t[20]=[(0,l.Lk)("td",{colspan:"6",class:"empty"},"No occupational history record.",-1)]))),i.occupationalHistory.length?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(i.occupationalHistory,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:t},[(0,l.Lk)("td",null,(0,o.v_)(t+1),1),(0,l.Lk)("td",null,(0,o.v_)(e.year??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.company??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.location??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.job_title??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(e.nature_of_work??"-"),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>n.openEditModal(e)},"Edit",8,hr),(0,l.Lk)("button",{class:"danger",onClick:t=>n.deleteHistory(e)},"Delete",8,pr)])])))),128)):(0,l.Q3)("",!0)])]),(0,l.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>n.openAddModal&&n.openAddModal(...e))},"Add New Entry")])])}var fr={data(){return{baseUrl:O.A.API_BASE_URL,occupationalHistory:[],isModalOpen:!1,editingHistory:null,modalHistory:{year:null,company:"",location:"",job_title:"",nature_of_work:""}}},mounted(){this.fetchOccupationalHistory()},methods:{fetchOccupationalHistory(){const e=localStorage.getItem("user_info");if(!e)return;const t=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",s=t.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/occupational-history/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.occupationalHistory=e})).catch((e=>{console.error(e),this.occupationalHistory=[]}))},openAddModal(){this.editingHistory=null,this.modalHistory={year:null,company:"",location:"",job_title:"",nature_of_work:""},this.isModalOpen=!0},openEditModal(e){this.editingHistory=e,this.modalHistory={...e},this.isModalOpen=!0},closeModal(){this.isModalOpen=!1,this.editingHistory=null,this.modalHistory={year:null,company:"",location:"",job_title:"",nature_of_work:""}},submitEntry(){const e=localStorage.getItem("user_info"),t=localStorage.getItem("jwt_token");if(!e||!t)return alert("User not logged in");const s=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",a=s,l={staff_email:a,year:this.modalHistory.year,company:this.modalHistory.company,location:this.modalHistory.location,job_title:this.modalHistory.job_title,nature_of_work:this.modalHistory.nature_of_work};if(this.editingHistory){const e=`${this.baseUrl}/occupational-history/edit/${this.editingHistory.oh_id}`;fetch(e,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(l)}).then((e=>e.json())).then((()=>{const e=this.occupationalHistory.findIndex((e=>e.oh_id===this.editingHistory.oh_id));-1!==e&&this.occupationalHistory.splice(e,1,{...l,oh_id:this.editingHistory.oh_id}),this.closeModal()})).catch((e=>console.error(e)))}else fetch(`${this.baseUrl}/occupational-history/add`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(l)}).then((e=>e.json())).then((()=>{this.closeModal(),this.fetchOccupationalHistory()})).catch((e=>console.error(e)))},deleteHistory(e){const t=window.confirm("Are you sure you want to delete this history?");t&&fetch(`${this.baseUrl}/occupational-history/delete/${e.oh_id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((()=>{alert("History deleted successfully"),this.occupationalHistory=this.occupationalHistory.filter((t=>t.oh_id!==e.oh_id))})).catch((e=>console.error(e)))}}};const br=(0,j.A)(fr,[["render",kr],["__scopeId","data-v-c950a14a"]]);var yr=br;const Lr={type:"submit"},_r=["onClick"],gr=["onClick"],vr={class:"disease-box",style:{"margin-top":"1rem"}},Sr={style:{display:"flex"}},Cr={class:"disease-table"},wr={class:"disease-table",style:{"margin-left":"auto"}},Er={class:"inv-box"};function Ar(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[t[93]||(t[93]=(0,l.Lk)("h2",null,"Family History",-1)),i.isFamilyModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay-vertical",onClick:t[10]||(t[10]=(...e)=>n.closeFamilyModal&&n.closeFamilyModal(...e))},[(0,l.Lk)("div",{class:"modal-content-vertical",onClick:t[9]||(t[9]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("h3",null,(0,o.v_)(i.editingFamily?"Edit Family Member":"Add Family Member"),1),(0,l.Lk)("form",{onSubmit:t[8]||(t[8]=(0,u.D$)(((...e)=>n.submitFamilyEntry&&n.submitFamilyEntry(...e)),["prevent"]))},[t[36]||(t[36]=(0,l.Lk)("label",null,"Relationship:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.modalFamily.relationship=e),required:""},t[34]||(t[34]=[(0,l.Fv)('<option value="father" data-v-79ccf3bc>Father</option><option value="mother" data-v-79ccf3bc>Mother</option><option value="spouse" data-v-79ccf3bc>Spouse</option><option value="brother" data-v-79ccf3bc>Brother</option><option value="sister" data-v-79ccf3bc>Sister</option><option value="child" data-v-79ccf3bc>Child</option>',6)]),512),[[u.u1,i.modalFamily.relationship]]),t[37]||(t[37]=(0,l.Lk)("br",null,null,-1)),t[38]||(t[38]=(0,l.Lk)("br",null,null,-1)),t[39]||(t[39]=(0,l.Lk)("label",null,"Relative Name:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.modalFamily.relative_name=e),required:""},null,512),[[u.Jo,i.modalFamily.relative_name]]),t[40]||(t[40]=(0,l.Lk)("br",null,null,-1)),t[41]||(t[41]=(0,l.Lk)("label",null,"Sex:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.modalFamily.sex=e)},t[35]||(t[35]=[(0,l.Lk)("option",{value:"M"},"M",-1),(0,l.Lk)("option",{value:"F"},"F",-1)]),512),[[u.u1,i.modalFamily.sex]]),t[42]||(t[42]=(0,l.Lk)("br",null,null,-1)),t[43]||(t[43]=(0,l.Lk)("br",null,null,-1)),t[44]||(t[44]=(0,l.Lk)("label",null,"Year of Birth:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>i.modalFamily.year_of_born=e)},null,512),[[u.Jo,i.modalFamily.year_of_born]]),t[45]||(t[45]=(0,l.Lk)("br",null,null,-1)),t[46]||(t[46]=(0,l.Lk)("label",null,"Age Now:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=e=>i.modalFamily.age_now=e),readonly:"",style:{"background-color":"#f2f2f2"}},null,512),[[u.Jo,i.modalFamily.age_now]]),t[47]||(t[47]=(0,l.Lk)("br",null,null,-1)),t[48]||(t[48]=(0,l.Lk)("label",null,"Age at Death:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=e=>i.modalFamily.age_at_death=e)},null,512),[[u.Jo,i.modalFamily.age_at_death]]),t[49]||(t[49]=(0,l.Lk)("br",null,null,-1)),t[50]||(t[50]=(0,l.Lk)("label",null,"State Health / Death Cause:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>i.modalFamily.state_health_death_cause=e)},null,512),[[u.Jo,i.modalFamily.state_health_death_cause]]),t[51]||(t[51]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("button",Lr,(0,o.v_)(i.editingFamily?"Save Changes":"Add Member"),1),(0,l.Lk)("button",{type:"button",onClick:t[7]||(t[7]=(...e)=>n.closeFamilyModal&&n.closeFamilyModal(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0),i.isDiseaseModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"modal-overlay-vertical",onClick:t[31]||(t[31]=(...e)=>n.closeDiseaseModal&&n.closeDiseaseModal(...e))},[(0,l.Lk)("div",{class:"modal-content-vertical",onClick:t[30]||(t[30]=(0,u.D$)((()=>{}),["stop"])),style:{"overflow-y":"auto","max-height":"90vh"}},[t[70]||(t[70]=(0,l.Lk)("h3",null,"Edit Family Disease",-1)),(0,l.Lk)("form",{onSubmit:t[29]||(t[29]=(0,u.D$)(((...e)=>n.submitDiseaseEntry&&n.submitDiseaseEntry(...e)),["prevent"]))},[(0,l.Lk)("table",null,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[52]||(t[52]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Heart Disease")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>i.modalDisease.heart_disease=e)},null,512),[[u.lH,i.modalDisease.heart_disease]])])]),(0,l.Lk)("tr",null,[t[53]||(t[53]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"High Blood Pressure")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[12]||(t[12]=e=>i.modalDisease.high_blood_pressure=e)},null,512),[[u.lH,i.modalDisease.high_blood_pressure]])])]),(0,l.Lk)("tr",null,[t[54]||(t[54]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Stroke")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[13]||(t[13]=e=>i.modalDisease.stroke=e)},null,512),[[u.lH,i.modalDisease.stroke]])])]),(0,l.Lk)("tr",null,[t[55]||(t[55]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Cancer")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[14]||(t[14]=e=>i.modalDisease.cancer=e)},null,512),[[u.lH,i.modalDisease.cancer]])])]),(0,l.Lk)("tr",null,[t[56]||(t[56]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Diabetes")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[15]||(t[15]=e=>i.modalDisease.diabetes=e)},null,512),[[u.lH,i.modalDisease.diabetes]])])]),(0,l.Lk)("tr",null,[t[57]||(t[57]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Kidney Disease")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[16]||(t[16]=e=>i.modalDisease.kidney_disease=e)},null,512),[[u.lH,i.modalDisease.kidney_disease]])])]),(0,l.Lk)("tr",null,[t[58]||(t[58]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Allergy")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[17]||(t[17]=e=>i.modalDisease.allergy=e)},null,512),[[u.lH,i.modalDisease.allergy]])])]),(0,l.Lk)("tr",null,[t[59]||(t[59]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Asthma")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[18]||(t[18]=e=>i.modalDisease.asthma=e)},null,512),[[u.lH,i.modalDisease.asthma]])])]),(0,l.Lk)("tr",null,[t[60]||(t[60]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Eczema")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[19]||(t[19]=e=>i.modalDisease.eczema=e)},null,512),[[u.lH,i.modalDisease.eczema]])])]),(0,l.Lk)("tr",null,[t[61]||(t[61]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Tuberculosis")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[20]||(t[20]=e=>i.modalDisease.tuberculosis=e)},null,512),[[u.lH,i.modalDisease.tuberculosis]])])]),(0,l.Lk)("tr",null,[t[62]||(t[62]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Epilepsy")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[21]||(t[21]=e=>i.modalDisease.epilepsy=e)},null,512),[[u.lH,i.modalDisease.epilepsy]])])]),(0,l.Lk)("tr",null,[t[63]||(t[63]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Mental Disorder")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[22]||(t[22]=e=>i.modalDisease.mental_disorder=e)},null,512),[[u.lH,i.modalDisease.mental_disorder]])])]),(0,l.Lk)("tr",null,[t[64]||(t[64]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Alcohol Dependence")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[23]||(t[23]=e=>i.modalDisease.alcohol_dependence=e)},null,512),[[u.lH,i.modalDisease.alcohol_dependence]])])]),(0,l.Lk)("tr",null,[t[65]||(t[65]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Drug Abuse")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[24]||(t[24]=e=>i.modalDisease.drug_abuse=e)},null,512),[[u.lH,i.modalDisease.drug_abuse]])])]),(0,l.Lk)("tr",null,[t[66]||(t[66]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Birth Abnormality")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[25]||(t[25]=e=>i.modalDisease.birth_abnormality=e)},null,512),[[u.lH,i.modalDisease.birth_abnormality]])])]),(0,l.Lk)("tr",null,[t[67]||(t[67]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"None of the Above")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[26]||(t[26]=e=>i.modalDisease.none_above=e)},null,512),[[u.lH,i.modalDisease.none_above]])])]),(0,l.Lk)("tr",null,[t[68]||(t[68]=(0,l.Lk)("td",null,[(0,l.Lk)("label",null,"Details:")],-1)),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[27]||(t[27]=e=>i.modalDisease.details=e),style:{height:"150px",width:"100%"}},null,512),[[u.Jo,i.modalDisease.details]])])])])]),t[69]||(t[69]=(0,l.Lk)("button",{type:"submit"},"Save Disease Info",-1)),(0,l.Lk)("button",{type:"button",onClick:t[28]||(t[28]=(...e)=>n.closeDiseaseModal&&n.closeDiseaseModal(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0),(0,l.Lk)("table",null,[t[71]||(t[71]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Relationship"),(0,l.Lk)("th",null,"Relative Name"),(0,l.Lk)("th",null,"Sex"),(0,l.Lk)("th",null,"Year of Birth"),(0,l.Lk)("th",null,"Age"),(0,l.Lk)("th",null,"Age at Death"),(0,l.Lk)("th",null,"State Health / Death Cause"),(0,l.Lk)("th",null,"Actions")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.familyHistory,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.fh_id},[(0,l.Lk)("td",null,(0,o.v_)(e.relationship.charAt(0).toUpperCase()+e.relationship.slice(1)),1),(0,l.Lk)("td",null,(0,o.v_)(e.relative_name??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.sex??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.year_of_born??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.age_now??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.age_at_death??""),1),(0,l.Lk)("td",null,(0,o.v_)(e.state_health_death_cause??""),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{onClick:t=>n.openEditFamilyModal(e)},"Edit",8,_r),(0,l.Lk)("button",{class:"danger",onClick:t=>n.deleteFamilyMember(e)},"Delete",8,gr)])])))),128))])]),(0,l.Lk)("button",{onClick:t[32]||(t[32]=(...e)=>n.openAddFamilyModal&&n.openAddFamilyModal(...e))},"Add Family Member"),(0,l.Lk)("div",vr,[t[92]||(t[92]=(0,l.Lk)("h3",null,"Family History Disease",-1)),(0,l.Lk)("div",Sr,[(0,l.Lk)("table",Cr,[t[80]||(t[80]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Disease"),(0,l.Lk)("th",null,"Yes/No")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[72]||(t[72]=(0,l.Lk)("td",null,"Heart Disease",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.heart_disease?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.heart_disease?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[73]||(t[73]=(0,l.Lk)("td",null,"High Blood Pressure",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.high_blood_pressure?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.high_blood_pressure?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[74]||(t[74]=(0,l.Lk)("td",null,"Stroke",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.stroke?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.stroke?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[75]||(t[75]=(0,l.Lk)("td",null,"Cancer",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.cancer?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.cancer?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[76]||(t[76]=(0,l.Lk)("td",null,"Diabetes",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.diabetes?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.diabetes?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[77]||(t[77]=(0,l.Lk)("td",null,"Kidney Disease",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.kidney_disease?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.kidney_disease?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[78]||(t[78]=(0,l.Lk)("td",null,"Allergy",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.allergy?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.allergy?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[79]||(t[79]=(0,l.Lk)("td",null,"Asthma",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.asthma?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.asthma?"Yes":"No"),5)])])])]),(0,l.Lk)("table",wr,[t[88]||(t[88]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Disease"),(0,l.Lk)("th",null,"Yes/No")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[81]||(t[81]=(0,l.Lk)("td",null,"Eczema",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.eczema?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.eczema?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[82]||(t[82]=(0,l.Lk)("td",null,"Tuberculosis",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.tuberculosis?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.tuberculosis?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[83]||(t[83]=(0,l.Lk)("td",null,"Epilepsy",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.epilepsy?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.epilepsy?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[84]||(t[84]=(0,l.Lk)("td",null,"Nervous or Mental Dependence",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.alcohol_dependence?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.alcohol_dependence?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[85]||(t[85]=(0,l.Lk)("td",null,"Drug Abuse",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.drug_abuse?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.drug_abuse?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[86]||(t[86]=(0,l.Lk)("td",null,"Birth Abnormality",-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.birth_abnormality?"red":"green"})},(0,o.v_)(i.familyHistoryDisease.birth_abnormality?"Yes":"No"),5)])]),(0,l.Lk)("tr",null,[t[87]||(t[87]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"None of the Above")],-1)),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:i.familyHistoryDisease.none_above?"green":"red"})},(0,o.v_)(i.familyHistoryDisease.none_above?"Yes":"No"),5)])])])])]),(0,l.Lk)("div",Er,[t[89]||(t[89]=(0,l.Lk)("strong",null,"Details:",-1)),t[90]||(t[90]=(0,l.eW)()),t[91]||(t[91]=(0,l.Lk)("small",null,[(0,l.Lk)("i",null,"(to be filled by OHD)")],-1)),(0,l.Lk)("p",null,(0,o.v_)(i.familyHistoryDisease.details||"-"),1)])]),(0,l.Lk)("button",{onClick:t[33]||(t[33]=(...e)=>n.openDiseaseModal&&n.openDiseaseModal(...e))},"Edit Family Disease")])}var Dr={data(){return{baseUrl:O.A.API_BASE_URL,familyHistory:[],familyHistoryDisease:[],showInfo:!1,isFamilyModalOpen:!1,editingFamily:null,modalFamily:{relationship:"",relative_name:"",sex:"",year_of_born:null,age_now:null,age_at_death:null,state_health_death_cause:""},isDiseaseModalOpen:!1,modalDisease:{}}},mounted(){this.fetchFamilyHistory(),this.fetchFamilyDisease()},methods:{fetchFamilyHistory(){const e=localStorage.getItem("user_info");if(!e)return;const t=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",s=t.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/family-history/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.familyHistory=e.family_history})).catch((e=>console.error(e)))},asBool(e){if(!0===e||!1===e)return e;if(null==e)return!1;if("number"===typeof e)return 1===e;if("string"===typeof e){const t=e.trim().toLowerCase();return"1"===t||"true"===t||"y"===t||"yes"===t}return!!e},fetchFamilyDisease(){const e=localStorage.getItem("user_info");if(!e)return;const t=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",s=t.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/family-history-disease/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{const t=Array.isArray(e)?e[0]||{}:e;Object.keys(t).forEach((e=>{"staff_email"!==e&&"created_at"!==e&&"updated_at"!==e&&"details"!==e&&(t[e]=this.asBool(t[e]))})),this.familyHistoryDisease=t})).catch((e=>console.error(e)))},openAddFamilyModal(){this.editingFamily=null,this.modalFamily={relationship:"",relative_name:"",sex:"",year_of_born:null,age_now:null,age_at_death:null,state_health_death_cause:""},this.isFamilyModalOpen=!0},openEditFamilyModal(e){this.editingFamily=e,this.modalFamily={...e},this.isFamilyModalOpen=!0},closeFamilyModal(){this.isFamilyModalOpen=!1,this.editingFamily=null},submitFamilyEntry(){const e=localStorage.getItem("user_info");if(!e)return;const t=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",s=t,a={staff_email:s,...this.modalFamily};this.editingFamily?fetch(`${this.baseUrl}/family-history/edit/${this.editingFamily.fh_id}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((()=>{this.closeFamilyModal(),this.fetchFamilyHistory()})).catch((e=>console.error(e))):fetch(`${this.baseUrl}/family-history/add`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((()=>{this.closeFamilyModal(),this.fetchFamilyHistory()})).catch((e=>console.error(e)))},deleteFamilyMember(e){const t=window.confirm("Are you sure you want to delete this member?");t&&fetch(`${this.baseUrl}/family-history/delete/${e.fh_id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((()=>{this.familyHistory=this.familyHistory.filter((t=>t.fh_id!==e.fh_id))})).catch((e=>console.error(e)))},openDiseaseModal(){const e={heart_disease:!1,high_blood_pressure:!1,stroke:!1,cancer:!1,diabetes:!1,kidney_disease:!1,allergy:!1,asthma:!1,eczema:!1,tuberculosis:!1,epilepsy:!1,mental_disorder:!1,alcohol_dependence:!1,drug_abuse:!1,birth_abnormality:!1,none_above:!1,details:""};this.modalDisease={...e,...JSON.parse(JSON.stringify(this.familyHistoryDisease))},this.isDiseaseModalOpen=!0},closeDiseaseModal(){this.isDiseaseModalOpen=!1},submitDiseaseEntry(){const e=localStorage.getItem("user_info");if(!e)return;const t=this.$route.params.staffEmail||JSON.parse(localStorage.getItem("user_info")).email||"",s=t,a={staff_email:s,heart_disease:this.modalDisease.heart_disease||!1,high_blood_pressure:this.modalDisease.high_blood_pressure||!1,stroke:this.modalDisease.stroke||!1,cancer:this.modalDisease.cancer||!1,diabetes:this.modalDisease.diabetes||!1,kidney_disease:this.modalDisease.kidney_disease||!1,allergy:this.modalDisease.allergy||!1,asthma:this.modalDisease.asthma||!1,eczema:this.modalDisease.eczema||!1,tuberculosis:this.modalDisease.tuberculosis||!1,epilepsy:this.modalDisease.epilepsy||!1,mental_disorder:this.modalDisease.mental_disorder||!1,alcohol_dependence:this.modalDisease.alcohol_dependence||!1,drug_abuse:this.modalDisease.drug_abuse||!1,birth_abnormality:this.modalDisease.birth_abnormality||!1,none_above:this.modalDisease.none_above||!0,details:this.modalDisease.details||""},l=s.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/family-history-disease/edit/${l}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((()=>{this.familyHistoryDisease={...a},this.closeDiseaseModal(),this.fetchFamilyHistory(),this.fetchFamilyDisease()})).catch((e=>console.error(e)))},formatDiseaseLabel(e){return e.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))}},watch:{"modalFamily.year_of_born"(e){const t=(new Date).getFullYear();this.modalFamily.age_now=e?t-e:null},"modalFamily.relationship"(e){const t=["father","brother"],s=["mother","sister"];t.includes(e)?this.modalFamily.sex="M":s.includes(e)?this.modalFamily.sex="F":this.modalFamily.sex=""},"modalDisease.none_above"(e){e&&this.medicalFields?this.medicalFields?.forEach((e=>{"none_of_the_above"!==e.key&&"details"!==e.key&&(this.modalDisease[e.key]=!1)})):this.medicalFields&&this.medicalFields?.forEach((e=>{"none_of_the_above"!==e.key&&"details"!==e.key&&this.modalDisease[e.key]&&(this.modalDisease.none_of_the_above=!1)}))}}};const xr=(0,j.A)(Dr,[["render",Ar],["__scopeId","data-v-79ccf3bc"]]);var Ir=xr;const Ur={class:"stats"},Fr={class:"switcher"};function Nr(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Ur,[t[3]||(t[3]=(0,l.Lk)("h2",null,"Statistics",-1)),(0,l.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.push("/dashboard")),style:{"margin-bottom":"18px"}},"Back to Dashboard"),(0,l.Lk)("div",Fr,[(0,l.Lk)("button",{class:(0,o.C4)({active:"dashboard"===e.mode}),onClick:t[1]||(t[1]=t=>e.mode="dashboard")},"Overview",2),(0,l.Lk)("button",{class:(0,o.C4)({active:"charts"===e.mode}),onClick:t[2]||(t[2]=t=>e.mode="charts")},"Charts",2)]),((0,l.uX)(),(0,l.Wv)(l.PR,null,[((0,l.uX)(),(0,l.Wv)((0,l.$y)(n.currentComp)))],1024))])}const $r={class:"analytics-charts"},Mr={key:0,class:"session-bar"},Pr=["title"],Br={class:"grid"},Xr={class:"card"},Rr={ref:"bmiCanvas",height:"120"},Hr={class:"card"},Or={ref:"bpCanvas",height:"120"},Tr={class:"card"},Vr={ref:"pulseCanvas",height:"120"},jr={class:"card wide"},Jr={ref:"lipidsCanvas",height:"160"};function Qr(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",$r,[t[5]||(t[5]=(0,l.Lk)("h2",null,"Health Statistics",-1)),i.sessions.length?((0,l.uX)(),(0,l.CE)("div",Mr,[t[0]||(t[0]=(0,l.Lk)("span",{class:"hint"},"Sessions",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.sessions,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e.session_id,class:"session-pill",title:n.fmtDate(e.session_date)},(0,o.v_)(new Date(e.session_date).getFullYear()),9,Pr)))),128))])):(0,l.Q3)("",!0),(0,l.Lk)("div",Br,[(0,l.Lk)("div",Xr,[t[1]||(t[1]=(0,l.Lk)("div",{class:"card-title"},"BMI Trend",-1)),(0,l.Lk)("canvas",Rr,null,512)]),(0,l.Lk)("div",Hr,[t[2]||(t[2]=(0,l.Lk)("div",{class:"card-title"},"Blood Pressure Trend",-1)),(0,l.Lk)("canvas",Or,null,512)]),(0,l.Lk)("div",Tr,[t[3]||(t[3]=(0,l.Lk)("div",{class:"card-title"},"Pulse Trend",-1)),(0,l.Lk)("canvas",Vr,null,512)]),(0,l.Lk)("div",jr,[t[4]||(t[4]=(0,l.Lk)("div",{class:"card-title"},"Key Lipids by Session (Normal / Abnormal / Not done)",-1)),(0,l.Lk)("canvas",Jr,null,512)])])])}Ls.t1.register(Ls.ZT,Ls.A6,Ls.No,Ls.E8,Ls.FN,Ls.kc,Ls.PP,Ls.m_,Ls.s$,Ls.dN,Ls.hE);var Yr={name:"AnalyticsCharts",data(){return{baseUrl:O.A.API_BASE_URL,sessions:[],vitals:[],labs:[],charts:{bmi:null,bp:null,pulse:null,lipids:null}}},async mounted(){await this.loadData(),this.renderAllCharts(),window.addEventListener("resize",this.resizeCharts)},beforeUnmount(){this.destroyCharts(),window.removeEventListener("resize",this.resizeCharts)},methods:{fmtDate(e){return new Date(e).toLocaleDateString()},async loadData(){const e=JSON.parse(localStorage.getItem("user_info"));if(!e)return;const t=e.email.replace(/\./g,"XYZ"),s={Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},[a,l,o]=await Promise.all([fetch(`${this.baseUrl}/checkup-sessions/stats/${t}`,{headers:s}).then((e=>{if(!(0,T.$)(e))return e.json()})),fetch(`${this.baseUrl}/stats/vitals/${t}`,{headers:s}).then((e=>e.json())),fetch(`${this.baseUrl}/stats/labs/${t}?fields=ldl_result,tchol_result,hdl_result`,{headers:s}).then((e=>e.json()))]);this.sessions=(a||[]).sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date))),this.vitals=(l||[]).sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date))),this.labs=(o||[]).sort(((e,t)=>new Date(e.session_date)-new Date(t.session_date)))},destroyCharts(){Object.keys(this.charts).forEach((e=>{this.charts[e]&&(this.charts[e].destroy(),this.charts[e]=null)}))},resizeCharts(){Object.values(this.charts).forEach((e=>e&&e.resize()))},renderAllCharts(){this.destroyCharts(),this.renderBMI(),this.renderBP(),this.renderPulse(),this.renderLipids()},renderBMI(){const e=this.$refs.bmiCanvas?.getContext("2d");if(!e)return;const t=this.vitals.map((e=>new Date(e.session_date).getFullYear())),s=this.vitals.map((e=>e.bmi??null));this.charts.bmi=new Ls.t1(e,{type:"line",data:{labels:t,datasets:[{label:"BMI",data:s,tension:.3,fill:!1,pointRadius:3}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"BMI"}},x:{title:{display:!0,text:"Session (Year)"}}}}})},renderBP(){const e=this.$refs.bpCanvas?.getContext("2d");if(!e)return;const t=this.vitals.map((e=>new Date(e.session_date).getFullYear())),s=this.vitals.map((e=>e.bp_sys??null)),a=this.vitals.map((e=>e.bp_dia??null));this.charts.bp=new Ls.t1(e,{type:"line",data:{labels:t,datasets:[{label:"Systolic",data:s,tension:.3,pointRadius:3},{label:"Diastolic",data:a,tension:.3,pointRadius:3}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"mmHg"}},x:{title:{display:!0,text:"Session (Year)"}}}}})},renderPulse(){const e=this.$refs.pulseCanvas?.getContext("2d");if(!e)return;const t=this.vitals.map((e=>new Date(e.session_date).getFullYear())),s=this.vitals.map((e=>e.pulse_bpm??null));this.charts.pulse=new Ls.t1(e,{type:"line",data:{labels:t,datasets:[{label:"Pulse (bpm)",data:s,tension:.3,pointRadius:3}]},options:{responsive:!0,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"bpm"}},x:{title:{display:!0,text:"Session (Year)"}}}}})},renderLipids(){const e=this.$refs.lipidsCanvas?.getContext("2d");if(!e)return;const t=this.labs.map((e=>new Date(e.session_date).getFullYear())),s=this.labs.map((e=>{const t=[e.ldl_result??"Not done",e.tchol_result??"Not done",e.hdl_result??"Not done"];return{normal:t.filter((e=>"Normal"===e)).length,abnormal:t.filter((e=>"Abnormal"===e)).length,notdone:t.filter((e=>"Not done"===e)).length}})),a=s.map((e=>e.normal)),l=s.map((e=>e.abnormal)),o=s.map((e=>e.notdone));this.charts.lipids=new Ls.t1(e,{type:"bar",data:{labels:t,datasets:[{label:"Normal",data:a,stack:"lipids",backgroundColor:"#008000"},{label:"Abnormal",data:l,stack:"lipids",backgroundColor:"#ff0000"},{label:"Not done",data:o,stack:"lipids",backgroundColor:"#cccccc"}]},options:{responsive:!0,plugins:{legend:{display:!0}},scales:{x:{stacked:!0,title:{display:!0,text:"Session (Year)"}},y:{stacked:!0,beginAtZero:!0,ticks:{stepSize:1},title:{display:!0,text:"Count of Tests"}}}}})}}};const Wr=(0,j.A)(Yr,[["render",Qr],["__scopeId","data-v-c96c7d2e"]]);var zr=Wr,qr={name:"AnalyticsPage",data:()=>({mode:"dashboard"}),computed:{currentComp(){return"dashboard"===this.mode?ve:zr}}};const Kr=(0,j.A)(qr,[["render",Nr]]);var Gr=Kr;const Zr={class:"page"},ed={class:"filters"},td=["value"],sd={class:"table-responsive"},ad={key:0},ld={key:1},od={style:{display:"flex","align-items":"center"}},id={class:"info-container",style:{margin:"0"}},nd={class:"report-wrapper"},rd=["onClick"],dd={key:0,class:"muted"},ud={key:1,class:"report-list"},cd={class:"meta"},md={class:"sub"},hd={key:1,class:"pill2 muted"},pd=["disabled","onClick"],kd=["href","onClick"],fd=["onClick"],bd={key:0},yd={class:"info-box"};function Ld(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",Zr,[t[21]||(t[21]=(0,l.Lk)("h2",null,"My Checkup Sessions",-1)),(0,l.Lk)("div",ed,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.year=t)},[t[9]||(t[9]=(0,l.Lk)("option",{value:""},"All years",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.years,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:String(e)},(0,o.v_)(e),9,td)))),128))],512),[[u.u1,e.year]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.type=t)},t[10]||(t[10]=[(0,l.Fv)('<option value="" data-v-7890fe6c>All type</option><option value="annual" data-v-7890fe6c>Annual</option><option value="followup" data-v-7890fe6c>Follow-up</option><option value="pre-employment" data-v-7890fe6c>Pre-employment</option><option value="return-to-work" data-v-7890fe6c>Return to Work</option><option value="ad-hoc" data-v-7890fe6c>Ad-hoc</option>',6)]),512),[[u.u1,e.type]]),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.status=t)},t[11]||(t[11]=[(0,l.Lk)("option",{value:""},"All status",-1),(0,l.Lk)("option",{value:"draft"},"Draft",-1),(0,l.Lk)("option",{value:"submitted"},"Submitted",-1),(0,l.Lk)("option",{value:"locked"},"Locked",-1)]),512),[[u.u1,e.status]])]),(0,l.Lk)("div",sd,[(0,l.Lk)("table",null,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{onClick:t[3]||(t[3]=(...e)=>n.toggleDateSort&&n.toggleDateSort(...e)),style:{"min-width":"110px",cursor:"pointer"}},[t[12]||(t[12]=(0,l.eW)(" Date ")),"asc"===e.sortDir?((0,l.uX)(),(0,l.CE)("span",ad,"â–²")):((0,l.uX)(),(0,l.CE)("span",ld,"â–¼"))]),t[14]||(t[14]=(0,l.Lk)("th",null,"Type",-1)),(0,l.Lk)("th",od,[t[13]||(t[13]=(0,l.eW)(" Status ")),(0,l.Lk)("div",id,[(0,l.Lk)("span",{class:"info-icon",onClick:t[4]||(t[4]=(...e)=>n.toggleInfo&&n.toggleInfo(...e))},"â„¹ï¸")])]),t[15]||(t[15]=(0,l.Lk)("th",null,"Report",-1)),t[16]||(t[16]=(0,l.Lk)("th",null,"Actions",-1))])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.sortedSessions,(s=>((0,l.uX)(),(0,l.CE)("tr",{key:s.session_id},[(0,l.Lk)("td",null,(0,o.v_)(n.formatDate(s.session_date)),1),(0,l.Lk)("td",null,(0,o.v_)(s.session_type),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,o.C4)(["pill",s.status])},(0,o.v_)(s.status),3)]),(0,l.Lk)("td",{class:"reports-cell",onClick:t[6]||(t[6]=(0,u.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",nd,[(e.reportsBySession[s.session_id]||[]).length?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.Lk)("button",{class:"pill2 ok pill2-btn",onClick:(0,u.D$)((e=>n.toggleReportMenu(s.session_id)),["stop"]),style:{"margin-top":"0px"}}," Uploaded â–¾ ",8,rd),e.openReportMenuId===s.session_id?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"menu-list",onClick:t[5]||(t[5]=(0,u.D$)((()=>{}),["stop"]))},[e.reportsLoadingId===s.session_id?((0,l.uX)(),(0,l.CE)("div",dd,"Loadingâ€¦")):((0,l.uX)(),(0,l.CE)("ul",ud,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.reportsBySession[s.session_id],(e=>((0,l.uX)(),(0,l.CE)("li",{key:e.report_id},[(0,l.Lk)("div",cd,[(0,l.Lk)("strong",null,(0,o.v_)(e.title||n.safeName(e.file_name)),1),(0,l.Lk)("div",md,(0,o.v_)(n.kb(e.file_size))+" â€¢ "+(0,o.v_)(n.prettyTs(e.uploaded_at)),1)])])))),128))]))])):(0,l.Q3)("",!0)],64)):((0,l.uX)(),(0,l.CE)("span",hd,"None"))])]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn",disabled:!s.has_forms_all,onClick:t=>e.$router.push(`/staff/session/${s.session_id}`)},(0,o.v_)(s.has_forms_all?"Open":"No Forms"),9,pd),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.reportsBySession[s.session_id],(t=>((0,l.uX)(),(0,l.CE)("a",{key:t.report_id,href:`${this.baseUrl}/reports/${t.report_id}/download`,target:"_blank",rel:"noopener",class:(0,o.C4)(["btn linklike",{disabled:0===(e.reportsBySession[s.session_id]||[]).length}]),onClick:t=>0===(e.reportsBySession[s.session_id]||[]).length&&t.preventDefault()}," Download Report ",10,kd)))),128)),(0,l.Lk)("button",{class:"btn",onClick:t=>e.$router.push({name:"export-medical",query:{session_id:s.session_id,staff_email:s.staff_email}})}," Export Excel ",8,fd)])])))),128)),n.filtered.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("tr",bd,t[17]||(t[17]=[(0,l.Lk)("td",{colspan:"5",class:"empty"},"No sessions.",-1)])))])]),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[e.showInfo?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"info-overlay",onClick:t[8]||(t[8]=(0,u.D$)(((...e)=>n.closeInfo&&n.closeInfo(...e)),["self"]))},[(0,l.Lk)("div",yd,[t[18]||(t[18]=(0,l.Lk)("h4",null,"Checkup Status Guide",-1)),t[19]||(t[19]=(0,l.Lk)("p",null,"The form's editable status is determined by its current state:",-1)),t[20]||(t[20]=(0,l.Lk)("ul",{style:{"text-align":"left","list-style":"none",padding:"0",margin:"0"}},[(0,l.Lk)("li",null,[(0,l.Lk)("b",null,"Draft: Staff"),(0,l.eW)(" and "),(0,l.Lk)("b",null,"Doctor"),(0,l.eW)(" can edit the form. ")]),(0,l.Lk)("li",null,[(0,l.Lk)("b",null,"Submitted:"),(0,l.eW)(" Only the "),(0,l.Lk)("b",null,"Doctor"),(0,l.eW)(" can edit the form. ")]),(0,l.Lk)("li",null,[(0,l.Lk)("b",null,"Locked:"),(0,l.eW)(" The form is "),(0,l.Lk)("b",null,"view-only"),(0,l.eW)(" for all. ")])],-1)),(0,l.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>n.closeInfo&&n.closeInfo(...e))},"Got it")])])):(0,l.Q3)("",!0)]))])])}var _d={data:()=>({baseUrl:O.A.API_BASE_URL,showInfo:!1,sessions:[],year:"",status:"",type:"",sortDir:"desc",openReportMenuId:null,reportsLoadingId:null,reportsBySession:{},reportHas:{}}),computed:{years(){const e=new Set(this.sessions.map((e=>{const t=new Date(e.session_date);return isNaN(t)?null:t.getFullYear()})).filter(Boolean));return[...e].sort(((e,t)=>t-e))},filtered(){return this.sessions.filter((e=>{const t=!this.year||new Date(e.session_date).getFullYear().toString()===this.year,s=!this.status||e.status===this.status,a=!this.type||e.session_type===this.type;return t&&s&&a}))},sortedSessions(){const e="asc"===this.sortDir?1:-1;return[...this.filtered].sort(((t,s)=>{const a=this.toTime(t.session_date),l=this.toTime(s.session_date);return a===l?0:a>l?e:-e}))}},mounted(){this.fetchMine(),this._onDocClick=e=>{e.target.closest(".report-menu")||(this.openReportMenuId=null)},document.addEventListener("click",this._onDocClick)},beforeUnmount(){document.removeEventListener("click",this._onDocClick)},methods:{toggleInfo(){this.showInfo=!this.showInfo},closeInfo(){this.showInfo=!1},toTime(e){const t=new Date(e).getTime();return Number.isFinite(t)?t:-1/0},async fetchMine(){const e=JSON.parse(localStorage.getItem("user_info")||"{}");if(!e?.email)return;const t=e.email.replace(/\./g,"XYZ"),s=await fetch(`${this.baseUrl}/checkup-sessions/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}),a=await s.json();if((0,T.$)(s))return;this.sessions=Array.isArray(a)?a:a.sessions||[],this.sessions.forEach((e=>{e.has_forms_all=e.has_investigations&&e.has_ilab&&e.has_lifestyle&&e.has_mh&&e.has_pe1&&e.has_pe2}));const l=this.sessions.map((e=>this.ensureReportsLoaded(e.session_id)));await Promise.all(l)},formatDate:$s,prettyTs(e){const t=new Date(e);return isNaN(t)?"":t.toLocaleString()},kb(e){const t=Number(e||0);return`${Math.round(t/1024)} KB`},safeName(e=""){return e.length>16?`${e.slice(0,13)}â€¦`:e},toggleDateSort(){this.sortDir="asc"===this.sortDir?"desc":"asc"},reportExists(e){const t=e.session_id;return void 0!==this.reportHas[t]?this.reportHas[t]:!!e.has_report},setReportExists(e,t){this.reportHas={...this.reportHas,[e]:!!t}},toggleReportMenu(e){this.openReportMenuId=this.openReportMenuId===e?null:e,this.openReportMenuId&&this.ensureReportsLoaded(e)},ensureReportsLoaded(e){this.reportsBySession[e]||(this.reportsLoadingId=e,fetch(`${this.baseUrl}/sessions/${e}/reports`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>e.json())).then((t=>{const s=Array.isArray(t)?t:[];this.reportsBySession={...this.reportsBySession,[e]:s},this.setReportExists(e,s.length>0)})).catch((()=>{this.reportsBySession={...this.reportsBySession,[e]:[]},this.setReportExists(e,!1)})).finally((()=>{this.reportsLoadingId=null})))}}};const gd=(0,j.A)(_d,[["render",Ld],["__scopeId","data-v-7890fe6c"]]);var vd=gd;const Sd={class:"medical-grid"},Cd={class:"checkbox-label"},wd=["onUpdate:modelValue"],Ed={class:"medical-box"},Ad={style:{display:"flex",gap:"8px"}},Dd={class:"std-table"},xd={class:"std-table"},Id={class:"std-table"},Ud={class:"inv-box",style:{"margin-top":"1rem","margin-bottom":"1rem"}},Fd=["disabled"];function Nd(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[t[16]||(t[16]=(0,l.Lk)("h2",null,"Medical History",-1)),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[i.isModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=(...e)=>n.closeModal&&n.closeModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[3]||(t[3]=(0,u.D$)((()=>{}),["stop"]))},[t[9]||(t[9]=(0,l.Lk)("h3",null,"Edit Medical History",-1)),(0,l.Lk)("form",{onSubmit:t[2]||(t[2]=(0,u.D$)(((...e)=>n.submitMedicalHistory&&n.submitMedicalHistory(...e)),["prevent"]))},[(0,l.Lk)("div",Sd,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.medicalFields,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.key,class:"medical-item"},[(0,l.Lk)("label",Cd,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>i.modalMedicalHistory[e.key]=t},null,8,wd),[[u.lH,i.modalMedicalHistory[e.key]]]),(0,l.eW)(" "+(0,o.v_)(e.label),1)])])))),128))]),t[6]||(t[6]=(0,l.Lk)("label",null,"Comments:",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.modalMedicalHistory.comment_by_examine_doctor=e),style:{width:"100%",height:"150px"}},null,512),[[u.Jo,i.modalMedicalHistory.comment_by_examine_doctor]]),t[7]||(t[7]=(0,l.Lk)("br",null,null,-1)),t[8]||(t[8]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>n.closeModal&&n.closeModal(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0)])),(0,l.Lk)("div",Ed,[(0,l.Lk)("div",Ad,[(0,l.Lk)("table",Dd,[t[10]||(t[10]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Medical Condition"),(0,l.Lk)("th",null,"Yes/No")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.medicalFields.slice(0,i.medicalFields.length/3),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,(0,o.v_)(e.label),1),(0,l.Lk)("td",{style:(0,o.Tr)({color:i.medicalHistory[e.key]?"red":"green"})},(0,o.v_)(i.medicalHistory[e.key]?"Yes":"No"),5)])))),128))])]),(0,l.Lk)("table",xd,[t[11]||(t[11]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Medical Condition"),(0,l.Lk)("th",null,"Yes/No")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.medicalFields.slice(i.medicalFields.length/3,i.medicalFields.length/3*2),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,(0,o.v_)(e.label),1),(0,l.Lk)("td",{style:(0,o.Tr)({color:i.medicalHistory[e.key]?"red":"green"})},(0,o.v_)(i.medicalHistory[e.key]?"Yes":"No"),5)])))),128))])]),(0,l.Lk)("table",Id,[t[12]||(t[12]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Medical Condition"),(0,l.Lk)("th",null,"Yes/No")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.medicalFields.slice(i.medicalFields.length/3*2),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",{style:(0,o.Tr)({fontWeight:"None of the Above"===e.label?"bold":""})},(0,o.v_)((e.label,e.label)),5),(0,l.Lk)("td",{style:(0,o.Tr)({color:"none_of_the_above"===e.key?i.medicalHistory[e.key]?"green":"red":i.medicalHistory[e.key]?"red":"green"})},(0,o.v_)(i.medicalHistory[e.key]?"Yes":"No"),5)])))),128))])])]),(0,l.Lk)("div",Ud,[t[13]||(t[13]=(0,l.Lk)("strong",null,"Doctor's Comment:",-1)),t[14]||(t[14]=(0,l.eW)()),t[15]||(t[15]=(0,l.Lk)("small",null,[(0,l.Lk)("i",null,"(to be filled by OHD)")],-1)),(0,l.Lk)("p",null,(0,o.v_)(i.medicalHistory.comment_by_examine_doctor),1)])]),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[5]||(t[5]=(...e)=>n.openModal&&n.openModal(...e))},"Edit Medical History",8,Fd)])}const $d=Object.freeze({STAFF:"staff",DOCTOR:"doctor",ADMIN:"admin"}),Md=Object.freeze({DRAFT:"draft",SUBMITTED:"submitted",LOCKED:"locked"});function Pd(e,t,s){return e===$d.ADMIN?t!==Md.LOCKED||"edit"!==s&&"upload_report"!==s:e===$d.STAFF?"view"===s||t===Md.DRAFT&&"edit"===s:e===$d.DOCTOR&&("view"===s||t!==Md.LOCKED&&("edit"===s||"upload_report"===s))}var Bd={inject:{currentSessionHeader:{from:"currentSessionHeader",default:()=>()=>null},refreshSessionHeader:{from:"refreshSessionHeader",default:()=>async()=>{}}},data(){return{baseUrl:O.A.API_BASE_URL,medicalHistory:{},modalMedicalHistory:{},isModalOpen:!1,medicalFields:[{key:"abnormal_heartbeat",label:"Abnormal Heartbeat"},{key:"bladder_trouble",label:"Bladder Trouble"},{key:"dermatitis_eczema",label:"Dermatitis / Eczema"},{key:"depression",label:"Depression"},{key:"heart_murmur",label:"Heart Murmur"},{key:"hernia",label:"Hernia"},{key:"jaundice",label:"Jaundice"},{key:"kidney_disease",label:"Kidney Disease"},{key:"peptic_ulcer",label:"Peptic Ulcer"},{key:"persistent_night_sweats",label:"Persistent Night Sweats"},{key:"rectal_bleeding",label:"Rectal Bleeding"},{key:"unintentional_weight_loss",label:"Unintentional Weight Loss"},{key:"asthma_bronchitis",label:"Asthma / Bronchitis"},{key:"bowel_disorder",label:"Bowel Disorder"},{key:"diabetes",label:"Diabetes"},{key:"frequent_indigestion",label:"Frequent Indigestion"},{key:"high_blood_pressure",label:"High Blood Pressure"},{key:"hospitalisation_surgery",label:"Hospitalisation / Surgery"},{key:"migraine_headache",label:"Migraine / Headache"},{key:"psoriasis_skin_disease",label:"Psoriasis / Skin Disease"},{key:"persistent_diarrhoea",label:"Persistent Diarrhoea"},{key:"renal_colic_stone",label:"Renal Colic / Stone"},{key:"swollen_lymph_glands",label:"Swollen Lymph Glands"},{key:"anxiety",label:"Anxiety"},{key:"blood_in_urine",label:"Blood in Urine"},{key:"dizziness_giddiness",label:"Dizziness / Giddiness"},{key:"faints_blackouts",label:"Faints / Blackouts"},{key:"hay_fever",label:"Hay Fever"},{key:"joint_disorder",label:"Joint Disorder"},{key:"liver_gall_bladder",label:"Liver / Gall / Bladder"},{key:"piles_haemorrhoids",label:"Piles / Haemorrhoids"},{key:"rheumatic_fever",label:"Rheumatic Fever"},{key:"std",label:"STD"},{key:"tuberculosis",label:"Tuberculosis"},{key:"none_of_the_above",label:"None of the Above"}]}},mounted(){this.fetchMedicalHistory()},computed:{sessionHeader(){return this.currentSessionHeader?this.currentSessionHeader():null},sessionStatus(){return this.sessionHeader?.status||"draft"}},methods:{accessCheck(e){let t=null;try{t=JSON.parse(localStorage.getItem("user_info"))?.role||"staff"}catch(s){}return Pd(t,this.sessionStatus,e)},blankMedicalObj(){const e={};return this.medicalFields.forEach((t=>{e[t.key]=!1})),e.comment_by_examine_doctor="",e},fetchMedicalHistory(){const e=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/medical-history/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{const t=Array.isArray(e)?e[0]||{}:e,s=this.blankMedicalObj();this.medicalFields.forEach((e=>{const a=t[e.key];"Y"===a?s[e.key]=!0:"N"===a?s[e.key]=!1:"boolean"===typeof a&&(s[e.key]=a)})),s.comment_by_examine_doctor=t.comment_by_examine_doctor||"",this.medicalHistory=s})).catch((e=>console.error(e)))},openModal(){this.modalMedicalHistory={...this.medicalHistory},this.isModalOpen=!0,document.body.style.overflow="hidden"},closeModal(){this.isModalOpen=!1,document.body.style.overflow=""},submitMedicalHistory(){const e=localStorage.getItem("user_info"),t=this.$route.params.sessionId||"",s={};this.medicalFields.forEach((e=>{s[e.key]=this.modalMedicalHistory[e.key]?"Y":"N"})),s.staff_email=JSON.parse(e).email,s.comment_by_examine_doctor=this.modalMedicalHistory.comment_by_examine_doctor||"",fetch(`${this.baseUrl}/medical-history/edit/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>e.json())).then((()=>{this.isModalOpen=!1,document.body.style.overflow="",this.fetchMedicalHistory()})).catch((e=>console.error(e)))}},watch:{"modalMedicalHistory.none_of_the_above"(e){e&&this.medicalFields.forEach((e=>{"none_of_the_above"!==e.key&&"comment_by_examine_doctor"!==e.key&&(this.modalMedicalHistory[e.key]=!1)}))}}};const Xd=(0,j.A)(Bd,[["render",Nd],["__scopeId","data-v-0c50b4d2"]]);var Rd=Xd;const Hd=["disabled","required"],Od=["disabled","required"],Td=["disabled","required"],Vd=["disabled","required"],jd=["disabled","required"],Jd={class:"lifestyle-box"},Qd={key:0},Yd={key:1},Wd={key:2},zd={key:3},qd={class:"inv-box",style:{"margin-bottom":"0%"}},Kd={key:0},Gd={key:1},Zd=["disabled"];function eu(e,t,s,a,i,n){const r=(0,l.g2)("VueDatePicker");return(0,l.uX)(),(0,l.CE)("div",null,[t[60]||(t[60]=(0,l.Lk)("h2",null,"Lifestyle",-1)),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[i.isModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:t[14]||(t[14]=(...e)=>n.closeModal&&n.closeModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[13]||(t[13]=(0,u.D$)((()=>{}),["stop"]))},[t[44]||(t[44]=(0,l.Lk)("h3",null,"Edit Lifestyle",-1)),(0,l.Lk)("form",{onSubmit:t[12]||(t[12]=(0,u.D$)(((...e)=>n.submitLifestyle&&n.submitLifestyle(...e)),["prevent"]))},[t[20]||(t[20]=(0,l.Lk)("label",null,"Smoking Habit:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.modalLifestyle.smoking_habit=e)},t[16]||(t[16]=[(0,l.Lk)("option",{value:"never smoked"},"Never Smoked",-1),(0,l.Lk)("option",{value:"ex-smoker"},"Ex-Smoker",-1),(0,l.Lk)("option",{value:"current smoker"},"Current Smoker",-1)]),512),[[u.u1,i.modalLifestyle.smoking_habit]]),t[21]||(t[21]=(0,l.Lk)("br",null,null,-1)),t[22]||(t[22]=(0,l.Lk)("label",null,"Years Smoked:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>i.modalLifestyle.years_smoked=e),disabled:"never smoked"===i.modalLifestyle.smoking_habit,required:"never smoked"!==i.modalLifestyle.smoking_habit},null,8,Hd),[[u.Jo,i.modalLifestyle.years_smoked,void 0,{number:!0}]]),t[23]||(t[23]=(0,l.Lk)("br",null,null,-1)),t[24]||(t[24]=(0,l.Lk)("label",null,"Amount Smoked per Day:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.01","onUpdate:modelValue":t[2]||(t[2]=e=>i.modalLifestyle.amount_smoke_day=e),disabled:"never smoked"===i.modalLifestyle.smoking_habit,required:"never smoked"!==i.modalLifestyle.smoking_habit},null,8,Od),[[u.Jo,i.modalLifestyle.amount_smoke_day,void 0,{number:!0}]]),t[25]||(t[25]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("div",null,[t[17]||(t[17]=(0,l.Lk)("label",null,"Date Stopped:",-1)),(0,l.bF)(r,{modelValue:i.modalLifestyle.date_stopped,"onUpdate:modelValue":t[3]||(t[3]=e=>i.modalLifestyle.date_stopped=e),"max-date":new Date,"year-range":[1900,(new Date).getFullYear()],"auto-apply":"","enable-time-picker":!1,disabled:"never smoked"===i.modalLifestyle.smoking_habit||"current smoker"===i.modalLifestyle.smoking_habit,required:"ex-smoker"===i.modalLifestyle.smoking_habit},null,8,["modelValue","max-date","year-range","disabled","required"])]),t[26]||(t[26]=(0,l.Lk)("br",null,null,-1)),t[27]||(t[27]=(0,l.Lk)("label",null,"Do you drink alcohol?",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.modalLifestyle.alcohol_drink=e)},t[18]||(t[18]=[(0,l.Lk)("option",{value:"Y"},"Yes",-1),(0,l.Lk)("option",{value:"N"},"No",-1)]),512),[[u.u1,i.modalLifestyle.alcohol_drink]]),t[28]||(t[28]=(0,l.Lk)("br",null,null,-1)),t[29]||(t[29]=(0,l.Lk)("label",null,[(0,l.eW)("How many drinks per typical week? "),(0,l.Lk)("small",null,[(0,l.Lk)("i",null," (Note: 1 drink equivalent to 1 glass wine / 7 oz or half pint beer / 1 oz or single measure spirits) ")])],-1)),t[30]||(t[30]=(0,l.Lk)("br",null,null,-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=e=>i.modalLifestyle.drink_per_week=e),disabled:"Y"!==i.modalLifestyle.alcohol_drink,required:"Y"===i.modalLifestyle.alcohol_drink},null,8,Td),[[u.Jo,i.modalLifestyle.drink_per_week,void 0,{number:!0}]]),t[31]||(t[31]=(0,l.Lk)("br",null,null,-1)),t[32]||(t[32]=(0,l.Lk)("label",null,"Are you taking or have you taken drugs other than bought from a chemist or prescribed by a doctor to treat an illness? ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.modalLifestyle.taking_prescribed_drugs=e)},t[19]||(t[19]=[(0,l.Lk)("option",{value:"Y"},"Yes",-1),(0,l.Lk)("option",{value:"N"},"No",-1)]),512),[[u.u1,i.modalLifestyle.taking_prescribed_drugs]]),t[33]||(t[33]=(0,l.Lk)("br",null,null,-1)),t[34]||(t[34]=(0,l.Lk)("label",null,[(0,l.eW)("Details: "),(0,l.Lk)("small",null,[(0,l.Lk)("i",null,"(if yes, give details below)")])],-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.modalLifestyle.drug_detail=e)},null,512),[[u.Jo,i.modalLifestyle.drug_detail]]),t[35]||(t[35]=(0,l.Lk)("br",null,null,-1)),t[36]||(t[36]=(0,l.Lk)("label",null,[(0,l.eW)(" Declaration Consent: "),(0,l.Lk)("small",null,[(0,l.Lk)("i",null,"(to be signed in the presence of the examining doctor)")])],-1)),t[37]||(t[37]=(0,l.Lk)("p",null,"I hereby certify the above information is correct. I also understand that voluntary non-disclosure of any of Information required above is an offence and disciplinary action may be taken against me. I further agree to give consent to the examining Approved Medical Examiner to disclose the results of this medical questionnaire and examination to authorised ATB Occupational Health Doctor/Advisor, for the purpose of verification of my fitness to work status. ",-1)),(0,l.bo)((0,l.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>i.modalLifestyle.declaration_consent=e)},null,512),[[u.lH,i.modalLifestyle.declaration_consent]]),t[38]||(t[38]=(0,l.Lk)("br",null,null,-1)),t[39]||(t[39]=(0,l.Lk)("label",null,"Consent Signer Name:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>i.modalLifestyle.consent_signer_name=e),disabled:!i.modalLifestyle.declaration_consent,required:i.modalLifestyle.declaration_consent},null,8,Vd),[[u.Jo,i.modalLifestyle.consent_signer_name]]),t[40]||(t[40]=(0,l.Lk)("br",null,null,-1)),t[41]||(t[41]=(0,l.Lk)("label",null,"Consent Signer Date:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=e=>i.modalLifestyle.consent_signer_date=e),disabled:!i.modalLifestyle.declaration_consent,required:i.modalLifestyle.declaration_consent},null,8,jd),[[u.Jo,i.modalLifestyle.consent_signer_date]]),t[42]||(t[42]=(0,l.Lk)("br",null,null,-1)),t[43]||(t[43]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[11]||(t[11]=(...e)=>n.closeModal&&n.closeModal(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0)])),(0,l.Lk)("div",Jd,[(0,l.Lk)("div",null,[t[45]||(t[45]=(0,l.Lk)("strong",null,"Smoking Habit:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.smoking_habit?i.lifestyle.smoking_habit.charAt(0).toUpperCase()+i.lifestyle.smoking_habit.slice(1):"-"),1)]),"never smoked"!==i.lifestyle.smoking_habit?((0,l.uX)(),(0,l.CE)("div",Qd,[t[46]||(t[46]=(0,l.Lk)("strong",null,"Years Smoked:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.years_smoked||"-"),1)])):(0,l.Q3)("",!0),"current smoker"===i.lifestyle.smoking_habit?((0,l.uX)(),(0,l.CE)("div",Yd,[t[47]||(t[47]=(0,l.Lk)("strong",null,"Amount Smoked/Day:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.amount_smoke_day||"-"),1)])):(0,l.Q3)("",!0),"ex-smoker"===i.lifestyle.smoking_habit?((0,l.uX)(),(0,l.CE)("div",Wd,[t[48]||(t[48]=(0,l.Lk)("strong",null,"Date Stopped:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.date_stopped||"-"),1)])):(0,l.Q3)("",!0),t[55]||(t[55]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("div",null,[t[49]||(t[49]=(0,l.Lk)("strong",null,"Alcohol Drink:",-1)),(0,l.eW)(" "+(0,o.v_)("Y"===i.lifestyle.alcohol_drink?"Yes":"No"),1)]),"Y"===i.lifestyle.alcohol_drink?((0,l.uX)(),(0,l.CE)("div",zd,[t[50]||(t[50]=(0,l.Lk)("strong",null,"Drinks per Week:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.drink_per_week||"-"),1)])):(0,l.Q3)("",!0),t[56]||(t[56]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("div",null,[t[51]||(t[51]=(0,l.Lk)("strong",null,"Prescribed Drugs:",-1)),(0,l.eW)(" "+(0,o.v_)("Y"===i.lifestyle.taking_prescribed_drugs?"Yes":"No"),1)]),(0,l.Lk)("div",qd,[t[52]||(t[52]=(0,l.Lk)("strong",null,"Details: ",-1)),t[53]||(t[53]=(0,l.eW)()),t[54]||(t[54]=(0,l.Lk)("small",null,[(0,l.Lk)("i",null,"(to be filled by OHD)")],-1)),(0,l.Lk)("p",null,(0,o.v_)(i.lifestyle.drug_detail||"-"),1)])]),t[61]||(t[61]=(0,l.Lk)("br",null,null,-1)),t[62]||(t[62]=(0,l.Lk)("div",null,[(0,l.Lk)("strong",null," Declaration:"),(0,l.Lk)("p",null,"I hereby certify the above information is correct. I also understand that voluntary non-disclosure of any of Information required above is an offence and disciplinary action may be taken against me. I further agree to give consent to the examining Approved Medical Examiner to disclose the results of this medical questionnaire and examination to authorised ATB Occupational Health Doctor/Advisor, for the purpose of verification of my fitness to work status. ")],-1)),t[63]||(t[63]=(0,l.Lk)("br",null,null,-1)),(0,l.Lk)("div",null,[t[57]||(t[57]=(0,l.Lk)("strong",null,"Declaration Consent:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.declaration_consent?"Signed Digitally":"Unsigned"),1)]),i.lifestyle.declaration_consent?((0,l.uX)(),(0,l.CE)("div",Kd,[t[58]||(t[58]=(0,l.Lk)("strong",null,"Name:",-1)),(0,l.eW)(" "+(0,o.v_)(i.lifestyle.consent_signer_name||"-"),1)])):(0,l.Q3)("",!0),i.lifestyle.declaration_consent?((0,l.uX)(),(0,l.CE)("div",Gd,[t[59]||(t[59]=(0,l.Lk)("strong",null,"Date:",-1)),(0,l.eW)(" "+(0,o.v_)(n.formatDateShort(i.lifestyle.consent_signer_date)||"-"),1)])):(0,l.Q3)("",!0),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[15]||(t[15]=(...e)=>n.openModal&&n.openModal(...e))},"Edit Lifestyle",8,Zd)])}var tu={components:{VueDatePicker:Ps.V},inject:{currentSessionHeader:{from:"currentSessionHeader",default:()=>()=>null},refreshSessionHeader:{from:"refreshSessionHeader",default:()=>async()=>{}}},data(){return{baseUrl:O.A.API_BASE_URL,lifestyle:{},modalLifestyle:{},isModalOpen:!1}},mounted(){this.fetchLifestyle()},computed:{sessionHeader(){return this.currentSessionHeader?this.currentSessionHeader():null},sessionStatus(){return this.sessionHeader?.status||"draft"}},methods:{formatDateShort:Ms,accessCheck(e){let t=null;try{t=JSON.parse(localStorage.getItem("user_info"))?.role||"staff"}catch(s){}return Pd(t,this.sessionStatus,e)},asBool(e){if(!0===e||!1===e)return e;if(null==e)return!1;if("number"===typeof e)return 1===e;if("string"===typeof e){const t=e.trim().toLowerCase();return"1"===t||"true"===t||"y"===t||"yes"===t}return!!e},fetchLifestyle(){const e=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/lifestyle/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{const t=Array.isArray(e)?e[0]||{}:e;t.declaration_consent=this.asBool(t.declaration_consent),this.lifestyle=t})).catch((e=>console.error(e)))},openModal(){this.modalLifestyle={...this.lifestyle,declaration_consent:this.asBool(this.lifestyle.declaration_consent)},this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},submitLifestyle(){const e=this.$route.params.sessionId||"",t={...this.modalLifestyle};"never smoked"===t.smoking_habit?(t.years_smoked=null,t.amount_smoke_day=null,t.date_stopped=null):"current smoker"===t.smoking_habit&&(t.date_stopped=null),"Y"!==t.alcohol_drink&&(t.drink_per_week=null),t.declaration_consent||(t.consent_signer_name="",t.consent_signer_date=null),t.declaration_consent=this.asBool(t.declaration_consent)?1:0,t.updated_by=JSON.parse(localStorage.getItem("user_info"))?.email||null,fetch(`${this.baseUrl}/lifestyle/edit/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("jwt_token")}`},body:JSON.stringify(t)}).then((e=>e.json())).then((()=>{this.isModalOpen=!1,this.fetchLifestyle()})).catch((e=>console.error(e)))}}};const su=(0,j.A)(tu,[["render",eu],["__scopeId","data-v-120c12b6"]]);var au=su;const lu={class:"std-table",style:{"border-collapse":"collapse"}},ou={style:{display:"flex",gap:"16px",margin:"16px 0","margin-bottom":"0%"}},iu={class:"std-table"},nu={class:"std-table"},ru={class:"std-table"},du={colspan:"2"},uu=["disabled"],cu={style:{display:"flex",gap:"8px"}},mu={class:"std-table"},hu={class:"std-table"},pu=["disabled"],ku={class:"physical-grid"},fu={class:"physical-item"},bu={class:"physical-item"},yu={class:"physical-item"},Lu=["value"],_u={class:"physical-item"},gu={class:"physical-item"},vu={class:"physical-item"},Su={class:"physical-item"},Cu={class:"physical-item"},wu={class:"physical-item"},Eu={class:"physical-item"},Au={class:"physical-item"},Du={class:"physical-item"},xu={class:"physical-grid"},Iu=["onUpdate:modelValue"],Uu=["onUpdate:modelValue","disabled"];function Fu(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[t[59]||(t[59]=(0,l.Lk)("h2",null,"Physical Examination",-1)),t[60]||(t[60]=(0,l.Lk)("h3",null,"Vitals & Vision",-1)),(0,l.Lk)("div",null,[(0,l.Lk)("table",lu,[t[31]||(t[31]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Weight (kg)"),(0,l.Lk)("th",null,"Height (m)"),(0,l.Lk)("th",null,"BMI"),(0,l.Lk)("th",null,"BP (Sys/Dia)"),(0,l.Lk)("th",null,"Pulse (bpm)"),(0,l.Lk)("th",null,"Blood Group")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.weight_kg??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.height_m??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.bmi??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.bp_sys??"-")+"/"+(0,o.v_)(i.physicalExam.bp_dia??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.pulse_bpm??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.blood_group??"-"),1)])])])]),(0,l.Lk)("div",ou,[(0,l.Lk)("table",iu,[t[34]||(t[34]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{colspan:"4"},"Distant Vision")]),(0,l.Lk)("tr",null,[(0,l.Lk)("th"),(0,l.Lk)("th",null,"R"),(0,l.Lk)("th",null,"L"),(0,l.Lk)("th",null,"Both")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[32]||(t[32]=(0,l.Lk)("th",null,"Uncorrected",-1)),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.dist_uncorr_r??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.dist_uncorr_l??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.dist_uncorr_b??"-"),1)]),(0,l.Lk)("tr",null,[t[33]||(t[33]=(0,l.Lk)("th",null,"Corrected",-1)),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.dist_corr_r??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.dist_corr_l??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.dist_corr_b??"-"),1)])])]),(0,l.Lk)("table",nu,[t[37]||(t[37]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{colspan:"4"},"Near Vision")]),(0,l.Lk)("tr",null,[(0,l.Lk)("th"),(0,l.Lk)("th",null,"R"),(0,l.Lk)("th",null,"L"),(0,l.Lk)("th",null,"Both")])],-1)),(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[35]||(t[35]=(0,l.Lk)("th",null,"Uncorrected",-1)),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.near_uncorr_r??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.near_uncorr_l??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.near_uncorr_b??"-"),1)]),(0,l.Lk)("tr",null,[t[36]||(t[36]=(0,l.Lk)("th",null,"Corrected",-1)),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.near_corr_r??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.near_corr_l??"-"),1),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam.near_corr_b??"-"),1)])])]),(0,l.Lk)("table",ru,[(0,l.Lk)("tbody",null,[t[38]||(t[38]=(0,l.Lk)("tr",null,[(0,l.Lk)("th",{colspan:"2"},"Colour Vision")],-1)),(0,l.Lk)("tr",null,[(0,l.Lk)("td",du,(0,o.v_)(i.physicalExam.colour_vision??"-"),1)])])])]),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[0]||(t[0]=(...e)=>n.openModal&&n.openModal(...e))},"Edit Vitals & Vision",8,uu),t[61]||(t[61]=(0,l.Lk)("h3",null,"Body System Examination",-1)),(0,l.Lk)("div",cu,[(0,l.Lk)("table",mu,[t[39]||(t[39]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Body System"),(0,l.Lk)("th",null,"Result"),(0,l.Lk)("th",null,"Details")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.bodySystemFields.slice(0,i.bodySystemFields.length/2),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,o.v_)(e.label),1)]),(0,l.Lk)("td",{style:(0,o.Tr)({color:"Abnormal"===i.physicalExam2[e.key]?"red":"Normal"===i.physicalExam2[e.key]?"green":"Not examined"===i.physicalExam2[e.key]?"grey":""})},(0,o.v_)(i.physicalExam2[e.key]??"-"),5),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam2[e.key+"_details_abnormality"]||"-"),1)])))),128))])]),(0,l.Lk)("table",hu,[t[40]||(t[40]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Body System"),(0,l.Lk)("th",null,"Result"),(0,l.Lk)("th",null,"Details")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.bodySystemFields.slice(i.bodySystemFields.length/2),(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,o.v_)(e.label),1)]),(0,l.Lk)("td",{style:(0,o.Tr)({color:"Abnormal"===i.physicalExam2[e.key]?"red":"Normal"===i.physicalExam2[e.key]?"green":"Not examined"===i.physicalExam2[e.key]?"grey":""})},(0,o.v_)(i.physicalExam2[e.key]??"-"),5),(0,l.Lk)("td",null,(0,o.v_)(i.physicalExam2[e.key+"_details_abnormality"]||"-"),1)])))),128))])])]),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[1]||(t[1]=(...e)=>n.openModal2&&n.openModal2(...e))},"Edit Body Systems",8,pu),i.isModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal-overlay",onClick:t[26]||(t[26]=(...e)=>n.closeModal&&n.closeModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[25]||(t[25]=(0,u.D$)((()=>{}),["stop"])),style:{"overflow-y":"auto","max-height":"90vh"}},[t[55]||(t[55]=(0,l.Lk)("h3",null,"Edit Vitals & Vision",-1)),(0,l.Lk)("form",{onSubmit:t[24]||(t[24]=(0,u.D$)(((...e)=>n.submitPhysicalExam&&n.submitPhysicalExam(...e)),["prevent"]))},[(0,l.Lk)("div",ku,[(0,l.Lk)("div",fu,[t[41]||(t[41]=(0,l.Lk)("label",null,"Weight (kg):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.1","onUpdate:modelValue":t[2]||(t[2]=e=>i.modalPhysicalExam.weight_kg=e),onInput:t[3]||(t[3]=(...e)=>n.calculateBMI&&n.calculateBMI(...e))},null,544),[[u.Jo,i.modalPhysicalExam.weight_kg,void 0,{number:!0}]])]),(0,l.Lk)("div",bu,[t[42]||(t[42]=(0,l.Lk)("label",null,"Height (m):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number",step:"0.01","onUpdate:modelValue":t[4]||(t[4]=e=>i.modalPhysicalExam.height_m=e),onInput:t[5]||(t[5]=(...e)=>n.calculateBMI&&n.calculateBMI(...e))},null,544),[[u.Jo,i.modalPhysicalExam.height_m,void 0,{number:!0}]])]),(0,l.Lk)("div",yu,[t[43]||(t[43]=(0,l.Lk)("label",null,"BMI:",-1)),(0,l.Lk)("input",{type:"number",value:i.modalPhysicalExam.bmi,readonly:""},null,8,Lu)]),(0,l.Lk)("div",_u,[t[44]||(t[44]=(0,l.Lk)("label",null,"BP Systolic:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=e=>i.modalPhysicalExam.bp_sys=e)},null,512),[[u.Jo,i.modalPhysicalExam.bp_sys]])]),(0,l.Lk)("div",gu,[t[45]||(t[45]=(0,l.Lk)("label",null,"BP Diastolic:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>i.modalPhysicalExam.bp_dia=e)},null,512),[[u.Jo,i.modalPhysicalExam.bp_dia]])]),(0,l.Lk)("div",vu,[t[46]||(t[46]=(0,l.Lk)("label",null,"Pulse (bpm):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>i.modalPhysicalExam.pulse_bpm=e)},null,512),[[u.Jo,i.modalPhysicalExam.pulse_bpm]])]),(0,l.Lk)("div",Su,[t[48]||(t[48]=(0,l.Lk)("label",null,"Blood Group:",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>i.modalPhysicalExam.blood_group=e)},t[47]||(t[47]=[(0,l.Lk)("option",null,"A+",-1),(0,l.Lk)("option",null,"A-",-1),(0,l.Lk)("option",null,"B+",-1),(0,l.Lk)("option",null,"B-",-1),(0,l.Lk)("option",null,"AB+",-1),(0,l.Lk)("option",null,"AB-",-1),(0,l.Lk)("option",null,"O+",-1),(0,l.Lk)("option",null,"O-",-1),(0,l.Lk)("option",null,"Unknown",-1)]),512),[[u.u1,i.modalPhysicalExam.blood_group]])]),(0,l.Lk)("div",Cu,[t[49]||(t[49]=(0,l.Lk)("label",null,"Distant Vision (R/L/B):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"R","onUpdate:modelValue":t[10]||(t[10]=e=>i.modalPhysicalExam.dist_uncorr_r=e)},null,512),[[u.Jo,i.modalPhysicalExam.dist_uncorr_r]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"L","onUpdate:modelValue":t[11]||(t[11]=e=>i.modalPhysicalExam.dist_uncorr_l=e)},null,512),[[u.Jo,i.modalPhysicalExam.dist_uncorr_l]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"B","onUpdate:modelValue":t[12]||(t[12]=e=>i.modalPhysicalExam.dist_uncorr_b=e)},null,512),[[u.Jo,i.modalPhysicalExam.dist_uncorr_b]])]),(0,l.Lk)("div",wu,[t[50]||(t[50]=(0,l.Lk)("label",null,"Distant Vision Corrected (R/L/B):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"R","onUpdate:modelValue":t[13]||(t[13]=e=>i.modalPhysicalExam.dist_corr_r=e)},null,512),[[u.Jo,i.modalPhysicalExam.dist_corr_r]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"L","onUpdate:modelValue":t[14]||(t[14]=e=>i.modalPhysicalExam.dist_corr_l=e)},null,512),[[u.Jo,i.modalPhysicalExam.dist_corr_l]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"B","onUpdate:modelValue":t[15]||(t[15]=e=>i.modalPhysicalExam.dist_corr_b=e)},null,512),[[u.Jo,i.modalPhysicalExam.dist_corr_b]])]),(0,l.Lk)("div",Eu,[t[51]||(t[51]=(0,l.Lk)("label",null,"Near Vision (R/L/B):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"R","onUpdate:modelValue":t[16]||(t[16]=e=>i.modalPhysicalExam.near_uncorr_r=e)},null,512),[[u.Jo,i.modalPhysicalExam.near_uncorr_r]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"L","onUpdate:modelValue":t[17]||(t[17]=e=>i.modalPhysicalExam.near_uncorr_l=e)},null,512),[[u.Jo,i.modalPhysicalExam.near_uncorr_l]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"B","onUpdate:modelValue":t[18]||(t[18]=e=>i.modalPhysicalExam.near_uncorr_b=e)},null,512),[[u.Jo,i.modalPhysicalExam.near_uncorr_b]])]),(0,l.Lk)("div",Au,[t[52]||(t[52]=(0,l.Lk)("label",null,"Near Vision Corrected (R/L/B):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"R","onUpdate:modelValue":t[19]||(t[19]=e=>i.modalPhysicalExam.near_corr_r=e)},null,512),[[u.Jo,i.modalPhysicalExam.near_corr_r]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"L","onUpdate:modelValue":t[20]||(t[20]=e=>i.modalPhysicalExam.near_corr_l=e)},null,512),[[u.Jo,i.modalPhysicalExam.near_corr_l]]),(0,l.bo)((0,l.Lk)("input",{type:"text",placeholder:"B","onUpdate:modelValue":t[21]||(t[21]=e=>i.modalPhysicalExam.near_corr_b=e)},null,512),[[u.Jo,i.modalPhysicalExam.near_corr_b]])]),(0,l.Lk)("div",Du,[t[53]||(t[53]=(0,l.Lk)("label",null,"Colour Vision:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[22]||(t[22]=e=>i.modalPhysicalExam.colour_vision=e)},null,512),[[u.Jo,i.modalPhysicalExam.colour_vision]])])]),t[54]||(t[54]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[23]||(t[23]=(...e)=>n.closeModal&&n.closeModal(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0),i.isModal2Open?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"modal-overlay",onClick:t[30]||(t[30]=(...e)=>n.closeModal2&&n.closeModal2(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[29]||(t[29]=(0,u.D$)((()=>{}),["stop"])),style:{"overflow-y":"auto","max-height":"90vh"}},[t[58]||(t[58]=(0,l.Lk)("h3",null,"Edit Body System Exam",-1)),(0,l.Lk)("form",{onSubmit:t[28]||(t[28]=(0,u.D$)(((...e)=>n.submitPhysicalExam2&&n.submitPhysicalExam2(...e)),["prevent"]))},[(0,l.Lk)("div",xu,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.bodySystemFields,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.key,class:"physical-item"},[(0,l.Lk)("label",null,(0,o.v_)(e.label)+":",1),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>i.modalPhysicalExam2[e.key]=t},t[56]||(t[56]=[(0,l.Lk)("option",null,"Normal",-1),(0,l.Lk)("option",null,"Abnormal",-1),(0,l.Lk)("option",null,"Not examined",-1)]),8,Iu),[[u.u1,i.modalPhysicalExam2[e.key]]]),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t=>i.modalPhysicalExam2[e.key+"_details_abnormality"]=t,placeholder:"Details (if abnormal)",style:{width:"100%",height:"50px"},disabled:"Abnormal"!==i.modalPhysicalExam2[e.key]},null,8,Uu),[[u.Jo,i.modalPhysicalExam2[e.key+"_details_abnormality"]]])])))),128))]),t[57]||(t[57]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[27]||(t[27]=(...e)=>n.closeModal2&&n.closeModal2(...e))},"Cancel")],32)])])):(0,l.Q3)("",!0)])}var Nu={inject:{currentSessionHeader:{from:"currentSessionHeader",default:()=>()=>null},refreshSessionHeader:{from:"refreshSessionHeader",default:()=>async()=>{}}},data(){return{baseUrl:O.A.API_BASE_URL,physicalExam:{},physicalExam2:{},isModalOpen:!1,isModal2Open:!1,modalPhysicalExam:{},modalPhysicalExam2:{},bodySystemFields:[{key:"head",label:"Head"},{key:"eyes",label:"Eyes"},{key:"ears_and_drums",label:"Ears and Drums"},{key:"hearing",label:"Hearing"},{key:"nose_and_sinuses",label:"Nose and Sinuses"},{key:"mouth_teeth_throat",label:"Mouth, Teeth, Throat"},{key:"neck_and_thyroid",label:"Neck and Thyroid"},{key:"chest_and_lungs",label:"Chest and Lungs"},{key:"breasts",label:"Breasts"},{key:"heart",label:"Heart"},{key:"peripheral_arteries",label:"Peripheral Arteries"},{key:"peripheral_veins",label:"Peripheral Veins"},{key:"abdomen",label:"Abdomen"},{key:"hernia_orifices",label:"Hernia Orifices"},{key:"genitalia",label:"Genitalia"},{key:"rectal_examination",label:"Rectal Examination"},{key:"upper_limbs",label:"Upper Limbs"},{key:"lower_limbs",label:"Lower Limbs"},{key:"spine",label:"Spine"},{key:"skin",label:"Skin"},{key:"lymph_nodes",label:"Lymph Nodes"},{key:"neurological",label:"Neurological"},{key:"psychiatric",label:"Psychiatric"}]}},mounted(){this.fetchPhysicalExam(),this.fetchPhysicalExam2()},computed:{sessionHeader(){return this.currentSessionHeader?this.currentSessionHeader():null},sessionStatus(){return this.sessionHeader?.status||"draft"}},methods:{accessCheck(e){let t=null;try{t=JSON.parse(localStorage.getItem("user_info"))?.role||"staff"}catch(s){}return Pd(t,this.sessionStatus,e)},calculateBMI(){this.modalPhysicalExam||(this.modalPhysicalExam={});const e=parseFloat(this.modalPhysicalExam.weight_kg),t=parseFloat(this.modalPhysicalExam.height_m);Number.isFinite(e)&&Number.isFinite(t)&&t>0?this.modalPhysicalExam.bmi=+(e/(t*t)).toFixed(1):this.modalPhysicalExam.bmi=null},fetchPhysicalExam(){const e=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/physical-exams/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.physicalExam=Array.isArray(e)?e[0]||{}:e})).catch((e=>console.error(e)))},fetchPhysicalExam2(){const e=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/physical-exams-2/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.physicalExam2=Array.isArray(e)?e[0]||{}:e})).catch((e=>console.error(e)))},openModal(){const e={weight_kg:null,height_m:null,bmi:null,bp_sys:null,bp_dia:null,pulse_bpm:null,blood_group:"Unknown",dist_uncorr_r:null,dist_uncorr_l:null,dist_uncorr_b:null,dist_corr_r:null,dist_corr_l:null,dist_corr_b:null,near_uncorr_r:null,near_uncorr_l:null,near_uncorr_b:null,near_corr_r:null,near_corr_l:null,near_corr_b:null,colour_vision:null};this.modalPhysicalExam={...e,...this.physicalExam||{}},this.calculateBMI(),this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},openModal2(){this.modalPhysicalExam2={...this.physicalExam2},this.isModal2Open=!0},closeModal2(){this.isModal2Open=!1},submitPhysicalExam(){const e=JSON.parse(localStorage.getItem("user_info")).email,t=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/physical-exams/edit/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify({...this.modalPhysicalExam,updated_by:e})}).then((e=>e.json())).then((()=>{this.fetchPhysicalExam(),this.closeModal()})).catch((e=>console.error(e)))},submitPhysicalExam2(){const e=JSON.parse(localStorage.getItem("user_info")).email,t=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/physical-exams-2/edit/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify({...this.modalPhysicalExam2,updated_by:e})}).then((e=>e.json())).then((()=>{this.fetchPhysicalExam2(),this.closeModal2()})).catch((e=>console.error(e)))}}};const $u=(0,j.A)(Nu,[["render",Fu],["__scopeId","data-v-786d9e3e"]]);var Mu=$u;const Pu={class:"table-header"},Bu=["disabled"],Xu={class:"std-table"},Ru={class:"table-header",style:{"margin-top":"24px"}},Hu=["disabled"],Ou={class:"info-container"},Tu={class:"info-box"},Vu={style:{"margin-top":"16px"}},ju={class:"std-table"},Ju=["innerHTML"],Qu=["disabled","onClick"],Yu=["onUpdate:modelValue","onChange"],Wu=["onUpdate:modelValue","onInput"],zu={class:"row-actions"},qu=["disabled","onClick"],Ku=["onClick"],Gu={key:0,class:"sticky-bar bottom"},Zu={class:"muted"},ec={class:"table-header",style:{"margin-top":"24px"}},tc=["disabled"],sc={class:"std-table"},ac={class:"inv-box"},lc={class:"two-col"},oc={class:"lbl"},ic=["onUpdate:modelValue"],nc=["onUpdate:modelValue"],rc={style:{"margin-top":"8px"}},dc={style:{"margin-top":"10px"}},uc={style:{"margin-top":"10px"}},cc={class:"inv-grid"},mc={class:"lbl"},hc=["innerHTML"],pc=["onUpdate:modelValue"],kc=["onUpdate:modelValue"],fc={style:{"margin-top":"10px"}},bc={class:"two-col"},yc={class:"lbl"},Lc=["onUpdate:modelValue"],_c=["onUpdate:modelValue"],gc={class:"card"},vc={style:{"margin-top":"8px"}};function Sc(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[t[44]||(t[44]=(0,l.Lk)("h2",null,"Investigations",-1)),(0,l.Lk)("h3",Pu,[t[22]||(t[22]=(0,l.eW)(" General Investigations ")),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[0]||(t[0]=(...e)=>n.openGenModal&&n.openGenModal(...e))},"Edit General Investigations",8,Bu)]),(0,l.Lk)("table",Xu,[t[23]||(t[23]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{style:{width:"30%"}},"Test"),(0,l.Lk)("th",{style:{width:"20%"}},"Status"),(0,l.Lk)("th",null,"Details of any abnormality")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.generalRows,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,(0,o.v_)(e.label),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:"Abnormal"===i.investigations[e.statusKey]?"red":"Normal"===i.investigations[e.statusKey]?"green":"grey"})},(0,o.v_)(i.investigations[e.statusKey]??"-"),5)]),(0,l.Lk)("td",null,(0,o.v_)(i.investigations[e.detailsKey]??"-"),1)])))),128))])]),(0,l.Lk)("h2",Ru,[t[24]||(t[24]=(0,l.eW)(" Laboratory Results ")),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[1]||(t[1]=(...e)=>n.openLabModal&&n.openLabModal(...e))},"Edit All Lab Results",8,Hu)]),(0,l.Lk)("div",Ou,[(0,l.Lk)("span",{class:"info-icon",style:{"align-items":"right"},onClick:t[2]||(t[2]=e=>i.showInfo=!this.showInfo)},"â„¹ï¸"),i.showInfo?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"info-overlay",onClick:t[4]||(t[4]=(0,u.D$)((e=>i.showInfo=!1),["self"]))},[(0,l.Lk)("div",Tu,[t[25]||(t[25]=(0,l.Fv)('<h4 style="color:black;">Hybrid Edit Mode</h4><p style="color:black;"> You can opt to edit Lab Results <b>all at once</b> (Edit All Lab Results) or <b>each individual lines</b> (Action &gt; Edit).<br><b>Tip:</b> You can edit multiple lines using Edit button, then either click the <b>&#39;Save All&#39;</b> or <b>&#39;Cancel&#39;</b> button in the bottom row to update/cancel all changes. </p>',2)),(0,l.Lk)("button",{style:{color:"white","background-color":"blue"},onClick:t[3]||(t[3]=e=>i.showInfo=!1)},"Got it")])])):(0,l.Q3)("",!0)]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.labGroupOrder,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e},[(0,l.Lk)("h3",Vu,(0,o.v_)(n.groupLabel(e)),1),(0,l.Lk)("table",ju,[t[27]||(t[27]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{style:{width:"28%"}},"Test"),(0,l.Lk)("th",{style:{width:"10%"}},"Abbrv."),(0,l.Lk)("th",{style:{width:"24%"}},"Normal Range"),(0,l.Lk)("th",{style:{width:"18%"}},"Result"),(0,l.Lk)("th",null,"Remark"),(0,l.Lk)("th",{style:{width:"110px"}},"Action")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.labGroups[e],(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,(0,o.v_)(e.test),1),(0,l.Lk)("td",null,(0,o.v_)(e.abbr),1),(0,l.Lk)("td",{innerHTML:e.range||"-"},null,8,Ju),i.editingRow!==e.key?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:"Abnormal"===i.investigationsLab[`${e.key}_result`]?"red":"Normal"===i.investigationsLab[`${e.key}_result`]?"green":"grey"})},(0,o.v_)(i.investigationsLab[`${e.key}_result`]??"Not done"),5)]),(0,l.Lk)("td",null,(0,o.v_)(i.investigationsLab[`${e.key}_remark`]??"-"),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"mini-btn",onClick:t=>n.startRowEdit(e.key)},"Edit",8,Qu)])],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>i.editableLab[`${e.key}_result`]=t,onChange:t=>n.markDirty(e.key)},t[26]||(t[26]=[(0,l.Lk)("option",null,"Not done",-1),(0,l.Lk)("option",null,"Normal",-1),(0,l.Lk)("option",null,"Abnormal",-1)]),40,Yu),[[u.u1,i.editableLab[`${e.key}_result`]]])]),(0,l.Lk)("td",null,[(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t=>i.editableLab[`${e.key}_remark`]=t,onInput:t=>n.markDirty(e.key),placeholder:"Remark (optional)"},null,40,Wu),[[u.Jo,i.editableLab[`${e.key}_remark`]]])]),(0,l.Lk)("td",zu,[(0,l.Lk)("button",{class:"mini-btn primary",disabled:!n.isRowDirty(e.key),onClick:t=>n.saveLabRow(e.key)},"Save",8,qu),(0,l.Lk)("button",{class:"mini-btn",onClick:t=>n.cancelRowEdit(e.key)},"Cancel",8,Ku)])],64))])))),128))])])])))),128)),i.dirtyKeys.size?((0,l.uX)(),(0,l.CE)("div",Gu,[(0,l.Lk)("button",{class:"primary",onClick:t[5]||(t[5]=(...e)=>n.saveAllLab&&n.saveAllLab(...e))},"Save All"),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>n.cancelAllLab&&n.cancelAllLab(...e))},"Cancel"),(0,l.Lk)("span",Zu,(0,o.v_)(i.dirtyKeys.size)+" change(s) pending",1)])):(0,l.Q3)("",!0),(0,l.Lk)("h2",ec,[t[28]||(t[28]=(0,l.eW)(" Urine Drug Test ")),(0,l.Lk)("button",{disabled:!n.accessCheck("edit"),class:"action-btn",onClick:t[7]||(t[7]=(...e)=>n.openDrugModal&&n.openDrugModal(...e))},"Edit Drug Tests",8,tc)]),(0,l.Lk)("table",sc,[t[29]||(t[29]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{style:{width:"40%"}},"Test"),(0,l.Lk)("th",{style:{width:"25%"}},"Result"),(0,l.Lk)("th",null,"Remark")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.drugTests,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.key},[(0,l.Lk)("td",null,(0,o.v_)(e.label),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{style:(0,o.Tr)({color:"Negative"===i.investigations[`${e.key}_result`]?"green":"Non-negative"===i.investigations[`${e.key}_result`]?"red":"Not done"===i.investigations[`${e.key}_result`]?"grey":""})},(0,o.v_)(i.investigations[`${e.key}_result`]??"Not done"),5)]),(0,l.Lk)("td",null,(0,o.v_)(i.investigations[`${e.key}_remark`]??"-"),1)])))),128))])]),(0,l.Lk)("div",ac,[t[30]||(t[30]=(0,l.Lk)("strong",null,"Remarks by Examine Doctor : ",-1)),t[31]||(t[31]=(0,l.eW)()),t[32]||(t[32]=(0,l.Lk)("small",null,[(0,l.Lk)("i",null,"(to be filled by OHD)")],-1)),(0,l.Lk)("div",null,(0,o.v_)(i.investigations.remarks_ohd&&i.investigations.remarks_ohd.trim()?i.investigations.remarks_ohd:"-"),1)]),i.isGenModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"modal-overlay",onClick:t[11]||(t[11]=(...e)=>n.closeGenModal&&n.closeGenModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[10]||(t[10]=(0,u.D$)((()=>{}),["stop"])),style:{"overflow-y":"auto","max-height":"90vh"}},[t[35]||(t[35]=(0,l.Lk)("h3",null,"Edit General Investigations",-1)),(0,l.Lk)("form",{onSubmit:t[9]||(t[9]=(0,u.D$)(((...e)=>n.submitGeneral&&n.submitGeneral(...e)),["prevent"]))},[(0,l.Lk)("div",lc,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.generalRows,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.key,class:"card"},[(0,l.Lk)("label",oc,(0,o.v_)(e.label),1),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>i.modalGeneral[e.statusKey]=t},t[33]||(t[33]=[(0,l.Lk)("option",{value:null},"-",-1),(0,l.Lk)("option",null,"Normal",-1),(0,l.Lk)("option",null,"Abnormal",-1)]),8,ic),[[u.u1,i.modalGeneral[e.statusKey]]]),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t=>i.modalGeneral[e.detailsKey]=t,placeholder:"Details of any abnormality"},null,8,nc),[[u.Jo,i.modalGeneral[e.detailsKey]]])])))),128))]),(0,l.Lk)("div",rc,[t[34]||(t[34]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[8]||(t[8]=(...e)=>n.closeGenModal&&n.closeGenModal(...e))},"Cancel")])],32)])])):(0,l.Q3)("",!0),i.isLabModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:2,class:"modal-overlay",onClick:t[16]||(t[16]=(...e)=>n.closeLabModal&&n.closeLabModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[15]||(t[15]=(0,u.D$)((()=>{}),["stop"])),style:{"overflow-y":"auto","max-height":"90vh"}},[t[39]||(t[39]=(0,l.Lk)("h3",null,"Edit All Laboratory Results",-1)),(0,l.Lk)("form",{onSubmit:t[14]||(t[14]=(0,u.D$)(((...e)=>n.submitLab&&n.submitLab(...e)),["prevent"]))},[(0,l.Lk)("div",dc,[t[36]||(t[36]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[12]||(t[12]=(...e)=>n.closeLabModal&&n.closeLabModal(...e))},"Cancel")]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.labGroupOrder,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e},[(0,l.Lk)("h4",uc,(0,o.v_)(n.groupLabel(e)),1),(0,l.Lk)("div",cc,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.labGroups[e],(e=>((0,l.uX)(),(0,l.CE)("div",{class:"inv-item",key:e.key},[(0,l.Lk)("div",mc,(0,o.v_)(e.test)+" ("+(0,o.v_)(e.abbr)+")",1),(0,l.Lk)("div",{class:"muted",innerHTML:e.range||"Â "},null,8,hc),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>i.modalLab[`${e.key}_result`]=t},t[37]||(t[37]=[(0,l.Lk)("option",null,"Not done",-1),(0,l.Lk)("option",null,"Normal",-1),(0,l.Lk)("option",null,"Abnormal",-1)]),8,pc),[[u.u1,i.modalLab[`${e.key}_result`]]]),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t=>i.modalLab[`${e.key}_remark`]=t,placeholder:"Remark (optional)"},null,8,kc),[[u.Jo,i.modalLab[`${e.key}_remark`]]])])))),128))])])))),128)),(0,l.Lk)("div",fc,[t[38]||(t[38]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[13]||(t[13]=(...e)=>n.closeLabModal&&n.closeLabModal(...e))},"Cancel")])],32)])])):(0,l.Q3)("",!0),i.isDrugModalOpen?((0,l.uX)(),(0,l.CE)("div",{key:3,class:"modal-overlay",onClick:t[21]||(t[21]=(...e)=>n.closeDrugModal&&n.closeDrugModal(...e))},[(0,l.Lk)("div",{class:"modal-content",onClick:t[20]||(t[20]=(0,u.D$)((()=>{}),["stop"])),style:{"overflow-y":"auto","max-height":"90vh"}},[t[43]||(t[43]=(0,l.Lk)("h3",null,"Edit Urine Drug Test & OHD Remarks",-1)),(0,l.Lk)("form",{onSubmit:t[19]||(t[19]=(0,u.D$)(((...e)=>n.submitDrug&&n.submitDrug(...e)),["prevent"]))},[(0,l.Lk)("div",bc,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.drugTests,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.key,class:"card"},[(0,l.Lk)("label",yc,(0,o.v_)(e.label)+" Result",1),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t=>i.modalDrug[`${e.key}_result`]=t},t[40]||(t[40]=[(0,l.Lk)("option",null,"Not done",-1),(0,l.Lk)("option",null,"Negative",-1),(0,l.Lk)("option",null,"Non-negative",-1)]),8,Lc),[[u.u1,i.modalDrug[`${e.key}_result`]]]),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t=>i.modalDrug[`${e.key}_remark`]=t,placeholder:"Remark"},null,8,_c),[[u.Jo,i.modalDrug[`${e.key}_remark`]]])])))),128))]),(0,l.Lk)("div",gc,[t[41]||(t[41]=(0,l.Lk)("label",{class:"lbl"},"Remarks by Examine Doctor :",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[17]||(t[17]=e=>i.modalDrug.remarks_ohd=e),placeholder:"Summary / conclusion"},null,512),[[u.Jo,i.modalDrug.remarks_ohd]])]),(0,l.Lk)("div",vc,[t[42]||(t[42]=(0,l.Lk)("button",{type:"submit"},"Save Changes",-1)),(0,l.Lk)("button",{type:"button",onClick:t[18]||(t[18]=(...e)=>n.closeDrugModal&&n.closeDrugModal(...e))},"Cancel")])],32)])])):(0,l.Q3)("",!0)])}var Cc={inject:{currentSessionHeader:{from:"currentSessionHeader",default:()=>()=>null},refreshSessionHeader:{from:"refreshSessionHeader",default:()=>async()=>{}}},data(){return{baseUrl:O.A.API_BASE_URL,showInfo:!1,investigations:{},investigationsLab:{},isGenModalOpen:!1,isLabModalOpen:!1,isDrugModalOpen:!1,modalGeneral:{},modalLab:{},modalDrug:{},editableLab:{},originalLab:{},dirtyKeys:new Set,editingRow:null,generalRows:[{key:"spirometry",label:"Spirometry",statusKey:"spirometry_status",detailsKey:"spirometry_details"},{key:"audiometry",label:"Audiometry",statusKey:"audiometry_status",detailsKey:"audiometry_details"},{key:"chest_xray",label:"Chest X-ray",statusKey:"chest_xray_status",detailsKey:"chest_xray_details"},{key:"electrocardiograph",label:"Electrocardiograph",statusKey:"electrocardiograph_status",detailsKey:"electrocardiograph_details"}],labGroupOrder:["haematology","glucose","lipids","electrolytes","renal","liver","urineChem","urineMicro","serology"],labGroups:{haematology:[{key:"hb",test:"Haemoglobin",abbr:"Hb",range:"13 - 18 g/dl"},{key:"rbc",test:"RBC",abbr:"RBC",range:"4.50 - 6.50 x 10^12/L"},{key:"pcv",test:"PCV",abbr:"PCV",range:"0.40 - 0.55"},{key:"mcv",test:"MCV",abbr:"MCV",range:"78 - 99 fl"},{key:"mch",test:"MCH",abbr:"MCH",range:"27 - 32 pg"},{key:"mchc",test:"MCHC",abbr:"MCHC",range:"300 - 600 g/L"},{key:"rdw",test:"RDW",abbr:"RDW",range:"11.15%"},{key:"wbc",test:"White Cell Count",abbr:"WBC",range:"4 - 11 x 10^9/L"},{key:"neut",test:"Neutrophils",abbr:"Neut",range:"2.0 - 8.0 x 10^9/L"},{key:"lym",test:"Lymphocytes",abbr:"Lym",range:"1.0 - 4.0 x 10^9/L"},{key:"mon",test:"Monocytes",abbr:"Mon",range:"&lt;1.1 x 10^9/L"},{key:"eon",test:"Eosinophils",abbr:"Eon",range:"&lt;0.6 x 10^9/L"},{key:"bas",test:"Basophils",abbr:"Bas",range:"&lt;0.2 x 10^9/L"},{key:"plet",test:"Platelets",abbr:"Plet",range:"150 - 450 x 10^9/L"},{key:"esr",test:"ESR",abbr:"ESR",range:"&lt;21 mm/hr"},{key:"fbp",test:"Full Blood Picture",abbr:"FBP",range:""}],glucose:[{key:"fbs",test:"Fasting",abbr:"FBS",range:"(3.9 - 6.0 mmol/L)"},{key:"rbs",test:"Random",abbr:"RBS",range:"(3.9 - 10.0 mmol/L)"}],lipids:[{key:"tchol",test:"Total Cholesterol",abbr:"Tchol",range:"&lt;5.2 mmol/L"},{key:"tg",test:"Triglyceride",abbr:"TG",range:"&lt;1.68 mmol/L"},{key:"hdl",test:"HDL Cholesterol",abbr:"HDL",range:"&gt;1.03 mmol/L"},{key:"ldl",test:"LDL Cholesterol",abbr:"LDL",range:"&lt;3.9 mmol/L"}],electrolytes:[{key:"na",test:"Sodium",abbr:"Na",range:"135 - 145 mmol/L"},{key:"k",test:"Potassium",abbr:"K",range:"3.5 - 5.1 mmol/L"},{key:"cl",test:"Chloride",abbr:"Cl",range:"95 - 110 mmol/L"}],renal:[{key:"bu",test:"Urea",abbr:"BU",range:"2.5 - 8.0 mmol/L"},{key:"creat",test:"Creatinine",abbr:"Creat",range:"53 - 115 Âµmol/L"},{key:"ua",test:"Uric acid",abbr:"UA",range:"153 - 425 Âµmol/L"},{key:"ca",test:"Calcium",abbr:"Ca",range:"2.10 - 2.60 mmol/L"},{key:"cca",test:"Corrected Calcium",abbr:"Cca",range:"2.10 - 2.60 mmol/L"},{key:"po4",test:"Phosphate",abbr:"PO4",range:"0.65 - 1.45 mmol/L"}],liver:[{key:"tprot",test:"Total Protein",abbr:"Tprot",range:"60 - 82 g/dl"},{key:"alb",test:"Albumin",abbr:"Alb",range:"35 - 50 g/dl"},{key:"glo",test:"Globulin",abbr:"Glo",range:"20 - 39 g/dl"},{key:"agr",test:"Albumin/Globulin Ratio",abbr:"AGR",range:"1.0 - 2.5"},{key:"alkp",test:"Alkaline Phosphatase",abbr:"AlkP",range:"30 - 120 U/L"},{key:"tbil",test:"Total Bilirubin",abbr:"Tbil",range:"&lt;21 Âµmol/L"},{key:"ggt",test:"Gamma Glutamyl Transferase",abbr:"GGT",range:"&lt;51 U/L"},{key:"ast",test:"Aspartate Transaminase",abbr:"AST",range:"&lt;41 U/L"},{key:"alt",test:"Alanine Transaminase",abbr:"ALT",range:"&lt;51 U/L"}],urineChem:[{key:"uprot",test:"Protein",abbr:"Uprot",range:"Negative"},{key:"uph",test:"pH",abbr:"UpH",range:"Acidic"},{key:"uglu",test:"Glucose",abbr:"Uglu",range:"Negative"},{key:"uket",test:"Ketones",abbr:"Uket",range:"Negative"},{key:"usg",test:"Specific Gravity",abbr:"USG",range:"1.005 - 1.030"},{key:"ubld",test:"Blood",abbr:"Ubld",range:"Negative"}],urineMicro:[{key:"uleu",test:"Leucocytes",abbr:"Uleu",range:"&lt;10 x 10^6/L"},{key:"uery",test:"Erythrocytes",abbr:"Uery",range:"&lt;10 x 10^6/L"},{key:"uecell",test:"Epithelial Cells",abbr:"UEcell",range:"Negative"},{key:"ucc",test:"Cast and Crystal",abbr:"UCC",range:"Negative"}],serology:[{key:"vdrl",test:"VDRL",abbr:"VDRL",range:"non-reactive"},{key:"hbsag",test:"Hep B surface antigen",abbr:"HbsAg",range:"non-detected"},{key:"hbsab",test:"Hep B surface antibody",abbr:"HbsAb",range:"0 IU/L"},{key:"hcs",test:"Hep C Antigen/Antibody",abbr:"Hcs",range:""}]},drugTests:[{key:"opiates",label:"Opiates"},{key:"cannabinoids",label:"Cannabinoids"},{key:"amphetamine",label:"Amphetamine"},{key:"mdma",label:"MDMA"},{key:"benzodiazepine",label:"Benzodiazepine"}]}},computed:{sessionHeader(){return this.currentSessionHeader?this.currentSessionHeader():null},sessionStatus(){return this.sessionHeader?.status||"draft"}},mounted(){this.fetchInvestigations(),this.fetchInvestigationsLab().then((()=>{this.seedLabEditors()}))},methods:{accessCheck(e){let t=null;try{t=JSON.parse(localStorage.getItem("user_info"))?.role||"staff"}catch(s){}return Pd(t,this.sessionStatus,e)},groupLabel(e){const t={haematology:"Haematology",glucose:"Glucose",lipids:"Lipids",electrolytes:"Electrolytes",renal:"Renal Function",liver:"Liver Function",urineChem:"Urinalysis (Chemistry)",urineMicro:"Urinalysis (Microscopy)",serology:"Serology"};return t[e]||e},async fetchInvestigations(){const e=this.$route.params.sessionId||"";return fetch(`${this.baseUrl}/investigations/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.investigations=Array.isArray(e)?e[0]||{}:e})).catch((e=>console.error(e)))},async fetchInvestigationsLab(){const e=this.$route.params.sessionId||"";return fetch(`${this.baseUrl}/investigations-lab/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`}}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((e=>{this.investigationsLab=Array.isArray(e)?e[0]||{}:e})).catch((e=>console.error(e)))},seedLabEditors(){const e={};Object.values(this.labGroups).flat().forEach((t=>{e[`${t.key}_result`]=this.investigationsLab?.[`${t.key}_result`]??"Not done",e[`${t.key}_remark`]=this.investigationsLab?.[`${t.key}_remark`]??null})),this.editableLab={...e},this.originalLab=JSON.parse(JSON.stringify(e)),this.dirtyKeys.clear(),this.editingRow=null},markDirty(e){const t=`${e}_result`,s=`${e}_remark`,a=this.editableLab[t]!==this.originalLab[t]||(this.editableLab[s]??"")!==(this.originalLab[s]??"");a?this.dirtyKeys.add(e):this.dirtyKeys.delete(e)},isRowDirty(e){return this.dirtyKeys.has(e)},startRowEdit(e){this.editableLab[`${e}_result`]=this.investigationsLab?.[`${e}_result`]??"Not done",this.editableLab[`${e}_remark`]=this.investigationsLab?.[`${e}_remark`]??null,this.originalLab[`${e}_result`]=this.editableLab[`${e}_result`],this.originalLab[`${e}_remark`]=this.editableLab[`${e}_remark`],this.dirtyKeys.delete(e),this.editingRow=e},cancelRowEdit(e){this.editableLab[`${e}_result`]=this.originalLab[`${e}_result`],this.editableLab[`${e}_remark`]=this.originalLab[`${e}_remark`],this.dirtyKeys.delete(e),this.editingRow===e&&(this.editingRow=null)},saveLabRow(e){const t={...this.investigationsLab};t[`${e}_result`]=this.editableLab[`${e}_result`],t[`${e}_remark`]=this.editableLab[`${e}_remark`],t.updated_by=JSON.parse(localStorage.getItem("user_info")).email;const s=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/investigations-lab/edit/${s}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((()=>{this.investigationsLab=t,this.originalLab[`${e}_result`]=this.editableLab[`${e}_result`],this.originalLab[`${e}_remark`]=this.editableLab[`${e}_remark`],this.dirtyKeys.delete(e),this.editingRow===e&&(this.editingRow=null),this.fetchInvestigationsLab()})).catch((e=>console.error(e)))},saveAllLab(){const e={...this.investigationsLab,...this.editableLab};e.updated_by=JSON.parse(localStorage.getItem("user_info")).email;const t=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/investigations-lab/edit/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((()=>{this.investigationsLab=e,this.seedLabEditors()})).catch((e=>console.error(e)))},cancelAllLab(){this.editableLab=JSON.parse(JSON.stringify(this.originalLab)),this.dirtyKeys.clear(),this.editingRow=null},openGenModal(){const e=this.investigations||{},t={};this.generalRows.forEach((s=>{t[s.statusKey]=e[s.statusKey]??null,t[s.detailsKey]=e[s.detailsKey]??null})),this.modalGeneral=t,this.isGenModalOpen=!0},closeGenModal(){this.isGenModalOpen=!1,this.fetchInvestigations()},submitGeneral(){const e=this.$route.params.sessionId||"",t={...this.investigations||{},...this.modalGeneral};t.updated_by=JSON.parse(localStorage.getItem("user_info")).email,fetch(`${this.baseUrl}/investigations/edit/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((()=>{this.fetchInvestigations(),this.closeGenModal()})).catch((e=>console.error(e)))},openLabModal(){const e={};Object.values(this.labGroups).flat().forEach((t=>{e[`${t.key}_result`]="Not done",e[`${t.key}_remark`]=null})),this.modalLab={...e,...this.investigationsLab||{}},this.modalLab.updated_by=JSON.parse(localStorage.getItem("user_info")).email,this.isLabModalOpen=!0},closeLabModal(){this.isLabModalOpen=!1,this.fetchInvestigationsLab()},submitLab(){const e=this.$route.params.sessionId||"";fetch(`${this.baseUrl}/investigations-lab/edit/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(this.modalLab)}).then((e=>e.json())).then((()=>{this.fetchInvestigationsLab().then((()=>this.seedLabEditors())),this.closeLabModal()})).catch((e=>console.error(e)))},openDrugModal(){const e=this.investigations||{},t={};this.drugTests.forEach((s=>{t[`${s.key}_result`]=e[`${s.key}_result`]??"Not done",t[`${s.key}_remark`]=e[`${s.key}_remark`]??null})),t.remarks_ohd=e.remarks_ohd??null,this.modalDrug=t,this.isDrugModalOpen=!0},closeDrugModal(){this.isDrugModalOpen=!1,this.fetchInvestigations()},submitDrug(){const e=this.$route.params.sessionId||"",t={...this.investigations||{},...this.modalDrug};t.updated_by=JSON.parse(localStorage.getItem("user_info")).email,fetch(`${this.baseUrl}/investigations/edit/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((()=>{this.fetchInvestigations(),this.closeDrugModal()})).catch((e=>console.error(e)))}}};const wc=(0,j.A)(Cc,[["render",Sc]]);var Ec=wc;const Ac={key:0},Dc=["disabled"],xc={key:1};function Ic(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[t[16]||(t[16]=(0,l.Lk)("h2",null,"Doctor Information",-1)),i.isEditing?((0,l.uX)(),(0,l.CE)("div",Ac,[(0,l.Lk)("form",{onSubmit:t[4]||(t[4]=(0,u.D$)(((...e)=>n.updateDoctorInfo&&n.updateDoctorInfo(...e)),["prevent"]))},[(0,l.Lk)("div",null,[t[7]||(t[7]=(0,l.Lk)("label",{for:"doctor_name"},"Name:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.doctorData.doctor_name=e),required:""},null,512),[[u.Jo,i.doctorData.doctor_name]])]),(0,l.Lk)("div",null,[t[8]||(t[8]=(0,l.Lk)("label",{for:"doctor_email"},"Email (readonly):",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.doctorData.doctor_email=e),readonly:"",style:{"background-color":"#ccc",cursor:"not-allowed"}},null,512),[[u.Jo,i.doctorData.doctor_email]])]),(0,l.Lk)("div",null,[t[9]||(t[9]=(0,l.Lk)("label",{for:"phone_no"},"Phone No:",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>i.doctorData.phone_no=e),required:""},null,512),[[u.Jo,i.doctorData.phone_no]])]),(0,l.Lk)("button",{type:"submit",disabled:!n.isFormChanged},"Save Changes",8,Dc),(0,l.Lk)("button",{type:"button",onClick:t[3]||(t[3]=(...e)=>n.cancelEdit&&n.cancelEdit(...e))},"Cancel")],32)])):((0,l.uX)(),(0,l.CE)("div",xc,[(0,l.Lk)("table",null,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[10]||(t[10]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Name:")],-1)),t[11]||(t[11]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.doctorData.doctor_name),1)]),(0,l.Lk)("tr",null,[t[12]||(t[12]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Email:")],-1)),t[13]||(t[13]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.doctorData.doctor_email),1)]),(0,l.Lk)("tr",null,[t[14]||(t[14]=(0,l.Lk)("td",null,[(0,l.Lk)("b",null,"Phone No:")],-1)),t[15]||(t[15]=(0,l.eW)()),(0,l.Lk)("td",null,(0,o.v_)(i.doctorData.phone_no),1)])])]),(0,l.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>n.editDoctorInfo&&n.editDoctorInfo(...e))},"Edit"),(0,l.Lk)("button",{onClick:t[6]||(t[6]=t=>e.$router.push("/dashboard")),style:{"margin-left":"1rem"}},"Back")]))])}var Uc={data(){return{baseUrl:O.A.API_BASE_URL,isEditing:!1,doctorData:{doctor_uid:"",doctor_email:"",doctor_name:"",phone_no:""},originalDoctorData:null}},mounted(){this.fetchDoctorInfo()},computed:{isFormChanged(){if(!this.originalDoctorData)return!1;const e=["doctor_name","phone_no"];return e.some((e=>this.doctorData[e]!==this.originalDoctorData[e]))}},methods:{fetchDoctorInfo(){const e=localStorage.getItem("user_info");if(!e)return;const t=JSON.parse(e).email.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/doctor/info/${encodeURIComponent(t)}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{this.doctorData=e,this.originalDoctorData=JSON.parse(JSON.stringify(e))})).catch((e=>{console.error("Error:",e),alert("Failed to fetch doctor info.")}))},editDoctorInfo(){this.isEditing=!0},cancelEdit(){this.isEditing=!1,this.fetchDoctorInfo()},updateDoctorInfo(){const e=localStorage.getItem("user_info");if(!e)return;const t=JSON.parse(e).email.replace(/\./g,"XYZ");fetch(`${this.baseUrl}/doctor/edit-info/${encodeURIComponent(t)}`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")}`,"Content-Type":"application/json"},body:JSON.stringify(this.doctorData)}).then((e=>{if(!(0,T.$)(e))return e.json()})).then((()=>{this.isEditing=!1,alert("Personal info updated successfully"),this.fetchDoctorInfo()})).catch((e=>{console.error("Error updating doctor info:",e),alert("Failed to update data.")}))}}};const Fc=(0,j.A)(Uc,[["render",Ic]]);var Nc=Fc;const $c=[{path:"/",name:"Login",component:mt},{path:"/register",name:"Register",component:at},{path:"/profile",name:"profile",component:xt},{path:"/dashboard",name:"Dashboard",component:we,meta:{requiresAuth:!0}},{path:"/admin/manage-users",component:Ea,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/view-user/:email",component:Xn,props:!0,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/register-user",component:Qa,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/edit-user/:userId",component:ol,props:!0,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/manage-sessions",component:Go,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/non-session-completeness",component:xn,meta:{requiresAuth:!0,role:"admin"}},{path:"/reset-password/:userId/:userEmail",component:Ua,meta:{requiresAuth:!0,role:"admin"}},{path:"/staff/analytics-page",component:Gr,meta:{requiresAuth:!0,role:"staff"}},{path:"/staff/my-sessions",component:vd,meta:{requiresAuth:!0,role:"staff"}},{path:"/doctor/manage-info",component:Nc,meta:{requiresAuth:!0,role:"doctor"}},{path:"/doctor/non-session-completeness",component:xn,meta:{requiresAuth:!0,role:"doctor"}},{path:"/analytics-all-page",alias:["/admin/analytics-all-page","/doctor/analytics-all-page"],component:ma,meta:{requiresAuth:!0,rolesAllowed:["admin","doctor"]}},{path:"/manage-sessions",alias:["/admin/manage-sessions","/doctor/manage-sessions"],component:Go,meta:{requiresAuth:!0,rolesAllowed:["admin","doctor"]}},{path:"/non-session/:staffEmail?",alias:["/staff/non-session","/admin/non-session/:staffEmail","/doctor/non-session/:staffEmail"],component:qt,children:[{path:"",redirect:{name:"ns-staff-info"}},{path:"staff-info",name:"ns-staff-info",component:ur},{path:"occ-history",name:"ns-occ-history",component:yr},{path:"fam-history",name:"ns-fam-history",component:Ir}],meta:{requiresAuth:!0,rolesAllowed:["staff","admin","doctor"]}},{path:"/session/:sessionId",alias:["/staff/session/:sessionId","/admin/session/:sessionId","/doctor/session/:sessionId"],component:Tt,children:[{path:"",redirect:{name:"session-medical-history"}},{path:"medical-history",name:"session-medical-history",component:Rd},{path:"physical",name:"session-physical",component:Mu},{path:"investigations",name:"session-investigations",component:Ec},{path:"lifestyle",name:"session-lifestyle",component:au}],meta:{requiresAuth:!0,rolesAllowed:["staff","doctor","admin"]}},{path:"/export/medical",name:"export-medical",component:()=>s.e(140).then(s.bind(s,1140)),meta:{requiresAuth:!0,rolesAllowed:["admin","doctor","staff"]}},{path:"/reset-password",component:Ua}],Mc=(0,a.aE)({history:(0,a.Bt)(),routes:$c});Mc.beforeEach(((e,t,s)=>{const a=!!localStorage.getItem("jwt_token"),l=localStorage.getItem("user_info");let o=null;if(l)try{o=JSON.parse(l).role||null}catch(i){return console.error("Error parsing user_info from localStorage:",i),localStorage.removeItem("jwt_token"),localStorage.removeItem("user_info"),s({name:"Login"})}if(e.meta.requiresAuth){if(!a)return s({name:"Login"});if(e.meta.role&&o!==e.meta.role&&"admin"!==o)return alert(`Access Denied: You do not have the required role (${e.meta.role}) to view this page.`),s({name:"Dashboard"});if(Array.isArray(e.meta.rolesAllowed)&&!e.meta.rolesAllowed.includes(o))return alert("Access Denied: You do not have permission to view this page."),s({name:"Dashboard"})}s()}));var Pc=Mc},4046:function(e,t,s){var a=s(5130),l=(s(4114),s(6768)),o=s(4232),i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdIAAADVCAMAAADUzIEIAAAAk1BMVEVMaXEAGDEAGDEAGDHxiAAAGDEAbrfxiAAAGDEAGDEAGDEAGDEAGDEAGDEAGDEAGDEAGDEAGDEAGDHxiAAAbrcAbrcAbrcAbrcAbrcAbrcAbrcAbrcAbrfxiAAAbrfxiAAAbrfxiAAAbrfxiADxiADxiADxiAAAbrfxiADxiADxiADxiAAAbrfxiAAAGDHxiAAAbrfsUFIbAAAALnRSTlMAINBAwPBAgBCAoGBwkLDAMOBQQIDAIKAQ0GDwsCCQ8HAQ4KAwYNBQUJDgcDCwYQcD4QAAAAlwSFlzAAAuIwAALiMBeKU/dgAAC7dJREFUeJztnel2okoUheOI8xTUOJto5o74/k93F0IEa5+Cgqgpb/b3q5tJFpszVlG5I4QQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBDy1+h1FRp8BW6c9k6h/defiN3UVb12cLt99YgeHEIsoqjq1VHvraAeUaF+NgN67Zrq3bbUIxhKrQb02hXU2wU7Hvz1h2Y3HVWvonq7YMf0u1ZTAyNtqbfbTA22xCZAL/S7YMcQbIlNNFS9+urNoR3XqKDNVFS9oIsAdky/azUDMEHoIoAdQ7AlNgGtPsxmwY4h2BKbgFYfdBHAjqHIITbRA78LXQTwu/XbVnABW4y4v/Z95uUPtuzfYIsRzrXvMy/Q6oNsFuwYipwbw8lnpi+w5ZqUSqVWvV4flEppiQy0+rCLAPlTvMgplEqlWzNaZwObDLj3rn2fIbVBu3uaoBYbrQRdsWUPXQTwu6Xwp5qNbxPvd5pwmr04Xo6w+PjxK5IWWuBGw0deV1UFnQQCFwx2HBQ5JTVpaiS8OHbheKtt1ht6fPHOLKlJaB50URXdE4f4KBG4YLBjv8gpSb/VvhFLdTxv9QxbE9m+eJ6XM1PWkO79B2l2V4m3fCA+SgQKgeEP7mqa0/u3EVUdz/O890fYrudz5Z+S8TVIZltO3H13V5CsRjKvENBJIGgogN/d1Xrasys3oelBUm/lmIp6/3I4wfvI8hak8ZUiaQtadiLH+gR1EgisGlv2vYQfuwlNA0l9UQ1c6eNzKKhv2bA3N89eoqQ1aO/o+C4/ID5KBMEXhkphwwnFG4inzlEjr/yZqOrj22blxTib692uEiWtaf0gEtYfJm46aCjgUGkKMDJnH05cJe/l/VnMfxdvTtlT+YTDcnG/8pIkzaLormuuU6AN+N1U7K9lHFDKeyk7zvN9yJvjfKGaAV/niKeHG0iQNIuiYXvWSKcgKhr79CMwkGMdgqTmfOTsEEdsg9dFL2nGZ36wveRwGBCOmiakQjqsj6Y/ktTzyj8akllsvi8Du0JgLHO3qzSafsislaRe0qEyadYDQK9+/UjQZxAunwo0iW3jh5J6Xjm3pW430UVgZ0ANVKnEu60D2B0fOsNSBiagaHoKicBQzv9OUs/7yDOaE6+H9JKC2+2cur0SPPvYTixlILWRW1KVRrPnjxA08I0RJ7pYxhkk9TMqR0yUdSw+v07P10gKdga5CZQrsV4AhFSYgCK2giv142sjN63gxfhfSur3Kr4+jWRdPG8+4GSNpKqRos+DSQuRpFjKwAQUye+e+gF4LaLi11rOJmkgzca51wq7uP98L6/gHL2kqigVTDbB80a7sJSBbp6QXymtBAzmQkS2jPNKGrAql9+dY2375jiOUy6jaaZKqgZDsDLBSqNdEIdhAgr4dUEu+AHxNqziEpJmR5ZUjWRgZeg6Y+ES7At6eZg/QawGT0FJDZElNUB1nVG0xZITZnuC34X8STqIkhqRV1JwnZHjhNQHig8wwIqUy8J1KOmFJO2VmvV2F0wo8s1QcoJThfxJ1AqDqXiYRdycpL1BvdGFOBkSZUBYckIjTy1QIH3SSPq3ipi8mElaajXALHWWiEqoFRD4XdBccyFKakK6pKW62MlRiDIg0B7aFGr+BLE2ACXF6tgubkHSWlNq4ghEqkDehDao1q1Q4wRAeqSR3h4+4fH+BkmSDgz1PPG7WHJCNqvGYzggAJxDFw6xjEU+ARN7QdnRSlprQuaaQGSJ8BpAyan6XThAo/wNfKq4ySPBy5n9tU7SJjzQRI5RDlIf7PSpDlXjd9GDQ8fCOh5f4AGnstpeRVL9HGmZKAOCkhObiar1a/JYvNINTPvcZnaiq+25sypRUsw1U4j8bnrLHupWjVJwJetDqc+jbgagho/t2RNlQdLECdndTr1VghQoUgX8NbhV1e+C5rorgQe3k095FFPm8AHNxSXVTd+tdOrf3wmrkkYJDrbswa2ql9cYH15Jkxhbx+PGVNRNMM/o4pKKNlpsxUOiqkqWlj1kPRpJ0zNni0X9NAipq/fviWOXlhSc6m5XaZ8aCKgS7YbCB1r2cH3wzPJvYMfCarbvicnvxyY2vfPCkuKj3HVVj6cf/YbUBwsPcOuylYKRCnNlLGfxJs8OKm+Ub2UuLCm6XbAzmBUU2Rmmyqkte9mhwswmjTFbz+NhutBX2ecwhUiYpntZSdFI8YmD64zCLJggtOyx2gTVfeHBgVuWHFVDYEceLisppDfoOcFIM7XswaEKxxj5it+i6s4n+xiz4ditPlgsKZgZLikGqmdp2aPflYIpKgoX+hUepvO9zGT5mv+GLiopPnHwuxjlIjsGE4SzsdoUegiCojZ07Ks6PUPm0wzGGn8DLiop6qWKIqynkNCyh5xGUEtdh0H6dqIvxNsrM52AhsBsbBhcR3M39r83UOVHnC78gJ5T8XiCopHfRBMESfH03ekyOzX8kFEK6NemOgT9ZJ6Wo3RBx/tx/P85h1l1nK77gEXIac4qfIOY1DqKislCs1MQRQ/pt0q1u0KpBa77wG/nRg9LUT4Nk3WSqqP1ZL+fnG7L2OpPZnW6QoAg6a5ztFN5lbKEEsZvPLVKrXqnH3bnUXQTftvtVp9k7fQ8LV8lWavT8eFSQyXo3idqlBFlvTlJ0t2uU2/6uggWetrEhX1xDpaG5aYBv73k0VqrXCJ+deOG5evadcfD44sxhp84Y4Kk9o4wPUqlYXjyQOwXmiDUrddk/K3EcOy+HpsL1ep6aRpfFVzh5nPNcJF4URdmwZw1leiBJ0p6MOZcftcGRWfz9T/Y4wu7zO6T5aT4THYqLLUjhMMUoow4UdKOeHU5G7JM0aelKGfIyM2k6lJXu96fYZ7gSloQS2jBnqIG1NichERJm2K/UKpB8bxfZLwfpreF/i1nIJ3MUDbRA4/vIFFGysKQQHoCU0z64h+OjlGTqt5i8mvgr+ICN3hV1nMpcRV4HRuomiToXXzlonyC6lZNSn7GRZjFEm/mJbjRQz8CTLKeEl6Lv728p6GgB17HiR54ZtCDuFu8SwOsJmy0qzoku942+s741KKE16El5l49XYsw/LlbG/UerTWyZujqvxnPXIr4esasKI5W0/5A2Hlyqtbk+gXpwkEc1mnahYlot0F16o6HxyJ0OFxmHnt7E1a+0bLapOjp0xPjabAoUcqXoeKKzMV24D/BL7cTTrpVQc/E4vndoEv4sjFbHsm3JxC13wqcoPr01bHOQvvk1Eq3Pjh6T5DtuxlfUA210rjxP+t0Hhb3zntZnJX2Ud44bxn/2MWgHeVB/U4ryxMuDMIFIAcl41hYa3a+X4Vip049T1n4Kx59+iseOf6/Mv/dkoheyed60wn8v98EGwkhhJDsPFSn7nI4HE4OY24+rjutZuljEIuounO5/eB3IMZuSo+QWIZ+kuhJZ4my3gomeoZkmi9KfoeR8YDbuVT9t4ZN5HyMxiCZAeMfzNh/cCd/3tAvSD5B94azgCUe3NksaeoF+REPLiiVhck6s7UdnDxzrIuRfdIvkCmsjoIvO6awg5yHbPPy9UzkGYkqVTf8UoeKXop/Bt9CmTKbJ42dP1TX4+jHqOilmGYsXNKZDZfutFoNtR2FM/eHp5PCmRldDNXpTvxPKKbfawBUX13lA/IzMaGilyJWujzNXV1X/t9UM+UsL3O9dyY/4uHbADVfrcUZTefnctEz9owuRaho8relcYwmc6cy5AjdxfBb9E/Gega8mvf1ZWbMdC/HeL83XachzsM05weNPjOXUfRyrPfjvB7w8KF/HkFz/yIxoPqzx5tD1SdaqO2M1lk88PwHo3DkirwuTYx1xhkQt0V1PU4wV7/t+9ef0G0yqk79Pm60BMt+OJy764QmPiGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghxBLu7u7+A6uAM1lx8nEzAAAAAElFTkSuQmCC";const n={id:"app"},r={class:"header-right"},d={class:"profile-sidebar"},u={class:"mobile-warning"},c={class:"page-container"};function m(e,t,s,m,h,p){const k=(0,l.g2)("ProfileSidebar"),f=(0,l.g2)("NavBar"),b=(0,l.g2)("router-view"),y=(0,l.g2)("ScrollToTop");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.Lk)("header",null,[t[2]||(t[2]=(0,l.Lk)("div",{class:"header-left"},[(0,l.Lk)("img",{src:i,alt:"ATB Logo",class:"logo"}),(0,l.Lk)("div",{class:"app-title-container"},[(0,l.Lk)("h1",null,"MERITS"),(0,l.Lk)("span",{class:"app-tagline"},"Medical Examination Record & Information Tracking System")])],-1)),(0,l.Lk)("div",r,[(0,l.Lk)("span",d,[h.currentUser&&h.currentUser.email?((0,l.uX)(),(0,l.Wv)(k,{key:0,user:h.currentUser},null,8,["user"])):(0,l.Q3)("",!0)]),h.showMobileWarning?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn primary",onClick:t[0]||(t[0]=t=>e.$router.push("/profile"))},"ðŸ‘¤"))])]),(0,l.bo)((0,l.Lk)("div",u,[(0,l.Lk)("div",c,[t[3]||(t[3]=(0,l.Lk)("p",{class:"warning-content"},[(0,l.Lk)("strong",null,"Optimized for Desktop"),(0,l.Lk)("br"),(0,l.eW)("We apologize for the inconvenience! This website is currently optimized for desktop or tablet (landscape) viewing to ensure the best experience. "),(0,l.Lk)("br"),(0,l.eW)("Please switch to the "),(0,l.Lk)("b",null,"mobile's desktop mode"),(0,l.eW)(" or use a "),(0,l.Lk)("b",null,"larger screen device"),(0,l.eW)(" to continue. "),(0,l.Lk)("br"),(0,l.eW)("Thank you for your patience! ")],-1)),(0,l.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>p.proceedAnyway&&p.proceedAnyway(...e)),class:"proceed-btn",style:{border:"1px solid #CBD5E0",background:"#2b6cb0",color:"white",padding:"8px 12px","border-radius":"4px",cursor:"pointer"}}," Proceed Anyway ")])],512),[[a.aG,h.showMobileWarning]]),p.showNavBar?((0,l.uX)(),(0,l.Wv)(f,{key:e.$route.fullPath})):(0,l.Q3)("",!0),(0,l.Lk)("main",{class:"page-container",style:(0,o.Tr)(h.currentUser?"":"background-image: url('https://signup.softclinicgenx.com/wp-content/uploads/2022/05/medical-report-with-medical-equipment.jpg');background-repeat: no-repeat;background-size: cover;")},[(0,l.bF)(b),(0,l.bF)(y)],4)])}function h(e,t,s,a,i,n){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("nav",null,[(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.menu,(e=>((0,l.uX)(),(0,l.CE)("li",{key:e.name},[(0,l.bF)(r,{to:e.route},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.name),1)])),_:2},1032,["to"])])))),128))])])}var p={name:"NavBar",data(){return{currentUserInfo:null,menuItems:{doctor:[{name:"ðŸ ï¸Ž",route:"/dashboard"},{name:"Manage Doctor Info",route:"/doctor/manage-info"},{name:"Manage Staff Info",route:"/doctor/non-session-completeness"},{name:"Manage Sessions & Reports",route:"/doctor/manage-sessions"},{name:"Analytics",route:"/doctor/analytics-all-page"}],staff:[{name:"ðŸ ï¸Ž",route:"/dashboard"},{name:"My Staff Info",route:"/staff/non-session"},{name:"My Sessions Info",route:"/staff/my-sessions"},{name:"Analytics",route:"/staff/analytics-page"}],admin:[{name:"ðŸ ï¸Ž",route:"/dashboard"},{name:"Manage Users",route:"/admin/manage-users"},{name:"Manage Staff Info",route:"/admin/non-session-completeness"},{name:"Manage Sessions",route:"/admin/manage-sessions"},{name:"Analytics",route:"/admin/analytics-all-page"}],restricted:[{name:"ðŸ ï¸Ž",route:"/dashboard"}]}}},computed:{menu(){const e=localStorage.getItem("user_info");if(!e)return[];try{const t=JSON.parse(e)?.role;return this.menuItems[t]||[]}catch(t){return[]}}}},k=s(1241);const f=(0,k.A)(p,[["render",h],["__scopeId","data-v-ef04575a"]]);var b=f;const y=["src"],L={class:"header"},_={class:"content"},g=["src"],v={class:"name"},S={class:"email"},C={class:"role"},w={class:"actions"};function E(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("img",{src:i.img,class:"avatar",alt:"User",onClick:t[0]||(t[0]=(...e)=>n.openSidebar&&n.openSidebar(...e))},null,8,y),(0,l.Lk)("div",{class:(0,o.C4)(["sidebar",{open:i.isOpen}]),role:"dialog","aria-modal":"true","aria-label":"User menu"},[(0,l.Lk)("div",L,[(0,l.Lk)("span",{class:"close",onClick:t[1]||(t[1]=(...e)=>n.closeSidebar&&n.closeSidebar(...e)),"aria-label":"Close sidebar"},"âœ•")]),(0,l.Lk)("div",_,[(0,l.Lk)("img",{src:i.img,class:"avatar-large",alt:"User avatar"},null,8,g),(0,l.Lk)("div",v,(0,o.v_)(i.localUser.fullname),1),(0,l.Lk)("div",S,(0,o.v_)(i.localUser.email),1),(0,l.Lk)("div",C,"("+(0,o.v_)(n.formattedRole)+")",1),(0,l.Lk)("div",w,[(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.viewProfile&&n.viewProfile(...e)),class:"view-profile"},"ðŸ‘¤ View Profile"),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.logout&&n.logout(...e)),class:"logout"},"ðŸ”“ Logout")])])],2),i.isOpen?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"overlay",onClick:t[4]||(t[4]=(...e)=>n.closeSidebar&&n.closeSidebar(...e))})):(0,l.Q3)("",!0)])}var A={name:"ProfileSidebar",data(){return{isOpen:!1,img:"https://cdn.pixabay.com/photo/2023/02/18/11/00/icon-7797704_640.png",localUser:{fullname:"",email:"",role:""}}},mounted(){const e=JSON.parse(localStorage.getItem("user_info"));e&&(this.localUser=e),window.addEventListener("keydown",this.onKeydown),this.unwatch=this.$watch("$route.fullPath",(()=>{this.isOpen&&this.closeSidebar()}))},beforeUnmount(){window.removeEventListener("keydown",this.onKeydown),this.unwatch&&this.unwatch(),this.unlockScroll()},computed:{formattedRole(){if(!this.localUser.role)return"Unknown Role";const e={admin:"Admin",doctor:"Doctor",staff:"Staff"};return e[this.localUser.role]||this.localUser.role[0]?.toUpperCase()+this.localUser.role.slice(1)}},methods:{onKeydown(e){"Escape"===e.key&&this.isOpen&&this.closeSidebar()},lockScroll(){document.body.style.overflow="hidden"},unlockScroll(){document.body.style.overflow=""},openSidebar(){this.isOpen=!0,this.lockScroll()},closeSidebar(){this.isOpen=!1,this.unlockScroll()},viewProfile(){this.$router.push("/profile"),this.closeSidebar()},logout(){this.closeSidebar(),localStorage.removeItem("jwt_token"),localStorage.removeItem("user_info"),window.dispatchEvent(new Event("user-logout")),this.$router.push("/")}}};const D=(0,k.A)(A,[["render",E],["__scopeId","data-v-66e16b89"]]);var x=D;function I(e,t,s,o,i,n){return(0,l.bo)(((0,l.uX)(),(0,l.CE)("button",{class:"scroll-top",onClick:t[0]||(t[0]=(...e)=>n.toTop&&n.toTop(...e)),"aria-label":"Scroll to top"}," â†‘ ",512)),[[a.aG,i.visible]])}var U={name:"ScrollToTop",data(){return{visible:!1,rafId:null}},mounted(){const e=()=>{this.rafId||(this.rafId=requestAnimationFrame((()=>{this.visible=window.scrollY>150,this.rafId=null})))};this._onScroll=e,window.addEventListener("scroll",e,{passive:!0})},beforeUnmount(){window.removeEventListener("scroll",this._onScroll),this.rafId&&cancelAnimationFrame(this.rafId)},methods:{toTop(){const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches;window.scrollTo({top:0,behavior:e?"auto":"smooth"})}}};const F=(0,k.A)(U,[["render",I],["__scopeId","data-v-6b21529e"]]);var N=F,$={components:{ProfileSidebar:x,NavBar:b,ScrollToTop:N},data(){return{currentUser:null,showMobileWarning:!0}},mounted(){this.loadUser(),window.addEventListener("user-logout",this.handleLogout),window.addEventListener("user-login",this.loadUser)},beforeUnmount(){window.removeEventListener("user-logout",this.handleLogout),window.removeEventListener("user-login",this.loadUser)},computed:{showNavBar(){return"/login"!==this.$route.path}},methods:{proceedAnyway(){this.showMobileWarning=!1},loadUser(){const e=localStorage.getItem("user_info");this.currentUser=e?JSON.parse(e):null},handleLogout(){this.currentUser=null}}};const M=(0,k.A)($,[["render",m]]);var P=M,B=s(1815);(0,a.Ef)(P).use(B.A).mount("#app")},8945:function(e,t){const s="undefined"!==typeof window&&/^(localhost|127\.0\.0\.1)/.test(location.hostname),a=!s,l=a?"https://darkgray-mole-938146.hostingersite.com/api":"http://localhost:8000/api",o="API_BASE_URL_OVERRIDE",i="undefined"!==typeof localStorage?localStorage.getItem(o):null;t.A={API_BASE_URL:i&&i.trim()||l,setOverride(e){localStorage.setItem(o,e)},clearOverride(){localStorage.removeItem(o)}}}},t={};function s(a){var l=t[a];if(void 0!==l)return l.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,a,l,o){if(!a){var i=1/0;for(u=0;u<e.length;u++){a=e[u][0],l=e[u][1],o=e[u][2];for(var n=!0,r=0;r<a.length;r++)(!1&o||i>=o)&&Object.keys(s.O).every((function(e){return s.O[e](a[r])}))?a.splice(r--,1):(n=!1,o<i&&(i=o));if(n){e.splice(u--,1);var d=l();void 0!==d&&(t=d)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[a,l,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,a){return s.f[a](e,t),t}),[]))}}(),function(){s.u=function(e){return"js/"+e+".030f0b7f.js"}}(),function(){s.miniCssF=function(e){return"css/"+e+".af247525.css"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="bmi-app-gen:";s.l=function(a,l,o,i){if(e[a])e[a].push(l);else{var n,r;if(void 0!==o)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==a||c.getAttribute("data-webpack")==t+o){n=c;break}}n||(r=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,s.nc&&n.setAttribute("nonce",s.nc),n.setAttribute("data-webpack",t+o),n.src=a),e[a]=[l];var m=function(t,s){n.onerror=n.onload=null,clearTimeout(h);var l=e[a];if(delete e[a],n.parentNode&&n.parentNode.removeChild(n),l&&l.forEach((function(e){return e(s)})),t)return t(s)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=m.bind(null,n.onerror),n.onload=m.bind(null,n.onload),r&&document.head.appendChild(n)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,l,o){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",s.nc&&(i.nonce=s.nc);var n=function(s){if(i.onerror=i.onload=null,"load"===s.type)l();else{var a=s&&s.type,n=s&&s.target&&s.target.href||t,r=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+n+")");r.name="ChunkLoadError",r.code="CSS_CHUNK_LOAD_FAILED",r.type=a,r.request=n,i.parentNode&&i.parentNode.removeChild(i),o(r)}};return i.onerror=i.onload=n,i.href=t,a?a.parentNode.insertBefore(i,a.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var s=document.getElementsByTagName("link"),a=0;a<s.length;a++){var l=s[a],o=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(o===e||o===t))return l}var i=document.getElementsByTagName("style");for(a=0;a<i.length;a++){l=i[a],o=l.getAttribute("data-href");if(o===e||o===t)return l}},a=function(a){return new Promise((function(l,o){var i=s.miniCssF(a),n=s.p+i;if(t(i,n))return l();e(a,n,null,l,o)}))},l={57:0};s.f.miniCss=function(e,t){var s={140:1};l[e]?t.push(l[e]):0!==l[e]&&s[e]&&t.push(l[e]=a(e).then((function(){l[e]=0}),(function(t){throw delete l[e],t})))}}}(),function(){var e={57:0};s.f.j=function(t,a){var l=s.o(e,t)?e[t]:void 0;if(0!==l)if(l)a.push(l[2]);else{var o=new Promise((function(s,a){l=e[t]=[s,a]}));a.push(l[2]=o);var i=s.p+s.u(t),n=new Error,r=function(a){if(s.o(e,t)&&(l=e[t],0!==l&&(e[t]=void 0),l)){var o=a&&("load"===a.type?"missing":a.type),i=a&&a.target&&a.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",n.name="ChunkLoadError",n.type=o,n.request=i,l[1](n)}};s.l(i,r,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,a){var l,o,i=a[0],n=a[1],r=a[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(l in n)s.o(n,l)&&(s.m[l]=n[l]);if(r)var u=r(s)}for(t&&t(a);d<i.length;d++)o=i[d],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(u)},a=self["webpackChunkbmi_app_gen"]=self["webpackChunkbmi_app_gen"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(4046)}));a=s.O(a)})();
//# sourceMappingURL=index.671a3af7.js.map